<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, ForeignFunctionInterface #-}</span><span>
</span><a name="line-2"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 709</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE Safe #-}</span><span>
</span><a name="line-4"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><a name="line-6"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE InterruptibleFFI #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Module      :  System.Process</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow 2004-2008</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span><span>
</span><a name="line-14"></a><span class="hs-comment">--</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- Maintainer  :  libraries@haskell.org</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- Portability :  non-portable (requires concurrency)</span><span>
</span><a name="line-18"></a><span class="hs-comment">--</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- Operations for creating and interacting with sub-processes.</span><span>
</span><a name="line-20"></a><span class="hs-comment">--</span><span>
</span><a name="line-21"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-comment">-- ToDo:</span><span>
</span><a name="line-24"></a><span class="hs-comment">--      * Flag to control whether exiting the parent also kills the child.</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Process</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-27"></a><span>    </span><span class="hs-comment">-- * Running sub-processes</span><span>
</span><a name="line-28"></a><span>    </span><a href="System.Process.html#createProcess"><span class="hs-identifier hs-var">createProcess</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>    </span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>    </span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a><span class="hs-special">,</span><span> </span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>    </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>    </span><a href="System.Process.Common.html#CmdSpec"><span class="hs-identifier hs-type">CmdSpec</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>    </span><a href="System.Process.Common.html#StdStream"><span class="hs-identifier hs-type">StdStream</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>    </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>    </span><span class="hs-comment">-- ** Simpler functions for common tasks</span><span>
</span><a name="line-37"></a><span>    </span><a href="System.Process.html#callProcess"><span class="hs-identifier hs-var">callProcess</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>    </span><a href="System.Process.html#callCommand"><span class="hs-identifier hs-var">callCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>    </span><a href="System.Process.html#spawnProcess"><span class="hs-identifier hs-var">spawnProcess</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>    </span><a href="System.Process.html#spawnCommand"><span class="hs-identifier hs-var">spawnCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>    </span><a href="System.Process.html#readCreateProcess"><span class="hs-identifier hs-var">readCreateProcess</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>    </span><a href="System.Process.html#readProcess"><span class="hs-identifier hs-var">readProcess</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>    </span><a href="System.Process.html#readCreateProcessWithExitCode"><span class="hs-identifier hs-var">readCreateProcessWithExitCode</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>    </span><a href="System.Process.html#readProcessWithExitCode"><span class="hs-identifier hs-var">readProcessWithExitCode</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>    </span><a href="System.Process.html#withCreateProcess"><span class="hs-identifier hs-var">withCreateProcess</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span>    </span><span class="hs-comment">-- ** Related utilities</span><span>
</span><a name="line-48"></a><span>    </span><a href="System.Process.html#showCommandForUser"><span class="hs-identifier hs-var">showCommandForUser</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-comment">-- ** Control-C handling on Unix</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-comment">-- $ctlc-handling</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span>    </span><span class="hs-comment">-- * Process completion</span><span>
</span><a name="line-54"></a><span>    </span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>    </span><a href="System.Process.html#getProcessExitCode"><span class="hs-identifier hs-var">getProcessExitCode</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>    </span><a href="System.Process.html#terminateProcess"><span class="hs-identifier hs-var">terminateProcess</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>    </span><a href="System.Process.Internals.html#interruptProcessGroupOf"><span class="hs-identifier hs-var">interruptProcessGroupOf</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>    </span><span class="hs-comment">-- Interprocess communication</span><span>
</span><a name="line-60"></a><span>    </span><a href="System.Process.Internals.html#createPipe"><span class="hs-identifier hs-var">createPipe</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>    </span><a href="System.Process.Internals.html#createPipeFd"><span class="hs-identifier hs-var">createPipeFd</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span>    </span><span class="hs-comment">-- * Old deprecated functions</span><span>
</span><a name="line-64"></a><span>    </span><span class="hs-comment">-- | These functions pre-date 'createProcess' which is much more</span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-comment">-- flexible.</span><span>
</span><a name="line-66"></a><span>    </span><a href="System.Process.html#runProcess"><span class="hs-identifier hs-var">runProcess</span></a><span class="hs-special">,</span><span>
</span><a name="line-67"></a><span>    </span><a href="System.Process.html#runCommand"><span class="hs-identifier hs-var">runCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>    </span><a href="System.Process.html#runInteractiveProcess"><span class="hs-identifier hs-var">runInteractiveProcess</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>    </span><a href="System.Process.html#runInteractiveCommand"><span class="hs-identifier hs-var">runInteractiveCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>    </span><a href="System.Process.html#system"><span class="hs-identifier hs-var">system</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>    </span><a href="System.Process.html#rawSystem"><span class="hs-identifier hs-var">rawSystem</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM</span><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="System.Process.Internals.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Process</span><span class="hs-operator">.</span><span class="hs-identifier">Internals</span></a><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Concurrent</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">DeepSeq</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rnf</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SomeException</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mask</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">bracket</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">try</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">throwIO</span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">C</span><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Exit</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Error</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkIOError</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ioeSetErrorString</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-comment">-- Provide the data constructors for CPid on GHC 7.4 and later</span><span>
</span><a name="line-91"></a><span class="hs-cpp">#if !defined(WINDOWS) &amp;&amp; MIN_VERSION_base(4,5,0)</span><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Posix</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CPid</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">ioException</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IOErrorType</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IOException</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- createProcess</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-comment">-- | Construct a 'CreateProcess' record for passing to 'createProcess',</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- representing a raw command with arguments.</span><span>
</span><a name="line-102"></a><span class="hs-comment">--</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- See 'RawCommand' for precise semantics of the specified @FilePath@.</span><span>
</span><a name="line-104"></a><span class="hs-identifier">proc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a><span>
</span><a name="line-105"></a><a name="proc"><a href="System.Process.html#proc"><span class="hs-identifier">proc</span></a></a><span> </span><a name="local-6989586621679044416"><a href="#local-6989586621679044416"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679044417"><a href="#local-6989586621679044417"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-var">CreateProcess</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cmdspec</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#RawCommand"><span class="hs-identifier hs-var">RawCommand</span></a><span> </span><a href="#local-6989586621679044416"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679044417"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>                                </span><span class="hs-identifier">cwd</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-107"></a><span>                                </span><span class="hs-identifier">env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span>                                </span><span class="hs-identifier">std_in</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>                                </span><span class="hs-identifier">std_out</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>                                </span><span class="hs-identifier">std_err</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a><span class="hs-special">,</span><span>
</span><a name="line-111"></a><span>                                </span><span class="hs-identifier">close_fds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-112"></a><span>                                </span><span class="hs-identifier">create_group</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-113"></a><span>                                </span><span class="hs-identifier">delegate_ctlc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-114"></a><span>                                </span><span class="hs-identifier">detach_console</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-115"></a><span>                                </span><span class="hs-identifier">create_new_console</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-116"></a><span>                                </span><span class="hs-identifier">new_session</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-117"></a><span>                                </span><span class="hs-identifier">child_group</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-118"></a><span>                                </span><span class="hs-identifier">child_user</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-119"></a><span>                                </span><span class="hs-identifier">use_process_jobs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">-- | Construct a 'CreateProcess' record for passing to 'createProcess',</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- representing a command to be passed to the shell.</span><span>
</span><a name="line-123"></a><span class="hs-identifier">shell</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a><span>
</span><a name="line-124"></a><a name="shell"><a href="System.Process.html#shell"><span class="hs-identifier">shell</span></a></a><span> </span><a name="local-6989586621679044418"><a href="#local-6989586621679044418"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-var">CreateProcess</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cmdspec</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#ShellCommand"><span class="hs-identifier hs-var">ShellCommand</span></a><span> </span><a href="#local-6989586621679044418"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span>
</span><a name="line-125"></a><span>                            </span><span class="hs-identifier">cwd</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-126"></a><span>                            </span><span class="hs-identifier">env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-127"></a><span>                            </span><span class="hs-identifier">std_in</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a><span class="hs-special">,</span><span>
</span><a name="line-128"></a><span>                            </span><span class="hs-identifier">std_out</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a><span class="hs-special">,</span><span>
</span><a name="line-129"></a><span>                            </span><span class="hs-identifier">std_err</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a><span class="hs-special">,</span><span>
</span><a name="line-130"></a><span>                            </span><span class="hs-identifier">close_fds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-131"></a><span>                            </span><span class="hs-identifier">create_group</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-132"></a><span>                            </span><span class="hs-identifier">delegate_ctlc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-133"></a><span>                            </span><span class="hs-identifier">detach_console</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-134"></a><span>                            </span><span class="hs-identifier">create_new_console</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-135"></a><span>                            </span><span class="hs-identifier">new_session</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-136"></a><span>                            </span><span class="hs-identifier">child_group</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-137"></a><span>                            </span><span class="hs-identifier">child_user</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-138"></a><span>                            </span><span class="hs-identifier">use_process_jobs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">{- |
This is the most general way to spawn an external process.  The
process can be a command line to be executed by a shell or a raw command
with a list of arguments.  The stdin, stdout, and stderr streams of
the new process may individually be attached to new pipes, to existing
'Handle's, or just inherited from the parent (the default.)

The details of how to create the process are passed in the
'CreateProcess' record.  To make it easier to construct a
'CreateProcess', the functions 'proc' and 'shell' are supplied that
fill in the fields with default values which can be overriden as
needed.

'createProcess' returns @(/mb_stdin_hdl/, /mb_stdout_hdl/, /mb_stderr_hdl/, /ph/)@,
where

 * if @'std_in' == 'CreatePipe'@, then @/mb_stdin_hdl/@ will be @Just /h/@,
   where @/h/@ is the write end of the pipe connected to the child
   process's @stdin@.

 * otherwise, @/mb_stdin_hdl/ == Nothing@

Similarly for @/mb_stdout_hdl/@ and @/mb_stderr_hdl/@.

For example, to execute a simple @ls@ command:

&gt;   r &lt;- createProcess (proc &quot;ls&quot; [])

To create a pipe from which to read the output of @ls@:

&gt;   (_, Just hout, _, _) &lt;-
&gt;       createProcess (proc &quot;ls&quot; []){ std_out = CreatePipe }

To also set the directory in which to run @ls@:

&gt;   (_, Just hout, _, _) &lt;-
&gt;       createProcess (proc &quot;ls&quot; []){ cwd = Just &quot;\home\bob&quot;,
&gt;                                     std_out = CreatePipe }

Note that @Handle@s provided for @std_in@, @std_out@, or @std_err@ via the
@UseHandle@ constructor will be closed by calling this function. This is not
always the desired behavior. In cases where you would like to leave the
@Handle@ open after spawning the child process, please use 'createProcess_'
instead. All created @Handle@s are initially in text mode; if you need them
to be in binary mode then use 'hSetBinaryMode'.

-}</span><span>
</span><a name="line-187"></a><span class="hs-identifier">createProcess</span><span>
</span><a name="line-188"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a><span>
</span><a name="line-189"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><a name="createProcess"><a href="System.Process.html#createProcess"><span class="hs-identifier">createProcess</span></a></a><span> </span><a name="local-6989586621679044419"><a href="#local-6989586621679044419"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-191"></a><span>  </span><a name="local-6989586621679044679"><a href="#local-6989586621679044679"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a><span> </span><span class="hs-string">&quot;createProcess&quot;</span><span> </span><a href="#local-6989586621679044419"><span class="hs-identifier hs-var">cp</span></a><span>
</span><a name="line-192"></a><span>  </span><a href="#local-6989586621679044420"><span class="hs-identifier hs-var">maybeCloseStd</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">std_in</span><span>  </span><a href="#local-6989586621679044419"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>  </span><a href="#local-6989586621679044420"><span class="hs-identifier hs-var">maybeCloseStd</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">std_out</span><span> </span><a href="#local-6989586621679044419"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span>  </span><a href="#local-6989586621679044420"><span class="hs-identifier hs-var">maybeCloseStd</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">std_err</span><span> </span><a href="#local-6989586621679044419"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679044679"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-196"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-197"></a><span>  </span><span class="hs-identifier">maybeCloseStd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#StdStream"><span class="hs-identifier hs-type">StdStream</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span>  </span><a name="local-6989586621679044420"><a href="#local-6989586621679044420"><span class="hs-identifier">maybeCloseStd</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Process.Common.html#UseHandle"><span class="hs-identifier hs-var">UseHandle</span></a><span> </span><a name="local-6989586621679044421"><a href="#local-6989586621679044421"><span class="hs-identifier">hdl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679044421"><span class="hs-identifier hs-var">hdl</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">stdin</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679044421"><span class="hs-identifier hs-var">hdl</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">stdout</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679044421"><span class="hs-identifier hs-var">hdl</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">stderr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679044421"><span class="hs-identifier hs-var">hdl</span></a><span>
</span><a name="line-200"></a><span>  </span><span class="hs-identifier">maybeCloseStd</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span class="hs-comment">-- | A 'C.bracket'-style resource handler for 'createProcess'.</span><span>
</span><a name="line-203"></a><span class="hs-comment">--</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- Does automatic cleanup when the action finishes. If there is an exception</span><span>
</span><a name="line-205"></a><span class="hs-comment">-- in the body then it ensures that the process gets terminated and any</span><span>
</span><a name="line-206"></a><span class="hs-comment">-- 'CreatePipe' 'Handle's are closed. In particular this means that if the</span><span>
</span><a name="line-207"></a><span class="hs-comment">-- Haskell thread is killed (e.g. 'killThread'), that the external process is</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- also terminated.</span><span>
</span><a name="line-209"></a><span class="hs-comment">--</span><span>
</span><a name="line-210"></a><span class="hs-comment">-- e.g.</span><span>
</span><a name="line-211"></a><span class="hs-comment">--</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- &gt; withCreateProcess (proc cmd args) { ... }  $ \_ _ _ ph -&gt; do</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- &gt;   ...</span><span>
</span><a name="line-214"></a><span class="hs-comment">--</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- @since 1.4.3.0</span><span>
</span><a name="line-216"></a><span class="hs-identifier">withCreateProcess</span><span>
</span><a name="line-217"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a><span>
</span><a name="line-218"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679044415"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679044415"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-220"></a><a name="withCreateProcess"><a href="System.Process.html#withCreateProcess"><span class="hs-identifier">withCreateProcess</span></a></a><span> </span><a name="local-6989586621679044680"><a href="#local-6989586621679044680"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679044681"><a href="#local-6989586621679044681"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-221"></a><span>    </span><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">bracket</span><span> </span><span class="hs-special">(</span><a href="System.Process.html#createProcess"><span class="hs-identifier hs-var">createProcess</span></a><span> </span><a href="#local-6989586621679044680"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="System.Process.html#cleanupProcess"><span class="hs-identifier hs-var">cleanupProcess</span></a><span>
</span><a name="line-222"></a><span>              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679044682"><a href="#local-6989586621679044682"><span class="hs-identifier">m_in</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679044683"><a href="#local-6989586621679044683"><span class="hs-identifier">m_out</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679044684"><a href="#local-6989586621679044684"><span class="hs-identifier">m_err</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679044685"><a href="#local-6989586621679044685"><span class="hs-identifier">ph</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044681"><span class="hs-identifier hs-var">action</span></a><span> </span><a href="#local-6989586621679044682"><span class="hs-identifier hs-var">m_in</span></a><span> </span><a href="#local-6989586621679044683"><span class="hs-identifier hs-var">m_out</span></a><span> </span><a href="#local-6989586621679044684"><span class="hs-identifier hs-var">m_err</span></a><span> </span><a href="#local-6989586621679044685"><span class="hs-identifier hs-var">ph</span></a><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span class="hs-comment">-- wrapper so we can get exceptions with the appropriate function name.</span><span>
</span><a name="line-225"></a><span class="hs-identifier">withCreateProcess_</span><span>
</span><a name="line-226"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-227"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a><span>
</span><a name="line-228"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679044414"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679044414"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-230"></a><a name="withCreateProcess_"><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier">withCreateProcess_</span></a></a><span> </span><a name="local-6989586621679044686"><a href="#local-6989586621679044686"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679044687"><a href="#local-6989586621679044687"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679044688"><a href="#local-6989586621679044688"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">bracketOnError</span><span> </span><span class="hs-special">(</span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a><span> </span><a href="#local-6989586621679044686"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621679044687"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="System.Process.html#cleanupProcess"><span class="hs-identifier hs-var">cleanupProcess</span></a><span>
</span><a name="line-232"></a><span>                     </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679044689"><a href="#local-6989586621679044689"><span class="hs-identifier">m_in</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679044690"><a href="#local-6989586621679044690"><span class="hs-identifier">m_out</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679044691"><a href="#local-6989586621679044691"><span class="hs-identifier">m_err</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679044692"><a href="#local-6989586621679044692"><span class="hs-identifier">ph</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679044688"><span class="hs-identifier hs-var">action</span></a><span> </span><a href="#local-6989586621679044689"><span class="hs-identifier hs-var">m_in</span></a><span> </span><a href="#local-6989586621679044690"><span class="hs-identifier hs-var">m_out</span></a><span> </span><a href="#local-6989586621679044691"><span class="hs-identifier hs-var">m_err</span></a><span> </span><a href="#local-6989586621679044692"><span class="hs-identifier hs-var">ph</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-identifier">cleanupProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span class="hs-special">)</span><span>
</span><a name="line-236"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-237"></a><a name="cleanupProcess"><a href="System.Process.html#cleanupProcess"><span class="hs-identifier">cleanupProcess</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679044693"><a href="#local-6989586621679044693"><span class="hs-identifier">mb_stdin</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679044694"><a href="#local-6989586621679044694"><span class="hs-identifier">mb_stdout</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679044695"><a href="#local-6989586621679044695"><span class="hs-identifier">mb_stderr</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-238"></a><span>                </span><a name="local-6989586621679044696"><a href="#local-6989586621679044696"><span class="hs-identifier">ph</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-var">ProcessHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679044697"><a href="#local-6989586621679044697"><span class="hs-identifier">delegating_ctlc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-239"></a><span>    </span><a href="System.Process.html#terminateProcess"><span class="hs-identifier hs-var">terminateProcess</span></a><span> </span><a href="#local-6989586621679044696"><span class="hs-identifier hs-var">ph</span></a><span>
</span><a name="line-240"></a><span>    </span><span class="hs-comment">-- Note, it's important that other threads that might be reading/writing</span><span>
</span><a name="line-241"></a><span>    </span><span class="hs-comment">-- these handles also get killed off, since otherwise they might be holding</span><span>
</span><a name="line-242"></a><span>    </span><span class="hs-comment">-- the handle lock and prevent us from closing, leading to deadlock.</span><span>
</span><a name="line-243"></a><span>    </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="System.Process.html#ignoreSigPipe"><span class="hs-identifier hs-var">ignoreSigPipe</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">hClose</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679044693"><span class="hs-identifier hs-var">mb_stdin</span></a><span>
</span><a name="line-244"></a><span>    </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679044694"><span class="hs-identifier hs-var">mb_stdout</span></a><span>
</span><a name="line-245"></a><span>    </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679044695"><span class="hs-identifier hs-var">mb_stderr</span></a><span>
</span><a name="line-246"></a><span>    </span><span class="hs-comment">-- terminateProcess does not guarantee that it terminates the process.</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-comment">-- Indeed on Unix it's SIGTERM, which asks nicely but does not guarantee</span><span>
</span><a name="line-248"></a><span>    </span><span class="hs-comment">-- that it stops. If it doesn't stop, we don't want to hang, so we wait</span><span>
</span><a name="line-249"></a><span>    </span><span class="hs-comment">-- asynchronously using forkIO.</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>    </span><span class="hs-comment">-- However we want to end the Ctl-C handling synchronously, so we'll do</span><span>
</span><a name="line-252"></a><span>    </span><span class="hs-comment">-- that synchronously, and set delegating_ctlc as False for the</span><span>
</span><a name="line-253"></a><span>    </span><span class="hs-comment">-- waitForProcess (which would otherwise end the Ctl-C delegation itself).</span><span>
</span><a name="line-254"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679044697"><span class="hs-identifier hs-var">delegating_ctlc</span></a><span>
</span><a name="line-255"></a><span>      </span><a href="System.Process.Posix.html#stopDelegateControlC"><span class="hs-identifier hs-var">stopDelegateControlC</span></a><span>
</span><a name="line-256"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forkIO</span><span> </span><span class="hs-special">(</span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679044698"><span class="hs-identifier hs-var">resetCtlcDelegation</span></a><span> </span><a href="#local-6989586621679044696"><span class="hs-identifier hs-var">ph</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-259"></a><span>    </span><a name="local-6989586621679044698"><a href="#local-6989586621679044698"><span class="hs-identifier">resetCtlcDelegation</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-var">ProcessHandle</span></a><span> </span><a name="local-6989586621679044699"><a href="#local-6989586621679044699"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679044700"><a href="#local-6989586621679044700"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-var">ProcessHandle</span></a><span> </span><a href="#local-6989586621679044699"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679044700"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-262"></a><span class="hs-comment">-- spawnProcess/spawnCommand</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-comment">-- | Creates a new process to run the specified raw command with the given</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- arguments. It does not wait for the program to finish, but returns the</span><span>
</span><a name="line-266"></a><span class="hs-comment">-- 'ProcessHandle'.</span><span>
</span><a name="line-267"></a><span class="hs-comment">--</span><span>
</span><a name="line-268"></a><span class="hs-comment">-- @since 1.2.0.0</span><span>
</span><a name="line-269"></a><span class="hs-identifier">spawnProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span>
</span><a name="line-270"></a><a name="spawnProcess"><a href="System.Process.html#spawnProcess"><span class="hs-identifier">spawnProcess</span></a></a><span> </span><a name="local-6989586621679045195"><a href="#local-6989586621679045195"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679045196"><a href="#local-6989586621679045196"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-271"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679045197"><a href="#local-6989586621679045197"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a><span> </span><span class="hs-string">&quot;spawnProcess&quot;</span><span> </span><span class="hs-special">(</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a><span> </span><a href="#local-6989586621679045195"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679045196"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679045197"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span class="hs-comment">-- | Creates a new process to run the specified shell command.</span><span>
</span><a name="line-275"></a><span class="hs-comment">-- It does not wait for the program to finish, but returns the 'ProcessHandle'.</span><span>
</span><a name="line-276"></a><span class="hs-comment">--</span><span>
</span><a name="line-277"></a><span class="hs-comment">-- @since 1.2.0.0</span><span>
</span><a name="line-278"></a><span class="hs-identifier">spawnCommand</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span>
</span><a name="line-279"></a><a name="spawnCommand"><a href="System.Process.html#spawnCommand"><span class="hs-identifier">spawnCommand</span></a></a><span> </span><a name="local-6989586621679045198"><a href="#local-6989586621679045198"><span class="hs-identifier">cmd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-280"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679045199"><a href="#local-6989586621679045199"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a><span> </span><span class="hs-string">&quot;spawnCommand&quot;</span><span> </span><span class="hs-special">(</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a><span> </span><a href="#local-6989586621679045198"><span class="hs-identifier hs-var">cmd</span></a><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679045199"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-285"></a><span class="hs-comment">-- callProcess/callCommand</span><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-comment">-- | Creates a new process to run the specified command with the given</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- arguments, and wait for it to finish.  If the command returns a non-zero</span><span>
</span><a name="line-289"></a><span class="hs-comment">-- exit code, an exception is raised.</span><span>
</span><a name="line-290"></a><span class="hs-comment">--</span><span>
</span><a name="line-291"></a><span class="hs-comment">-- If an asynchronous exception is thrown to the thread executing</span><span>
</span><a name="line-292"></a><span class="hs-comment">-- @callProcess@, the forked process will be terminated and</span><span>
</span><a name="line-293"></a><span class="hs-comment">-- @callProcess@ will wait (block) until the process has been</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- terminated.</span><span>
</span><a name="line-295"></a><span class="hs-comment">--</span><span>
</span><a name="line-296"></a><span class="hs-comment">-- @since 1.2.0.0</span><span>
</span><a name="line-297"></a><span class="hs-identifier">callProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-298"></a><a name="callProcess"><a href="System.Process.html#callProcess"><span class="hs-identifier">callProcess</span></a></a><span> </span><a name="local-6989586621679045200"><a href="#local-6989586621679045200"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679045201"><a href="#local-6989586621679045201"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-299"></a><span>    </span><a name="local-6989586621679045203"><a href="#local-6989586621679045203"><span class="hs-identifier">exit_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier hs-var">withCreateProcess_</span></a><span> </span><span class="hs-string">&quot;callProcess&quot;</span><span>
</span><a name="line-300"></a><span>                   </span><span class="hs-special">(</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a><span> </span><a href="#local-6989586621679045200"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679045201"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delegate_ctlc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679045202"><a href="#local-6989586621679045202"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-301"></a><span>                   </span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a><span> </span><a href="#local-6989586621679045202"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-302"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045203"><span class="hs-identifier hs-var">exit_code</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-303"></a><span>      </span><span class="hs-identifier hs-var">ExitSuccess</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>      </span><span class="hs-identifier hs-var">ExitFailure</span><span> </span><a name="local-6989586621679045204"><a href="#local-6989586621679045204"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.html#processFailedException"><span class="hs-identifier hs-var">processFailedException</span></a><span> </span><span class="hs-string">&quot;callProcess&quot;</span><span> </span><a href="#local-6989586621679045200"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679045201"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679045204"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-comment">-- | Creates a new process to run the specified shell command.  If the</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- command returns a non-zero exit code, an exception is raised.</span><span>
</span><a name="line-308"></a><span class="hs-comment">--</span><span>
</span><a name="line-309"></a><span class="hs-comment">-- If an asynchronous exception is thrown to the thread executing</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- @callCommand@, the forked process will be terminated and</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- @callCommand@ will wait (block) until the process has been</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- terminated.</span><span>
</span><a name="line-313"></a><span class="hs-comment">--</span><span>
</span><a name="line-314"></a><span class="hs-comment">-- @since 1.2.0.0</span><span>
</span><a name="line-315"></a><span class="hs-identifier">callCommand</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-316"></a><a name="callCommand"><a href="System.Process.html#callCommand"><span class="hs-identifier">callCommand</span></a></a><span> </span><a name="local-6989586621679045205"><a href="#local-6989586621679045205"><span class="hs-identifier">cmd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-317"></a><span>    </span><a name="local-6989586621679045207"><a href="#local-6989586621679045207"><span class="hs-identifier">exit_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier hs-var">withCreateProcess_</span></a><span> </span><span class="hs-string">&quot;callCommand&quot;</span><span>
</span><a name="line-318"></a><span>                   </span><span class="hs-special">(</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a><span> </span><a href="#local-6989586621679045205"><span class="hs-identifier hs-var">cmd</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delegate_ctlc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679045206"><a href="#local-6989586621679045206"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-319"></a><span>                   </span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a><span> </span><a href="#local-6989586621679045206"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-320"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045207"><span class="hs-identifier hs-var">exit_code</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-321"></a><span>      </span><span class="hs-identifier hs-var">ExitSuccess</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>      </span><span class="hs-identifier hs-var">ExitFailure</span><span> </span><a name="local-6989586621679045208"><a href="#local-6989586621679045208"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.html#processFailedException"><span class="hs-identifier hs-var">processFailedException</span></a><span> </span><span class="hs-string">&quot;callCommand&quot;</span><span> </span><a href="#local-6989586621679045205"><span class="hs-identifier hs-var">cmd</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679045208"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span class="hs-identifier">processFailedException</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679044413"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-325"></a><a name="processFailedException"><a href="System.Process.html#processFailedException"><span class="hs-identifier">processFailedException</span></a></a><span> </span><a name="local-6989586621679045209"><a href="#local-6989586621679045209"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679045210"><a href="#local-6989586621679045210"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679045211"><a href="#local-6989586621679045211"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679045212"><a href="#local-6989586621679045212"><span class="hs-identifier">exit_code</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-326"></a><span>      </span><span class="hs-identifier hs-var">ioError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkIOError</span><span> </span><span class="hs-identifier hs-var">OtherError</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045209"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679045210"><span class="hs-identifier hs-var">cmd</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-327"></a><span>                                     </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-char">' '</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679045211"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-328"></a><span>                                     </span><span class="hs-string">&quot; (exit &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679045212"><span class="hs-identifier hs-var">exit_code</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>                                 </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- Control-C handling on Unix</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-comment">-- $ctlc-handling</span><span>
</span><a name="line-336"></a><span class="hs-comment">--</span><span>
</span><a name="line-337"></a><span class="hs-comment">-- When running an interactive console process (such as a shell, console-based</span><span>
</span><a name="line-338"></a><span class="hs-comment">-- text editor or ghci), we typically want that process to be allowed to handle</span><span>
</span><a name="line-339"></a><span class="hs-comment">-- Ctl-C keyboard interrupts how it sees fit. For example, while most programs</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- simply quit on a Ctl-C, some handle it specially. To allow this to happen,</span><span>
</span><a name="line-341"></a><span class="hs-comment">-- use the @'delegate_ctlc' = True@ option in the 'CreateProcess' options.</span><span>
</span><a name="line-342"></a><span class="hs-comment">--</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- The gory details:</span><span>
</span><a name="line-344"></a><span class="hs-comment">--</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- By default Ctl-C will generate a @SIGINT@ signal, causing a 'UserInterrupt'</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- exception to be sent to the main Haskell thread of your program, which if</span><span>
</span><a name="line-347"></a><span class="hs-comment">-- not specially handled will terminate the program. Normally, this is exactly</span><span>
</span><a name="line-348"></a><span class="hs-comment">-- what is wanted: an orderly shutdown of the program in response to Ctl-C.</span><span>
</span><a name="line-349"></a><span class="hs-comment">--</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- Of course when running another interactive program in the console then we</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- want to let that program handle Ctl-C. Under Unix however, Ctl-C sends</span><span>
</span><a name="line-352"></a><span class="hs-comment">-- @SIGINT@ to every process using the console. The standard solution is that</span><span>
</span><a name="line-353"></a><span class="hs-comment">-- while running an interactive program, ignore @SIGINT@ in the parent, and let</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- it be handled in the child process. If that process then terminates due to</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- the @SIGINT@ signal, then at that point treat it as if we had recieved the</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- @SIGINT@ ourselves and begin an orderly shutdown.</span><span>
</span><a name="line-357"></a><span class="hs-comment">--</span><span>
</span><a name="line-358"></a><span class="hs-comment">-- This behaviour is implemented by 'createProcess' (and</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- 'waitForProcess' \/ 'getProcessExitCode') when the @'delegate_ctlc' = True@</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- option is set. In particular, the @SIGINT@ signal will be ignored until</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- 'waitForProcess' returns (or 'getProcessExitCode' returns a non-Nothing</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- result), so it becomes especially important to use 'waitForProcess' for every</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- processes created.</span><span>
</span><a name="line-364"></a><span class="hs-comment">--</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- In addition, in 'delegate_ctlc' mode, 'waitForProcess' and</span><span>
</span><a name="line-366"></a><span class="hs-comment">-- 'getProcessExitCode' will throw a 'UserInterrupt' exception if the process</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- terminated with @'ExitFailure' (-SIGINT)@. Typically you will not want to</span><span>
</span><a name="line-368"></a><span class="hs-comment">-- catch this exception, but let it propagate, giving a normal orderly shutdown.</span><span>
</span><a name="line-369"></a><span class="hs-comment">-- One detail to be aware of is that the 'UserInterrupt' exception is thrown</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- /synchronously/ in the thread that calls 'waitForProcess', whereas normally</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- @SIGINT@ causes the exception to be thrown /asynchronously/ to the main</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- thread.</span><span>
</span><a name="line-373"></a><span class="hs-comment">--</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- For even more detail on this topic, see</span><span>
</span><a name="line-375"></a><span class="hs-comment">-- &lt;http://www.cons.org/cracauer/sigint.html &quot;Proper handling of SIGINT/SIGQUIT&quot;&gt;.</span><span>
</span><a name="line-376"></a><span>
</span><a name="line-377"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-comment">-- | @readProcess@ forks an external process, reads its standard output</span><span>
</span><a name="line-380"></a><span class="hs-comment">-- strictly, blocking until the process terminates, and returns the output</span><span>
</span><a name="line-381"></a><span class="hs-comment">-- string. The external process inherits the standard error.</span><span>
</span><a name="line-382"></a><span class="hs-comment">--</span><span>
</span><a name="line-383"></a><span class="hs-comment">-- If an asynchronous exception is thrown to the thread executing</span><span>
</span><a name="line-384"></a><span class="hs-comment">-- @readProcess@, the forked process will be terminated and @readProcess@ will</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- wait (block) until the process has been terminated.</span><span>
</span><a name="line-386"></a><span class="hs-comment">--</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- Output is returned strictly, so this is not suitable for</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- interactive applications.</span><span>
</span><a name="line-389"></a><span class="hs-comment">--</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- This function throws an 'IOError' if the process 'ExitCode' is</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- anything other than 'ExitSuccess'. If instead you want to get the</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- 'ExitCode' then use 'readProcessWithExitCode'.</span><span>
</span><a name="line-393"></a><span class="hs-comment">--</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- Users of this function should compile with @-threaded@ if they</span><span>
</span><a name="line-395"></a><span class="hs-comment">-- want other Haskell threads to keep running while waiting on</span><span>
</span><a name="line-396"></a><span class="hs-comment">-- the result of readProcess.</span><span>
</span><a name="line-397"></a><span class="hs-comment">--</span><span>
</span><a name="line-398"></a><span class="hs-comment">-- &gt;  &gt; readProcess &quot;date&quot; [] []</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- &gt;  &quot;Thu Feb  7 10:03:39 PST 2008\n&quot;</span><span>
</span><a name="line-400"></a><span class="hs-comment">--</span><span>
</span><a name="line-401"></a><span class="hs-comment">-- The arguments are:</span><span>
</span><a name="line-402"></a><span class="hs-comment">--</span><span>
</span><a name="line-403"></a><span class="hs-comment">-- * The command to run, which must be in the $PATH, or an absolute or relative path</span><span>
</span><a name="line-404"></a><span class="hs-comment">--</span><span>
</span><a name="line-405"></a><span class="hs-comment">-- * A list of separate command line arguments to the program</span><span>
</span><a name="line-406"></a><span class="hs-comment">--</span><span>
</span><a name="line-407"></a><span class="hs-comment">-- * A string to pass on standard input to the forked process.</span><span>
</span><a name="line-408"></a><span class="hs-comment">--</span><span>
</span><a name="line-409"></a><span class="hs-identifier">readProcess</span><span>
</span><a name="line-410"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>                 </span><span class="hs-comment">-- ^ Filename of the executable (see 'RawCommand' for details)</span><span>
</span><a name="line-411"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- ^ any arguments</span><span>
</span><a name="line-412"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>                   </span><span class="hs-comment">-- ^ standard input</span><span>
</span><a name="line-413"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>                </span><span class="hs-comment">-- ^ stdout</span><span>
</span><a name="line-414"></a><a name="readProcess"><a href="System.Process.html#readProcess"><span class="hs-identifier">readProcess</span></a></a><span> </span><a name="local-6989586621679045213"><a href="#local-6989586621679045213"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679045214"><a href="#local-6989586621679045214"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.html#readCreateProcess"><span class="hs-identifier hs-var">readCreateProcess</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a><span> </span><a href="#local-6989586621679045213"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679045214"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span class="hs-comment">-- | @readCreateProcess@ works exactly like 'readProcess' except that it</span><span>
</span><a name="line-417"></a><span class="hs-comment">-- lets you pass 'CreateProcess' giving better flexibility.</span><span>
</span><a name="line-418"></a><span class="hs-comment">--</span><span>
</span><a name="line-419"></a><span class="hs-comment">-- &gt;  &gt; readCreateProcess (shell &quot;pwd&quot; { cwd = &quot;/etc/&quot; }) &quot;&quot;</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- &gt;  &quot;/etc\n&quot;</span><span>
</span><a name="line-421"></a><span class="hs-comment">--</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- Note that @Handle@s provided for @std_in@ or @std_out@ via the CreateProcess</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- record will be ignored.</span><span>
</span><a name="line-424"></a><span class="hs-comment">--</span><span>
</span><a name="line-425"></a><span class="hs-comment">-- @since 1.2.3.0</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-identifier">readCreateProcess</span><span>
</span><a name="line-428"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a><span>
</span><a name="line-429"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>                   </span><span class="hs-comment">-- ^ standard input</span><span>
</span><a name="line-430"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>                </span><span class="hs-comment">-- ^ stdout</span><span>
</span><a name="line-431"></a><a name="readCreateProcess"><a href="System.Process.html#readCreateProcess"><span class="hs-identifier">readCreateProcess</span></a></a><span> </span><a name="local-6989586621679045215"><a href="#local-6989586621679045215"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679045216"><a href="#local-6989586621679045216"><span class="hs-identifier">input</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-432"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679045222"><a href="#local-6989586621679045222"><span class="hs-identifier">cp_opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045215"><span class="hs-identifier hs-var">cp</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-433"></a><span>                    </span><span class="hs-identifier">std_in</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-var">CreatePipe</span></a><span class="hs-special">,</span><span>
</span><a name="line-434"></a><span>                    </span><span class="hs-identifier">std_out</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-var">CreatePipe</span></a><span>
</span><a name="line-435"></a><span>                  </span><span class="hs-special">}</span><span>
</span><a name="line-436"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679045361"><a href="#local-6989586621679045361"><span class="hs-identifier">ex</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679045362"><a href="#local-6989586621679045362"><span class="hs-identifier">output</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier hs-var">withCreateProcess_</span></a><span> </span><span class="hs-string">&quot;readCreateProcess&quot;</span><span> </span><a href="#local-6989586621679045222"><span class="hs-identifier hs-var">cp_opts</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-437"></a><span>      </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679045223"><a href="#local-6989586621679045223"><span class="hs-identifier">inh</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679045224"><a href="#local-6989586621679045224"><span class="hs-identifier">outh</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679045225"><a href="#local-6989586621679045225"><span class="hs-identifier">ph</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span>        </span><span class="hs-comment">-- fork off a thread to start consuming the output</span><span>
</span><a name="line-440"></a><span>        </span><a name="local-6989586621679045358"><a href="#local-6989586621679045358"><span class="hs-identifier">output</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">hGetContents</span><span> </span><a href="#local-6989586621679045224"><span class="hs-identifier hs-var">outh</span></a><span>
</span><a name="line-441"></a><span>        </span><a href="System.Process.html#withForkWait"><span class="hs-identifier hs-var">withForkWait</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">evaluate</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">rnf</span><span> </span><a href="#local-6989586621679045358"><span class="hs-identifier hs-var">output</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045359"><a href="#local-6989586621679045359"><span class="hs-identifier">waitOut</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-442"></a><span>
</span><a name="line-443"></a><span>          </span><span class="hs-comment">-- now write any input</span><span>
</span><a name="line-444"></a><span>          </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679045216"><span class="hs-identifier hs-var">input</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-445"></a><span>            </span><a href="System.Process.html#ignoreSigPipe"><span class="hs-identifier hs-var">ignoreSigPipe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679045223"><span class="hs-identifier hs-var">inh</span></a><span> </span><a href="#local-6989586621679045216"><span class="hs-identifier hs-var">input</span></a><span>
</span><a name="line-446"></a><span>          </span><span class="hs-comment">-- hClose performs implicit hFlush, and thus may trigger a SIGPIPE</span><span>
</span><a name="line-447"></a><span>          </span><a href="System.Process.html#ignoreSigPipe"><span class="hs-identifier hs-var">ignoreSigPipe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679045223"><span class="hs-identifier hs-var">inh</span></a><span>
</span><a name="line-448"></a><span>
</span><a name="line-449"></a><span>          </span><span class="hs-comment">-- wait on the output</span><span>
</span><a name="line-450"></a><span>          </span><a href="#local-6989586621679045359"><span class="hs-identifier hs-var">waitOut</span></a><span>
</span><a name="line-451"></a><span>          </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679045224"><span class="hs-identifier hs-var">outh</span></a><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span>        </span><span class="hs-comment">-- wait on the process</span><span>
</span><a name="line-454"></a><span>        </span><a name="local-6989586621679045360"><a href="#local-6989586621679045360"><span class="hs-identifier">ex</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a><span> </span><a href="#local-6989586621679045225"><span class="hs-identifier hs-var">ph</span></a><span>
</span><a name="line-455"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045360"><span class="hs-identifier hs-var">ex</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679045358"><span class="hs-identifier hs-var">output</span></a><span class="hs-special">)</span><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045361"><span class="hs-identifier hs-var">ex</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-458"></a><span>     </span><span class="hs-identifier hs-var">ExitSuccess</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679045362"><span class="hs-identifier hs-var">output</span></a><span>
</span><a name="line-459"></a><span>     </span><span class="hs-identifier hs-var">ExitFailure</span><span> </span><a name="local-6989586621679045363"><a href="#local-6989586621679045363"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.html#processFailedException"><span class="hs-identifier hs-var">processFailedException</span></a><span> </span><span class="hs-string">&quot;readCreateProcess&quot;</span><span> </span><a href="#local-6989586621679045217"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679045218"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679045363"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-460"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-461"></a><span>    </span><a name="local-6989586621679045217"><a href="#local-6989586621679045217"><span class="hs-identifier">cmd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045215"><span class="hs-identifier hs-var">cp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-462"></a><span>            </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-var">CreateProcess</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cmdspec</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#ShellCommand"><span class="hs-identifier hs-var">ShellCommand</span></a><span> </span><a name="local-6989586621679045219"><a href="#local-6989586621679045219"><span class="hs-identifier">sc</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679045219"><span class="hs-identifier hs-var">sc</span></a><span>
</span><a name="line-463"></a><span>            </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-var">CreateProcess</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cmdspec</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#RawCommand"><span class="hs-identifier hs-var">RawCommand</span></a><span> </span><a name="local-6989586621679045220"><a href="#local-6989586621679045220"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679045220"><span class="hs-identifier hs-var">fp</span></a><span>
</span><a name="line-464"></a><span>    </span><a name="local-6989586621679045218"><a href="#local-6989586621679045218"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045215"><span class="hs-identifier hs-var">cp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-465"></a><span>             </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-var">CreateProcess</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cmdspec</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#ShellCommand"><span class="hs-identifier hs-var">ShellCommand</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-466"></a><span>             </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-var">CreateProcess</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cmdspec</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#RawCommand"><span class="hs-identifier hs-var">RawCommand</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679045221"><a href="#local-6989586621679045221"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679045221"><span class="hs-identifier hs-var">args'</span></a><span>
</span><a name="line-467"></a><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span class="hs-comment">-- | @readProcessWithExitCode@ is like @readProcess@ but with two differences:</span><span>
</span><a name="line-470"></a><span class="hs-comment">--</span><span>
</span><a name="line-471"></a><span class="hs-comment">--  * it returns the 'ExitCode' of the process, and does not throw any</span><span>
</span><a name="line-472"></a><span class="hs-comment">--    exception if the code is not 'ExitSuccess'.</span><span>
</span><a name="line-473"></a><span class="hs-comment">--</span><span>
</span><a name="line-474"></a><span class="hs-comment">--  * it reads and returns the output from process' standard error handle,</span><span>
</span><a name="line-475"></a><span class="hs-comment">--    rather than the process inheriting the standard error handle.</span><span>
</span><a name="line-476"></a><span class="hs-comment">--</span><span>
</span><a name="line-477"></a><span class="hs-comment">-- On Unix systems, see 'waitForProcess' for the meaning of exit codes</span><span>
</span><a name="line-478"></a><span class="hs-comment">-- when the process died as the result of a signal.</span><span>
</span><a name="line-479"></a><span class="hs-comment">--</span><span>
</span><a name="line-480"></a><span class="hs-identifier">readProcessWithExitCode</span><span>
</span><a name="line-481"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>                 </span><span class="hs-comment">-- ^ Filename of the executable (see 'RawCommand' for details)</span><span>
</span><a name="line-482"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- ^ any arguments</span><span>
</span><a name="line-483"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>                   </span><span class="hs-comment">-- ^ standard input</span><span>
</span><a name="line-484"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ exitcode, stdout, stderr</span><span>
</span><a name="line-485"></a><a name="readProcessWithExitCode"><a href="System.Process.html#readProcessWithExitCode"><span class="hs-identifier">readProcessWithExitCode</span></a></a><span> </span><a name="local-6989586621679045364"><a href="#local-6989586621679045364"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679045365"><a href="#local-6989586621679045365"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-486"></a><span>    </span><a href="System.Process.html#readCreateProcessWithExitCode"><span class="hs-identifier hs-var">readCreateProcessWithExitCode</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a><span> </span><a href="#local-6989586621679045364"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679045365"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span class="hs-comment">-- | @readCreateProcessWithExitCode@ works exactly like 'readProcessWithExitCode' except that it</span><span>
</span><a name="line-489"></a><span class="hs-comment">-- lets you pass 'CreateProcess' giving better flexibility.</span><span>
</span><a name="line-490"></a><span class="hs-comment">--</span><span>
</span><a name="line-491"></a><span class="hs-comment">-- Note that @Handle@s provided for @std_in@, @std_out@, or @std_err@ via the CreateProcess</span><span>
</span><a name="line-492"></a><span class="hs-comment">-- record will be ignored.</span><span>
</span><a name="line-493"></a><span class="hs-comment">--</span><span>
</span><a name="line-494"></a><span class="hs-comment">-- @since 1.2.3.0</span><span>
</span><a name="line-495"></a><span class="hs-identifier">readCreateProcessWithExitCode</span><span>
</span><a name="line-496"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a><span>
</span><a name="line-497"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>                      </span><span class="hs-comment">-- ^ standard input</span><span>
</span><a name="line-498"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ exitcode, stdout, stderr</span><span>
</span><a name="line-499"></a><a name="readCreateProcessWithExitCode"><a href="System.Process.html#readCreateProcessWithExitCode"><span class="hs-identifier">readCreateProcessWithExitCode</span></a></a><span> </span><a name="local-6989586621679045366"><a href="#local-6989586621679045366"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679045367"><a href="#local-6989586621679045367"><span class="hs-identifier">input</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-500"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679045368"><a href="#local-6989586621679045368"><span class="hs-identifier">cp_opts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045366"><span class="hs-identifier hs-var">cp</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-501"></a><span>                    </span><span class="hs-identifier">std_in</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-var">CreatePipe</span></a><span class="hs-special">,</span><span>
</span><a name="line-502"></a><span>                    </span><span class="hs-identifier">std_out</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-var">CreatePipe</span></a><span class="hs-special">,</span><span>
</span><a name="line-503"></a><span>                    </span><span class="hs-identifier">std_err</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-var">CreatePipe</span></a><span>
</span><a name="line-504"></a><span>                  </span><span class="hs-special">}</span><span>
</span><a name="line-505"></a><span>    </span><a href="System.Process.html#withCreateProcess_"><span class="hs-identifier hs-var">withCreateProcess_</span></a><span> </span><span class="hs-string">&quot;readCreateProcessWithExitCode&quot;</span><span> </span><a href="#local-6989586621679045368"><span class="hs-identifier hs-var">cp_opts</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-506"></a><span>      </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679045369"><a href="#local-6989586621679045369"><span class="hs-identifier">inh</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679045370"><a href="#local-6989586621679045370"><span class="hs-identifier">outh</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679045371"><a href="#local-6989586621679045371"><span class="hs-identifier">errh</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679045372"><a href="#local-6989586621679045372"><span class="hs-identifier">ph</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-507"></a><span>
</span><a name="line-508"></a><span>        </span><a name="local-6989586621679045373"><a href="#local-6989586621679045373"><span class="hs-identifier">out</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">hGetContents</span><span> </span><a href="#local-6989586621679045370"><span class="hs-identifier hs-var">outh</span></a><span>
</span><a name="line-509"></a><span>        </span><a name="local-6989586621679045374"><a href="#local-6989586621679045374"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">hGetContents</span><span> </span><a href="#local-6989586621679045371"><span class="hs-identifier hs-var">errh</span></a><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span>        </span><span class="hs-comment">-- fork off threads to start consuming stdout &amp; stderr</span><span>
</span><a name="line-512"></a><span>        </span><a href="System.Process.html#withForkWait"><span class="hs-identifier hs-var">withForkWait</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">evaluate</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">rnf</span><span> </span><a href="#local-6989586621679045373"><span class="hs-identifier hs-var">out</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045375"><a href="#local-6989586621679045375"><span class="hs-identifier">waitOut</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-513"></a><span>         </span><a href="System.Process.html#withForkWait"><span class="hs-identifier hs-var">withForkWait</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">evaluate</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">rnf</span><span> </span><a href="#local-6989586621679045374"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045376"><a href="#local-6989586621679045376"><span class="hs-identifier">waitErr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-514"></a><span>
</span><a name="line-515"></a><span>          </span><span class="hs-comment">-- now write any input</span><span>
</span><a name="line-516"></a><span>          </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679045367"><span class="hs-identifier hs-var">input</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-517"></a><span>            </span><a href="System.Process.html#ignoreSigPipe"><span class="hs-identifier hs-var">ignoreSigPipe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679045369"><span class="hs-identifier hs-var">inh</span></a><span> </span><a href="#local-6989586621679045367"><span class="hs-identifier hs-var">input</span></a><span>
</span><a name="line-518"></a><span>          </span><span class="hs-comment">-- hClose performs implicit hFlush, and thus may trigger a SIGPIPE</span><span>
</span><a name="line-519"></a><span>          </span><a href="System.Process.html#ignoreSigPipe"><span class="hs-identifier hs-var">ignoreSigPipe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679045369"><span class="hs-identifier hs-var">inh</span></a><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span>          </span><span class="hs-comment">-- wait on the output</span><span>
</span><a name="line-522"></a><span>          </span><a href="#local-6989586621679045375"><span class="hs-identifier hs-var">waitOut</span></a><span>
</span><a name="line-523"></a><span>          </span><a href="#local-6989586621679045376"><span class="hs-identifier hs-var">waitErr</span></a><span>
</span><a name="line-524"></a><span>
</span><a name="line-525"></a><span>          </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679045370"><span class="hs-identifier hs-var">outh</span></a><span>
</span><a name="line-526"></a><span>          </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679045371"><span class="hs-identifier hs-var">errh</span></a><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span>        </span><span class="hs-comment">-- wait on the process</span><span>
</span><a name="line-529"></a><span>        </span><a name="local-6989586621679045377"><a href="#local-6989586621679045377"><span class="hs-identifier">ex</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a><span> </span><a href="#local-6989586621679045372"><span class="hs-identifier hs-var">ph</span></a><span>
</span><a name="line-530"></a><span>
</span><a name="line-531"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045377"><span class="hs-identifier hs-var">ex</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679045373"><span class="hs-identifier hs-var">out</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679045374"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span class="hs-comment">-- | Fork a thread while doing something else, but kill it if there's an</span><span>
</span><a name="line-534"></a><span class="hs-comment">-- exception.</span><span>
</span><a name="line-535"></a><span class="hs-comment">--</span><span>
</span><a name="line-536"></a><span class="hs-comment">-- This is important in the cases above because we want to kill the thread</span><span>
</span><a name="line-537"></a><span class="hs-comment">-- that is holding the Handle lock, because when we clean up the process we</span><span>
</span><a name="line-538"></a><span class="hs-comment">-- try to close that handle, which could otherwise deadlock.</span><span>
</span><a name="line-539"></a><span class="hs-comment">--</span><span>
</span><a name="line-540"></a><span class="hs-identifier">withForkWait</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679044412"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679044412"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-541"></a><a name="withForkWait"><a href="System.Process.html#withForkWait"><span class="hs-identifier">withForkWait</span></a></a><span> </span><a name="local-6989586621679045378"><a href="#local-6989586621679045378"><span class="hs-identifier">async</span></a></a><span> </span><a name="local-6989586621679045379"><a href="#local-6989586621679045379"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-542"></a><span>  </span><a name="local-6989586621679045514"><a href="#local-6989586621679045514"><span class="hs-identifier">waitVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newEmptyMVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">SomeException</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-543"></a><span>  </span><span class="hs-identifier hs-var">mask</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045515"><a href="#local-6989586621679045515"><span class="hs-identifier">restore</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-544"></a><span>    </span><a name="local-6989586621679045516"><a href="#local-6989586621679045516"><span class="hs-identifier">tid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forkIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045515"><span class="hs-identifier hs-var">restore</span></a><span> </span><a href="#local-6989586621679045378"><span class="hs-identifier hs-var">async</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">putMVar</span><span> </span><a href="#local-6989586621679045514"><span class="hs-identifier hs-var">waitVar</span></a><span>
</span><a name="line-545"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679045517"><a href="#local-6989586621679045517"><span class="hs-identifier">wait</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">takeMVar</span><span> </span><a href="#local-6989586621679045514"><span class="hs-identifier hs-var">waitVar</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-identifier hs-var">throwIO</span><span> </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-546"></a><span>    </span><a href="#local-6989586621679045515"><span class="hs-identifier hs-var">restore</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045379"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="#local-6989586621679045517"><span class="hs-identifier hs-var">wait</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">onException</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">killThread</span><span> </span><a href="#local-6989586621679045516"><span class="hs-identifier hs-var">tid</span></a><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span class="hs-identifier">ignoreSigPipe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-549"></a><a name="ignoreSigPipe"><a href="System.Process.html#ignoreSigPipe"><span class="hs-identifier">ignoreSigPipe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">handle</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045518"><a href="#local-6989586621679045518"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045518"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-550"></a><span>                                   </span><span class="hs-identifier hs-var">IOError</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ioe_type</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ResourceVanished</span><span>
</span><a name="line-551"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ioe_errno</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679045519"><a href="#local-6989586621679045519"><span class="hs-identifier">ioe</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-552"></a><span>                                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Errno</span><span> </span><a href="#local-6989586621679045519"><span class="hs-identifier hs-var">ioe</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">ePIPE</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-553"></a><span>                                   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwIO</span><span> </span><a href="#local-6989586621679045518"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-554"></a><span>
</span><a name="line-555"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-556"></a><span class="hs-comment">-- showCommandForUser</span><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span class="hs-comment">-- | Given a program @/p/@ and arguments @/args/@,</span><span>
</span><a name="line-559"></a><span class="hs-comment">--   @showCommandForUser /p/ /args/@ returns a string suitable for pasting</span><span>
</span><a name="line-560"></a><span class="hs-comment">--   into @\/bin\/sh@ (on Unix systems) or @CMD.EXE@ (on Windows).</span><span>
</span><a name="line-561"></a><span class="hs-identifier">showCommandForUser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-562"></a><a name="showCommandForUser"><a href="System.Process.html#showCommandForUser"><span class="hs-identifier">showCommandForUser</span></a></a><span> </span><a name="local-6989586621679045520"><a href="#local-6989586621679045520"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679045521"><a href="#local-6989586621679045521"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="System.Process.Internals.html#translate"><span class="hs-identifier hs-var">translate</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045520"><span class="hs-identifier hs-var">cmd</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679045521"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>
</span><a name="line-564"></a><span>
</span><a name="line-565"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-566"></a><span class="hs-comment">-- waitForProcess</span><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span class="hs-comment">{- | Waits for the specified process to terminate, and returns its exit code.

GHC Note: in order to call @waitForProcess@ without blocking all the
other threads in the system, you must compile the program with
@-threaded@.

(/Since: 1.2.0.0/) On Unix systems, a negative value @'ExitFailure' -/signum/@
indicates that the child was terminated by signal @/signum/@.
The signal numbers are platform-specific, so to test for a specific signal use
the constants provided by &quot;System.Posix.Signals&quot; in the @unix@ package.
Note: core dumps are not reported, use &quot;System.Posix.Process&quot; if you need this
detail.

-}</span><span>
</span><a name="line-582"></a><span class="hs-identifier">waitForProcess</span><span>
</span><a name="line-583"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span>
</span><a name="line-584"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span>
</span><a name="line-585"></a><a name="waitForProcess"><a href="System.Process.html#waitForProcess"><span class="hs-identifier">waitForProcess</span></a></a><span> </span><a name="local-6989586621679045669"><a href="#local-6989586621679045669"><span class="hs-identifier">ph</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-var">ProcessHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679045670"><a href="#local-6989586621679045670"><span class="hs-identifier">delegating_ctlc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045671"><span class="hs-identifier hs-var">lockWaitpid</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-586"></a><span>  </span><a name="local-6989586621679045674"><a href="#local-6989586621679045674"><span class="hs-identifier">p_</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Common.html#modifyProcessHandle"><span class="hs-identifier hs-var">modifyProcessHandle</span></a><span> </span><a href="#local-6989586621679045669"><span class="hs-identifier hs-var">ph</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045673"><a href="#local-6989586621679045673"><span class="hs-identifier">p_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045673"><span class="hs-identifier hs-var">p_</span></a><span class="hs-special">,</span><a href="#local-6989586621679045673"><span class="hs-identifier hs-var">p_</span></a><span class="hs-special">)</span><span>
</span><a name="line-587"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045674"><span class="hs-identifier hs-var">p_</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-588"></a><span>    </span><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span> </span><a name="local-6989586621679045675"><a href="#local-6989586621679045675"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679045675"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-589"></a><span>    </span><a href="System.Process.Common.html#OpenHandle"><span class="hs-identifier hs-var">OpenHandle</span></a><span> </span><a name="local-6989586621679045676"><a href="#local-6989586621679045676"><span class="hs-identifier">h</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-590"></a><span>        </span><a name="local-6989586621679045683"><a href="#local-6989586621679045683"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">alloca</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045677"><a href="#local-6989586621679045677"><span class="hs-identifier">pret</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-591"></a><span>          </span><span class="hs-comment">-- don't hold the MVar while we call c_waitForProcess...</span><span>
</span><a name="line-592"></a><span>          </span><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry_</span><span> </span><span class="hs-string">&quot;waitForProcess&quot;</span><span> </span><span class="hs-special">(</span><a href="System.Process.html#c_waitForProcess"><span class="hs-identifier hs-var">c_waitForProcess</span></a><span> </span><a href="#local-6989586621679045676"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679045677"><span class="hs-identifier hs-var">pret</span></a><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>          </span><a href="System.Process.Common.html#modifyProcessHandle"><span class="hs-identifier hs-var">modifyProcessHandle</span></a><span> </span><a href="#local-6989586621679045669"><span class="hs-identifier hs-var">ph</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045678"><a href="#local-6989586621679045678"><span class="hs-identifier">p_'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-594"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045678"><span class="hs-identifier hs-var">p_'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-595"></a><span>              </span><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span> </span><a name="local-6989586621679045679"><a href="#local-6989586621679045679"><span class="hs-identifier">e</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045678"><span class="hs-identifier hs-var">p_'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679045679"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-596"></a><span>              </span><a href="System.Process.Common.html#OpenExtHandle"><span class="hs-identifier hs-var">OpenExtHandle</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045678"><span class="hs-identifier hs-var">p_'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ExitFailure</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-597"></a><span>              </span><a href="System.Process.Common.html#OpenHandle"><span class="hs-identifier hs-var">OpenHandle</span></a><span> </span><a name="local-6989586621679045680"><a href="#local-6989586621679045680"><span class="hs-identifier">ph'</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-598"></a><span>                </span><a href="System.Process.Posix.html#closePHANDLE"><span class="hs-identifier hs-var">closePHANDLE</span></a><span> </span><a href="#local-6989586621679045680"><span class="hs-identifier hs-var">ph'</span></a><span>
</span><a name="line-599"></a><span>                </span><a name="local-6989586621679045681"><a href="#local-6989586621679045681"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peek</span><span> </span><a href="#local-6989586621679045677"><span class="hs-identifier hs-var">pret</span></a><span>
</span><a name="line-600"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679045682"><a href="#local-6989586621679045682"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045681"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">ExitSuccess</span><span>
</span><a name="line-602"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExitFailure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679045681"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-603"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span> </span><a href="#local-6989586621679045682"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679045682"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-604"></a><span>        </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679045670"><span class="hs-identifier hs-var">delegating_ctlc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-605"></a><span>          </span><a href="System.Process.Posix.html#endDelegateControlC"><span class="hs-identifier hs-var">endDelegateControlC</span></a><span> </span><a href="#local-6989586621679045683"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-606"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679045683"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-607"></a><span class="hs-cpp">#if defined(WINDOWS)</span><span>
</span><a name="line-608"></a><span>    </span><span class="hs-identifier">OpenExtHandle</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">job</span><span> </span><span class="hs-identifier">iocp</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-609"></a><span>        </span><span class="hs-identifier">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ExitFailure</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">mkExitCode</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">waitForJobCompletion</span><span> </span><span class="hs-identifier">job</span><span> </span><span class="hs-identifier">iocp</span><span> </span><span class="hs-identifier">timeout_Infinite</span><span>
</span><a name="line-610"></a><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">mkExitCode</span><span> </span><span class="hs-identifier">code</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">code</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ExitSuccess</span><span>
</span><a name="line-611"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ExitFailure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">code</span><span>
</span><a name="line-612"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-613"></a><span>    </span><a href="System.Process.Common.html#OpenExtHandle"><span class="hs-identifier hs-var">OpenExtHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679045684"><a href="#local-6989586621679045684"><span class="hs-identifier">_job</span></a></a><span> </span><a name="local-6989586621679045685"><a href="#local-6989586621679045685"><span class="hs-identifier">_iocp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-614"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ExitFailure</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-615"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-616"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-617"></a><span>    </span><span class="hs-comment">-- If more than one thread calls `waitpid` at a time, `waitpid` will</span><span>
</span><a name="line-618"></a><span>    </span><span class="hs-comment">-- return the exit code to one of them and (-1) to the rest of them,</span><span>
</span><a name="line-619"></a><span>    </span><span class="hs-comment">-- causing an exception to be thrown.</span><span>
</span><a name="line-620"></a><span>    </span><span class="hs-comment">-- Cf. https://github.com/haskell/process/issues/46, and</span><span>
</span><a name="line-621"></a><span>    </span><span class="hs-comment">-- https://github.com/haskell/process/pull/58 for further discussion</span><span>
</span><a name="line-622"></a><span>    </span><a name="local-6989586621679045671"><a href="#local-6989586621679045671"><span class="hs-identifier">lockWaitpid</span></a></a><span> </span><a name="local-6989586621679045672"><a href="#local-6989586621679045672"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withMVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">waitpidLock</span><span> </span><a href="#local-6989586621679045669"><span class="hs-identifier hs-var">ph</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679045672"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-625"></a><span class="hs-comment">-- getProcessExitCode</span><span>
</span><a name="line-626"></a><span>
</span><a name="line-627"></a><span class="hs-comment">{- |
This is a non-blocking version of 'waitForProcess'.  If the process is
still running, 'Nothing' is returned.  If the process has exited, then
@'Just' e@ is returned where @e@ is the exit code of the process.

On Unix systems, see 'waitForProcess' for the meaning of exit codes
when the process died as the result of a signal.
-}</span><span>
</span><a name="line-635"></a><span>
</span><a name="line-636"></a><span class="hs-identifier">getProcessExitCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">)</span><span>
</span><a name="line-637"></a><a name="getProcessExitCode"><a href="System.Process.html#getProcessExitCode"><span class="hs-identifier">getProcessExitCode</span></a></a><span> </span><a name="local-6989586621679045686"><a href="#local-6989586621679045686"><span class="hs-identifier">ph</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-var">ProcessHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679045687"><a href="#local-6989586621679045687"><span class="hs-identifier">delegating_ctlc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045689"><span class="hs-identifier hs-var">tryLockWaitpid</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-638"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679045706"><a href="#local-6989586621679045706"><span class="hs-identifier">m_e</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679045707"><a href="#local-6989586621679045707"><span class="hs-identifier">was_open</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Common.html#modifyProcessHandle"><span class="hs-identifier hs-var">modifyProcessHandle</span></a><span> </span><a href="#local-6989586621679045686"><span class="hs-identifier hs-var">ph</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045698"><a href="#local-6989586621679045698"><span class="hs-identifier">p_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-639"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045698"><span class="hs-identifier hs-var">p_</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-640"></a><span>      </span><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span> </span><a name="local-6989586621679045699"><a href="#local-6989586621679045699"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045698"><span class="hs-identifier hs-var">p_</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679045699"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span>      </span><a name="local-6989586621679045700"><a href="#local-6989586621679045700"><span class="hs-identifier">open</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-642"></a><span>        </span><span class="hs-identifier hs-var">alloca</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045701"><a href="#local-6989586621679045701"><span class="hs-identifier">pExitCode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-643"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045688"><span class="hs-identifier hs-var">getHandle</span></a><span> </span><a href="#local-6989586621679045700"><span class="hs-identifier hs-var">open</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-644"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045698"><span class="hs-identifier hs-var">p_</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-645"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679045702"><a href="#local-6989586621679045702"><span class="hs-identifier">h</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-646"></a><span>                </span><a name="local-6989586621679045703"><a href="#local-6989586621679045703"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry</span><span> </span><span class="hs-string">&quot;getProcessExitCode&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-647"></a><span>                                        </span><a href="System.Process.html#c_getProcessExitCode"><span class="hs-identifier hs-var">c_getProcessExitCode</span></a><span> </span><a href="#local-6989586621679045702"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679045701"><span class="hs-identifier hs-var">pExitCode</span></a><span>
</span><a name="line-648"></a><span>                </span><a name="local-6989586621679045704"><a href="#local-6989586621679045704"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peek</span><span> </span><a href="#local-6989586621679045701"><span class="hs-identifier hs-var">pExitCode</span></a><span>
</span><a name="line-649"></a><span>                </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679045703"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-650"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679045698"><span class="hs-identifier hs-var">p_</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-652"></a><span>                        </span><a href="System.Process.Posix.html#closePHANDLE"><span class="hs-identifier hs-var">closePHANDLE</span></a><span> </span><a href="#local-6989586621679045702"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-653"></a><span>                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679045705"><a href="#local-6989586621679045705"><span class="hs-identifier">e</span></a></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679045704"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ExitSuccess</span><span>
</span><a name="line-654"></a><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ExitFailure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679045704"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-655"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span> </span><a href="#local-6989586621679045705"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679045705"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-656"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045706"><span class="hs-identifier hs-var">m_e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-657"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679045708"><a href="#local-6989586621679045708"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679045707"><span class="hs-identifier hs-var">was_open</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679045687"><span class="hs-identifier hs-var">delegating_ctlc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Posix.html#endDelegateControlC"><span class="hs-identifier hs-var">endDelegateControlC</span></a><span> </span><a href="#local-6989586621679045708"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-658"></a><span>    </span><span class="hs-identifier">_</span><span>                                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-659"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679045706"><span class="hs-identifier hs-var">m_e</span></a><span>
</span><a name="line-660"></a><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">getHandle</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#ProcessHandle__"><span class="hs-identifier hs-type">ProcessHandle__</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="System.Process.Common.html#PHANDLE"><span class="hs-identifier hs-type">PHANDLE</span></a><span>
</span><a name="line-661"></a><span>          </span><a name="local-6989586621679045688"><a href="#local-6989586621679045688"><span class="hs-identifier">getHandle</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Process.Common.html#OpenHandle"><span class="hs-identifier hs-var">OpenHandle</span></a><span>        </span><a name="local-6989586621679045690"><a href="#local-6989586621679045690"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679045690"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-662"></a><span>          </span><span class="hs-identifier">getHandle</span><span> </span><span class="hs-special">(</span><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>      </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-663"></a><span>          </span><span class="hs-identifier">getHandle</span><span> </span><span class="hs-special">(</span><a href="System.Process.Common.html#OpenExtHandle"><span class="hs-identifier hs-var">OpenExtHandle</span></a><span> </span><a name="local-6989586621679045691"><a href="#local-6989586621679045691"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679045691"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-664"></a><span>
</span><a name="line-665"></a><span>          </span><span class="hs-comment">-- If somebody is currently holding the waitpid lock, we don't want to</span><span>
</span><a name="line-666"></a><span>          </span><span class="hs-comment">-- accidentally remove the pid from the process table.</span><span>
</span><a name="line-667"></a><span>          </span><span class="hs-comment">-- Try acquiring the waitpid lock. If it is held, we are done</span><span>
</span><a name="line-668"></a><span>          </span><span class="hs-comment">-- since that means the process is still running and we can return</span><span>
</span><a name="line-669"></a><span>          </span><span class="hs-comment">-- `Nothing`. If it is not held, acquire it so we can run the</span><span>
</span><a name="line-670"></a><span>          </span><span class="hs-comment">-- (non-blocking) call to `waitpid` without worrying about any</span><span>
</span><a name="line-671"></a><span>          </span><span class="hs-comment">-- other threads calling it at the same time.</span><span>
</span><a name="line-672"></a><span>          </span><span class="hs-identifier">tryLockWaitpid</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">)</span><span>
</span><a name="line-673"></a><span>          </span><a name="local-6989586621679045689"><a href="#local-6989586621679045689"><span class="hs-identifier">tryLockWaitpid</span></a></a><span> </span><a name="local-6989586621679045692"><a href="#local-6989586621679045692"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">bracket</span><span> </span><a href="#local-6989586621679045693"><span class="hs-identifier hs-var">acquire</span></a><span> </span><a href="#local-6989586621679045694"><span class="hs-identifier hs-var">release</span></a><span> </span><a href="#local-6989586621679045695"><span class="hs-identifier hs-var">between</span></a><span>
</span><a name="line-674"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-675"></a><span>              </span><a name="local-6989586621679045693"><a href="#local-6989586621679045693"><span class="hs-identifier">acquire</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tryTakeMVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">waitpidLock</span><span> </span><a href="#local-6989586621679045686"><span class="hs-identifier hs-var">ph</span></a><span class="hs-special">)</span><span>
</span><a name="line-676"></a><span>              </span><a name="local-6989586621679045694"><a href="#local-6989586621679045694"><span class="hs-identifier">release</span></a></a><span> </span><a name="local-6989586621679045696"><a href="#local-6989586621679045696"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045696"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-677"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-678"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">putMVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">waitpidLock</span><span> </span><a href="#local-6989586621679045686"><span class="hs-identifier hs-var">ph</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-679"></a><span>              </span><a name="local-6989586621679045695"><a href="#local-6989586621679045695"><span class="hs-identifier">between</span></a></a><span> </span><a name="local-6989586621679045697"><a href="#local-6989586621679045697"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045697"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-680"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-681"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679045692"><span class="hs-identifier hs-var">action</span></a><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-684"></a><span class="hs-comment">-- terminateProcess</span><span>
</span><a name="line-685"></a><span>
</span><a name="line-686"></a><span class="hs-comment">-- | Attempts to terminate the specified process.  This function should</span><span>
</span><a name="line-687"></a><span class="hs-comment">-- not be used under normal circumstances - no guarantees are given regarding</span><span>
</span><a name="line-688"></a><span class="hs-comment">-- how cleanly the process is terminated.  To check whether the process</span><span>
</span><a name="line-689"></a><span class="hs-comment">-- has indeed terminated, use 'getProcessExitCode'.</span><span>
</span><a name="line-690"></a><span class="hs-comment">--</span><span>
</span><a name="line-691"></a><span class="hs-comment">-- On Unix systems, 'terminateProcess' sends the process the SIGTERM signal.</span><span>
</span><a name="line-692"></a><span class="hs-comment">-- On Windows systems, the Win32 @TerminateProcess@ function is called, passing</span><span>
</span><a name="line-693"></a><span class="hs-comment">-- an exit code of 1.</span><span>
</span><a name="line-694"></a><span class="hs-comment">--</span><span>
</span><a name="line-695"></a><span class="hs-comment">-- Note: on Windows, if the process was a shell command created by</span><span>
</span><a name="line-696"></a><span class="hs-comment">-- 'createProcess' with 'shell', or created by 'runCommand' or</span><span>
</span><a name="line-697"></a><span class="hs-comment">-- 'runInteractiveCommand', then 'terminateProcess' will only</span><span>
</span><a name="line-698"></a><span class="hs-comment">-- terminate the shell, not the command itself.  On Unix systems, both</span><span>
</span><a name="line-699"></a><span class="hs-comment">-- processes are in a process group and will be terminated together.</span><span>
</span><a name="line-700"></a><span>
</span><a name="line-701"></a><span class="hs-identifier">terminateProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-702"></a><a name="terminateProcess"><a href="System.Process.html#terminateProcess"><span class="hs-identifier">terminateProcess</span></a></a><span> </span><a name="local-6989586621679045709"><a href="#local-6989586621679045709"><span class="hs-identifier">ph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-703"></a><span>  </span><a href="System.Process.Common.html#withProcessHandle"><span class="hs-identifier hs-var">withProcessHandle</span></a><span> </span><a href="#local-6989586621679045709"><span class="hs-identifier hs-var">ph</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679045710"><a href="#local-6989586621679045710"><span class="hs-identifier">p_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-704"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679045710"><span class="hs-identifier hs-var">p_</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-705"></a><span>      </span><a href="System.Process.Common.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-706"></a><span class="hs-cpp">#if defined(WINDOWS)</span><span>
</span><a name="line-707"></a><span>      </span><span class="hs-identifier">OpenExtHandle</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">terminateJob</span><span> </span><span class="hs-identifier">ph</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-708"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-709"></a><span>      </span><a href="System.Process.Common.html#OpenExtHandle"><span class="hs-identifier hs-var">OpenExtHandle</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;terminateProcess with OpenExtHandle should not happen on POSIX.&quot;</span><span>
</span><a name="line-710"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-711"></a><span>      </span><a href="System.Process.Common.html#OpenHandle"><span class="hs-identifier hs-var">OpenHandle</span></a><span>    </span><a name="local-6989586621679045725"><a href="#local-6989586621679045725"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-712"></a><span>        </span><span class="hs-identifier hs-var">throwErrnoIfMinus1Retry_</span><span> </span><span class="hs-string">&quot;terminateProcess&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.html#c_terminateProcess"><span class="hs-identifier hs-var">c_terminateProcess</span></a><span> </span><a href="#local-6989586621679045725"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-713"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-714"></a><span>        </span><span class="hs-comment">-- does not close the handle, we might want to try terminating it</span><span>
</span><a name="line-715"></a><span>        </span><span class="hs-comment">-- again, or get its exit code.</span><span>
</span><a name="line-716"></a><span>
</span><a name="line-717"></a><span>
</span><a name="line-718"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-719"></a><span class="hs-comment">-- Interface to C bits</span><span>
</span><a name="line-720"></a><span>
</span><a name="line-721"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;terminateProcess&quot;</span><span>
</span><a name="line-722"></a><span>  </span><span class="hs-identifier">c_terminateProcess</span><span>
</span><a name="line-723"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#PHANDLE"><span class="hs-identifier hs-type">PHANDLE</span></a><span>
</span><a name="line-724"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">CInt</span><span>
</span><a name="line-725"></a><span>
</span><a name="line-726"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-string">&quot;getProcessExitCode&quot;</span><span>
</span><a name="line-727"></a><span>  </span><span class="hs-identifier">c_getProcessExitCode</span><span>
</span><a name="line-728"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#PHANDLE"><span class="hs-identifier hs-type">PHANDLE</span></a><span>
</span><a name="line-729"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">CInt</span><span>
</span><a name="line-730"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">CInt</span><span>
</span><a name="line-731"></a><span>
</span><a name="line-732"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">interruptible</span><span> </span><span class="hs-string">&quot;waitForProcess&quot;</span><span> </span><span class="hs-comment">-- NB. safe - can block</span><span>
</span><a name="line-733"></a><span>  </span><span class="hs-identifier">c_waitForProcess</span><span>
</span><a name="line-734"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Common.html#PHANDLE"><span class="hs-identifier hs-type">PHANDLE</span></a><span>
</span><a name="line-735"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">CInt</span><span>
</span><a name="line-736"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">CInt</span><span>
</span><a name="line-737"></a><span>
</span><a name="line-738"></a><span>
</span><a name="line-739"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-740"></a><span class="hs-comment">-- Old deprecated variants</span><span>
</span><a name="line-741"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-742"></a><span>
</span><a name="line-743"></a><span class="hs-comment">-- TODO: We're not going to mark these functions as DEPRECATED immediately in</span><span>
</span><a name="line-744"></a><span class="hs-comment">-- process-1.2.0.0. That's because some of their replacements have not been</span><span>
</span><a name="line-745"></a><span class="hs-comment">-- around for all that long. But they should eventually be marked with a</span><span>
</span><a name="line-746"></a><span class="hs-comment">-- suitable DEPRECATED pragma after a release or two.</span><span>
</span><a name="line-747"></a><span>
</span><a name="line-748"></a><span>
</span><a name="line-749"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-750"></a><span class="hs-comment">-- runCommand</span><span>
</span><a name="line-751"></a><span>
</span><a name="line-752"></a><span class="hs-comment">--TODO: in a later release {-# DEPRECATED runCommand &quot;Use 'spawnCommand' instead&quot; #-}</span><span>
</span><a name="line-753"></a><span>
</span><a name="line-754"></a><span class="hs-comment">{- | Runs a command using the shell.
 -}</span><span>
</span><a name="line-756"></a><span class="hs-identifier">runCommand</span><span>
</span><a name="line-757"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-758"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span>
</span><a name="line-759"></a><span>
</span><a name="line-760"></a><a name="runCommand"><a href="System.Process.html#runCommand"><span class="hs-identifier">runCommand</span></a></a><span> </span><a name="local-6989586621679045726"><a href="#local-6989586621679045726"><span class="hs-identifier">string</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-761"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679045727"><a href="#local-6989586621679045727"><span class="hs-identifier">ph</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a><span> </span><span class="hs-string">&quot;runCommand&quot;</span><span> </span><span class="hs-special">(</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a><span> </span><a href="#local-6989586621679045726"><span class="hs-identifier hs-var">string</span></a><span class="hs-special">)</span><span>
</span><a name="line-762"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679045727"><span class="hs-identifier hs-var">ph</span></a><span>
</span><a name="line-763"></a><span>
</span><a name="line-764"></a><span>
</span><a name="line-765"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-766"></a><span class="hs-comment">-- runProcess</span><span>
</span><a name="line-767"></a><span>
</span><a name="line-768"></a><span class="hs-comment">--TODO: in a later release {-# DEPRECATED runProcess &quot;Use 'spawnProcess' or 'createProcess' instead&quot; #-}</span><span>
</span><a name="line-769"></a><span>
</span><a name="line-770"></a><span class="hs-comment">{- | Runs a raw command, optionally specifying 'Handle's from which to
     take the @stdin@, @stdout@ and @stderr@ channels for the new
     process (otherwise these handles are inherited from the current
     process).

     Any 'Handle's passed to 'runProcess' are placed immediately in the
     closed state.

     Note: consider using the more general 'createProcess' instead of
     'runProcess'.
-}</span><span>
</span><a name="line-781"></a><span class="hs-identifier">runProcess</span><span>
</span><a name="line-782"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>                   </span><span class="hs-comment">-- ^ Filename of the executable (see 'RawCommand' for details)</span><span>
</span><a name="line-783"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>                   </span><span class="hs-comment">-- ^ Arguments to pass to the executable</span><span>
</span><a name="line-784"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>             </span><span class="hs-comment">-- ^ Optional path to the working directory</span><span>
</span><a name="line-785"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ Optional environment (otherwise inherit)</span><span>
</span><a name="line-786"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span>               </span><span class="hs-comment">-- ^ Handle to use for @stdin@ (Nothing =&gt; use existing @stdin@)</span><span>
</span><a name="line-787"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span>               </span><span class="hs-comment">-- ^ Handle to use for @stdout@ (Nothing =&gt; use existing @stdout@)</span><span>
</span><a name="line-788"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span>               </span><span class="hs-comment">-- ^ Handle to use for @stderr@ (Nothing =&gt; use existing @stderr@)</span><span>
</span><a name="line-789"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span>
</span><a name="line-790"></a><span>
</span><a name="line-791"></a><a name="runProcess"><a href="System.Process.html#runProcess"><span class="hs-identifier">runProcess</span></a></a><span> </span><a name="local-6989586621679045728"><a href="#local-6989586621679045728"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679045729"><a href="#local-6989586621679045729"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679045730"><a href="#local-6989586621679045730"><span class="hs-identifier">mb_cwd</span></a></a><span> </span><a name="local-6989586621679045731"><a href="#local-6989586621679045731"><span class="hs-identifier">mb_env</span></a></a><span> </span><a name="local-6989586621679045732"><a href="#local-6989586621679045732"><span class="hs-identifier">mb_stdin</span></a></a><span> </span><a name="local-6989586621679045733"><a href="#local-6989586621679045733"><span class="hs-identifier">mb_stdout</span></a></a><span> </span><a name="local-6989586621679045734"><a href="#local-6989586621679045734"><span class="hs-identifier">mb_stderr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-792"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679045739"><a href="#local-6989586621679045739"><span class="hs-identifier">ph</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-793"></a><span>      </span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a><span> </span><span class="hs-string">&quot;runProcess&quot;</span><span>
</span><a name="line-794"></a><span>         </span><span class="hs-special">(</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a><span> </span><a href="#local-6989586621679045728"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679045729"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cwd</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045730"><span class="hs-identifier hs-var">mb_cwd</span></a><span class="hs-special">,</span><span>
</span><a name="line-795"></a><span>                          </span><span class="hs-identifier">env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045731"><span class="hs-identifier hs-var">mb_env</span></a><span class="hs-special">,</span><span>
</span><a name="line-796"></a><span>                          </span><span class="hs-identifier">std_in</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045736"><span class="hs-identifier hs-var">mbToStd</span></a><span> </span><a href="#local-6989586621679045732"><span class="hs-identifier hs-var">mb_stdin</span></a><span class="hs-special">,</span><span>
</span><a name="line-797"></a><span>                          </span><span class="hs-identifier">std_out</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045736"><span class="hs-identifier hs-var">mbToStd</span></a><span> </span><a href="#local-6989586621679045733"><span class="hs-identifier hs-var">mb_stdout</span></a><span class="hs-special">,</span><span>
</span><a name="line-798"></a><span>                          </span><span class="hs-identifier">std_err</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045736"><span class="hs-identifier hs-var">mbToStd</span></a><span> </span><a href="#local-6989586621679045734"><span class="hs-identifier hs-var">mb_stderr</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-799"></a><span>  </span><a href="#local-6989586621679045735"><span class="hs-identifier hs-var">maybeClose</span></a><span> </span><a href="#local-6989586621679045732"><span class="hs-identifier hs-var">mb_stdin</span></a><span>
</span><a name="line-800"></a><span>  </span><a href="#local-6989586621679045735"><span class="hs-identifier hs-var">maybeClose</span></a><span> </span><a href="#local-6989586621679045733"><span class="hs-identifier hs-var">mb_stdout</span></a><span>
</span><a name="line-801"></a><span>  </span><a href="#local-6989586621679045735"><span class="hs-identifier hs-var">maybeClose</span></a><span> </span><a href="#local-6989586621679045734"><span class="hs-identifier hs-var">mb_stderr</span></a><span>
</span><a name="line-802"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679045739"><span class="hs-identifier hs-var">ph</span></a><span>
</span><a name="line-803"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-804"></a><span>  </span><span class="hs-identifier">maybeClose</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-805"></a><span>  </span><a name="local-6989586621679045735"><a href="#local-6989586621679045735"><span class="hs-identifier">maybeClose</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span>  </span><a name="local-6989586621679045737"><a href="#local-6989586621679045737"><span class="hs-identifier">hdl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-806"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679045737"><span class="hs-identifier hs-var">hdl</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">stdin</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679045737"><span class="hs-identifier hs-var">hdl</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">stdout</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679045737"><span class="hs-identifier hs-var">hdl</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">stderr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679045737"><span class="hs-identifier hs-var">hdl</span></a><span>
</span><a name="line-807"></a><span>  </span><span class="hs-identifier">maybeClose</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-808"></a><span>
</span><a name="line-809"></a><span>  </span><span class="hs-identifier">mbToStd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Common.html#StdStream"><span class="hs-identifier hs-type">StdStream</span></a><span>
</span><a name="line-810"></a><span>  </span><a name="local-6989586621679045736"><a href="#local-6989586621679045736"><span class="hs-identifier">mbToStd</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#Inherit"><span class="hs-identifier hs-var">Inherit</span></a><span>
</span><a name="line-811"></a><span>  </span><span class="hs-identifier">mbToStd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679045738"><a href="#local-6989586621679045738"><span class="hs-identifier">hdl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#UseHandle"><span class="hs-identifier hs-var">UseHandle</span></a><span> </span><a href="#local-6989586621679045738"><span class="hs-identifier hs-var">hdl</span></a><span>
</span><a name="line-812"></a><span>
</span><a name="line-813"></a><span>
</span><a name="line-814"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-815"></a><span class="hs-comment">-- runInteractiveCommand</span><span>
</span><a name="line-816"></a><span>
</span><a name="line-817"></a><span class="hs-comment">--TODO: in a later release {-# DEPRECATED runInteractiveCommand &quot;Use 'createProcess' instead&quot; #-}</span><span>
</span><a name="line-818"></a><span>
</span><a name="line-819"></a><span class="hs-comment">{- | Runs a command using the shell, and returns 'Handle's that may
     be used to communicate with the process via its @stdin@, @stdout@,
     and @stderr@ respectively.
-}</span><span>
</span><a name="line-823"></a><span class="hs-identifier">runInteractiveCommand</span><span>
</span><a name="line-824"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-825"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span class="hs-special">)</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><a name="runInteractiveCommand"><a href="System.Process.html#runInteractiveCommand"><span class="hs-identifier">runInteractiveCommand</span></a></a><span> </span><a name="local-6989586621679045740"><a href="#local-6989586621679045740"><span class="hs-identifier">string</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-828"></a><span>  </span><a href="System.Process.html#runInteractiveProcess1"><span class="hs-identifier hs-var">runInteractiveProcess1</span></a><span> </span><span class="hs-string">&quot;runInteractiveCommand&quot;</span><span> </span><span class="hs-special">(</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a><span> </span><a href="#local-6989586621679045740"><span class="hs-identifier hs-var">string</span></a><span class="hs-special">)</span><span>
</span><a name="line-829"></a><span>
</span><a name="line-830"></a><span>
</span><a name="line-831"></a><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><a name="line-832"></a><span class="hs-comment">-- runInteractiveProcess</span><span>
</span><a name="line-833"></a><span>
</span><a name="line-834"></a><span class="hs-comment">--TODO: in a later release {-# DEPRECATED runInteractiveCommand &quot;Use 'createProcess' instead&quot; #-}</span><span>
</span><a name="line-835"></a><span>
</span><a name="line-836"></a><span class="hs-comment">{- | Runs a raw command, and returns 'Handle's that may be used to communicate
     with the process via its @stdin@, @stdout@ and @stderr@ respectively.

    For example, to start a process and feed a string to its stdin:

&gt;   (inp,out,err,pid) &lt;- runInteractiveProcess &quot;...&quot;
&gt;   forkIO (hPutStr inp str)
-}</span><span>
</span><a name="line-844"></a><span class="hs-identifier">runInteractiveProcess</span><span>
</span><a name="line-845"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>                   </span><span class="hs-comment">-- ^ Filename of the executable (see 'RawCommand' for details)</span><span>
</span><a name="line-846"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>                   </span><span class="hs-comment">-- ^ Arguments to pass to the executable</span><span>
</span><a name="line-847"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>             </span><span class="hs-comment">-- ^ Optional path to the working directory</span><span>
</span><a name="line-848"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ Optional environment (otherwise inherit)</span><span>
</span><a name="line-849"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span class="hs-special">)</span><span>
</span><a name="line-850"></a><span>
</span><a name="line-851"></a><a name="runInteractiveProcess"><a href="System.Process.html#runInteractiveProcess"><span class="hs-identifier">runInteractiveProcess</span></a></a><span> </span><a name="local-6989586621679045741"><a href="#local-6989586621679045741"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679045742"><a href="#local-6989586621679045742"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679045743"><a href="#local-6989586621679045743"><span class="hs-identifier">mb_cwd</span></a></a><span> </span><a name="local-6989586621679045744"><a href="#local-6989586621679045744"><span class="hs-identifier">mb_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-852"></a><span>  </span><a href="System.Process.html#runInteractiveProcess1"><span class="hs-identifier hs-var">runInteractiveProcess1</span></a><span> </span><span class="hs-string">&quot;runInteractiveProcess&quot;</span><span>
</span><a name="line-853"></a><span>        </span><span class="hs-special">(</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a><span> </span><a href="#local-6989586621679045741"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679045742"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cwd</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045743"><span class="hs-identifier hs-var">mb_cwd</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679045744"><span class="hs-identifier hs-var">mb_env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-854"></a><span>
</span><a name="line-855"></a><span class="hs-identifier">runInteractiveProcess1</span><span>
</span><a name="line-856"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-857"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Common.html#CreateProcess"><span class="hs-identifier hs-type">CreateProcess</span></a><span>
</span><a name="line-858"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><a href="System.Process.Common.html#ProcessHandle"><span class="hs-identifier hs-type">ProcessHandle</span></a><span class="hs-special">)</span><span>
</span><a name="line-859"></a><a name="runInteractiveProcess1"><a href="System.Process.html#runInteractiveProcess1"><span class="hs-identifier">runInteractiveProcess1</span></a></a><span> </span><a name="local-6989586621679045745"><a href="#local-6989586621679045745"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621679045746"><a href="#local-6989586621679045746"><span class="hs-identifier">cmd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-860"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679045747"><a href="#local-6989586621679045747"><span class="hs-identifier">mb_in</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679045748"><a href="#local-6989586621679045748"><span class="hs-identifier">mb_out</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679045749"><a href="#local-6989586621679045749"><span class="hs-identifier">mb_err</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679045750"><a href="#local-6989586621679045750"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-861"></a><span>      </span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a><span> </span><a href="#local-6989586621679045745"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-862"></a><span>           </span><a href="#local-6989586621679045746"><span class="hs-identifier hs-var">cmd</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">std_in</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-var">CreatePipe</span></a><span class="hs-special">,</span><span>
</span><a name="line-863"></a><span>                </span><span class="hs-identifier">std_out</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-var">CreatePipe</span></a><span class="hs-special">,</span><span>
</span><a name="line-864"></a><span>                </span><span class="hs-identifier">std_err</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Common.html#CreatePipe"><span class="hs-identifier hs-var">CreatePipe</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-865"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679045747"><span class="hs-identifier hs-var">mb_in</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679045748"><span class="hs-identifier hs-var">mb_out</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679045749"><span class="hs-identifier hs-var">mb_err</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679045750"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-866"></a><span>
</span><a name="line-867"></a><span>
</span><a name="line-868"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-869"></a><span class="hs-comment">-- system &amp; rawSystem</span><span>
</span><a name="line-870"></a><span>
</span><a name="line-871"></a><span class="hs-comment">--TODO: in a later release {-# DEPRECATED system &quot;Use 'callCommand' (or 'spawnCommand' and 'waitForProcess') instead&quot; #-}</span><span>
</span><a name="line-872"></a><span>
</span><a name="line-873"></a><span class="hs-comment">{-|
Computation @system cmd@ returns the exit code produced when the
operating system runs the shell command @cmd@.

This computation may fail with one of the following
'System.IO.Error.IOErrorType' exceptions:

[@PermissionDenied@]
The process has insufficient privileges to perform the operation.

[@ResourceExhausted@]
Insufficient resources are available to perform the operation.

[@UnsupportedOperation@]
The implementation does not support system calls.

On Windows, 'system' passes the command to the Windows command
interpreter (@CMD.EXE@ or @COMMAND.COM@), hence Unixy shell tricks
will not work.

On Unix systems, see 'waitForProcess' for the meaning of exit codes
when the process died as the result of a signal.
-}</span><span>
</span><a name="line-896"></a><span class="hs-identifier">system</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span>
</span><a name="line-897"></a><a name="system"><a href="System.Process.html#system"><span class="hs-identifier">system</span></a></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ioException</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ioeSetErrorString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkIOError</span><span> </span><span class="hs-identifier hs-var">InvalidArgument</span><span> </span><span class="hs-string">&quot;system&quot;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;null command&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-898"></a><span class="hs-identifier">system</span><span> </span><a name="local-6989586621679045751"><a href="#local-6989586621679045751"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-899"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679045752"><a href="#local-6989586621679045752"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a><span> </span><span class="hs-string">&quot;system&quot;</span><span> </span><span class="hs-special">(</span><a href="System.Process.html#shell"><span class="hs-identifier hs-var">shell</span></a><span> </span><a href="#local-6989586621679045751"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delegate_ctlc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-900"></a><span>  </span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a><span> </span><a href="#local-6989586621679045752"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-901"></a><span>
</span><a name="line-902"></a><span>
</span><a name="line-903"></a><span class="hs-comment">--TODO: in a later release {-# DEPRECATED rawSystem &quot;Use 'callProcess' (or 'spawnProcess' and 'waitForProcess') instead&quot; #-}</span><span>
</span><a name="line-904"></a><span>
</span><a name="line-905"></a><span class="hs-comment">{-|
The computation @'rawSystem' /cmd/ /args/@ runs the operating system command
@/cmd/@ in such a way that it receives as arguments the @/args/@ strings
exactly as given, with no funny escaping or shell meta-syntax expansion.
It will therefore behave more portably between operating systems than 'system'.

The return codes and possible failures are the same as for 'system'.
-}</span><span>
</span><a name="line-913"></a><span class="hs-identifier">rawSystem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span>
</span><a name="line-914"></a><a name="rawSystem"><a href="System.Process.html#rawSystem"><span class="hs-identifier">rawSystem</span></a></a><span> </span><a name="local-6989586621679045753"><a href="#local-6989586621679045753"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679045754"><a href="#local-6989586621679045754"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-915"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679045755"><a href="#local-6989586621679045755"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Internals.html#createProcess_"><span class="hs-identifier hs-var">createProcess_</span></a><span> </span><span class="hs-string">&quot;rawSystem&quot;</span><span> </span><span class="hs-special">(</span><a href="System.Process.html#proc"><span class="hs-identifier hs-var">proc</span></a><span> </span><a href="#local-6989586621679045753"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679045754"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">delegate_ctlc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-916"></a><span>  </span><a href="System.Process.html#waitForProcess"><span class="hs-identifier hs-var">waitForProcess</span></a><span> </span><a href="#local-6989586621679045755"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-917"></a></pre></body></html>