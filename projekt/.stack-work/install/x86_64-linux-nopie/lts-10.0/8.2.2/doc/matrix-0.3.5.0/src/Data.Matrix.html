<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><a name="line-2"></a><span class="hs-comment">-- | Matrix datatype and operations.</span><span>
</span><a name="line-3"></a><span class="hs-comment">--</span><span>
</span><a name="line-4"></a><span class="hs-comment">--   Every provided example has been tested.</span><span>
</span><a name="line-5"></a><span class="hs-comment">--   Run @cabal test@ for further tests.</span><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Matrix</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-7"></a><span>    </span><span class="hs-comment">-- * Matrix type</span><span>
</span><a name="line-8"></a><span>    </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#prettyMatrix"><span class="hs-identifier hs-var">prettyMatrix</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#nrows"><span class="hs-identifier hs-var">nrows</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#ncols"><span class="hs-identifier hs-var">ncols</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#forceMatrix"><span class="hs-identifier hs-var">forceMatrix</span></a><span>
</span><a name="line-11"></a><span>    </span><span class="hs-comment">-- * Builders</span><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#rowVector"><span class="hs-identifier hs-var">rowVector</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#colVector"><span class="hs-identifier hs-var">colVector</span></a><span>
</span><a name="line-15"></a><span>    </span><span class="hs-comment">-- ** Special matrices</span><span>
</span><a name="line-16"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#identity"><span class="hs-identifier hs-var">identity</span></a><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#diagonalList"><span class="hs-identifier hs-var">diagonalList</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#diagonal"><span class="hs-identifier hs-var">diagonal</span></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#permMatrix"><span class="hs-identifier hs-var">permMatrix</span></a><span>
</span><a name="line-21"></a><span>    </span><span class="hs-comment">-- * List conversions</span><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#fromLists"><span class="hs-identifier hs-var">fromLists</span></a><span>
</span><a name="line-23"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#toList"><span class="hs-identifier hs-var">toList</span></a><span>   </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#toLists"><span class="hs-identifier hs-var">toLists</span></a><span>
</span><a name="line-24"></a><span>    </span><span class="hs-comment">-- * Accessing</span><span>
</span><a name="line-25"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#getElem"><span class="hs-identifier hs-var">getElem</span></a><span> </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#safeGet"><span class="hs-identifier hs-var">safeGet</span></a><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#safeSet"><span class="hs-identifier hs-var">safeSet</span></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#getRow"><span class="hs-identifier hs-var">getRow</span></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#getCol"><span class="hs-identifier hs-var">getCol</span></a><span>
</span><a name="line-27"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#getDiag"><span class="hs-identifier hs-var">getDiag</span></a><span>
</span><a name="line-28"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#getMatrixAsVector"><span class="hs-identifier hs-var">getMatrixAsVector</span></a><span>
</span><a name="line-29"></a><span>    </span><span class="hs-comment">-- * Manipulating matrices</span><span>
</span><a name="line-30"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#setElem"><span class="hs-identifier hs-var">setElem</span></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#unsafeSet"><span class="hs-identifier hs-var">unsafeSet</span></a><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#transpose"><span class="hs-identifier hs-var">transpose</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#setSize"><span class="hs-identifier hs-var">setSize</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#extendTo"><span class="hs-identifier hs-var">extendTo</span></a><span>
</span><a name="line-33"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#inverse"><span class="hs-identifier hs-var">inverse</span></a><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#rref"><span class="hs-identifier hs-var">rref</span></a><span>
</span><a name="line-34"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#mapRow"><span class="hs-identifier hs-var">mapRow</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#mapCol"><span class="hs-identifier hs-var">mapCol</span></a><span>
</span><a name="line-35"></a><span>    </span><span class="hs-comment">-- * Submatrices</span><span>
</span><a name="line-36"></a><span>    </span><span class="hs-comment">-- ** Splitting blocks</span><span>
</span><a name="line-37"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#minorMatrix"><span class="hs-identifier hs-var">minorMatrix</span></a><span>
</span><a name="line-39"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#splitBlocks"><span class="hs-identifier hs-var">splitBlocks</span></a><span>
</span><a name="line-40"></a><span>   </span><span class="hs-comment">-- ** Joining blocks</span><span>
</span><a name="line-41"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#%3C-%3E"><span class="hs-operator hs-var">&lt;-&gt;</span></a><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#joinBlocks"><span class="hs-identifier hs-var">joinBlocks</span></a><span>
</span><a name="line-43"></a><span>    </span><span class="hs-comment">-- * Matrix operations</span><span>
</span><a name="line-44"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#elementwise"><span class="hs-identifier hs-var">elementwise</span></a><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#elementwiseUnsafe"><span class="hs-identifier hs-var">elementwiseUnsafe</span></a><span>
</span><a name="line-45"></a><span>    </span><span class="hs-comment">-- * Matrix multiplication</span><span>
</span><a name="line-46"></a><span>    </span><span class="hs-comment">-- ** About matrix multiplication</span><span>
</span><a name="line-47"></a><span>    </span><span class="hs-comment">-- $mult</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span>    </span><span class="hs-comment">-- ** Functions</span><span>
</span><a name="line-50"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#multStd"><span class="hs-identifier hs-var">multStd</span></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#multStd2"><span class="hs-identifier hs-var">multStd2</span></a><span>
</span><a name="line-52"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#multStrassen"><span class="hs-identifier hs-var">multStrassen</span></a><span>
</span><a name="line-53"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#multStrassenMixed"><span class="hs-identifier hs-var">multStrassenMixed</span></a><span>
</span><a name="line-54"></a><span>    </span><span class="hs-comment">-- * Linear transformations</span><span>
</span><a name="line-55"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#scaleMatrix"><span class="hs-identifier hs-var">scaleMatrix</span></a><span>
</span><a name="line-56"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#scaleRow"><span class="hs-identifier hs-var">scaleRow</span></a><span>
</span><a name="line-57"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#combineRows"><span class="hs-identifier hs-var">combineRows</span></a><span>
</span><a name="line-58"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#switchRows"><span class="hs-identifier hs-var">switchRows</span></a><span>
</span><a name="line-59"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#switchCols"><span class="hs-identifier hs-var">switchCols</span></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-comment">-- * Decompositions</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#luDecomp"><span class="hs-identifier hs-var">luDecomp</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#luDecompUnsafe"><span class="hs-identifier hs-var">luDecompUnsafe</span></a><span>
</span><a name="line-62"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#luDecomp%27"><span class="hs-identifier hs-var">luDecomp'</span></a><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#luDecompUnsafe%27"><span class="hs-identifier hs-var">luDecompUnsafe'</span></a><span>
</span><a name="line-63"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#cholDecomp"><span class="hs-identifier hs-var">cholDecomp</span></a><span>
</span><a name="line-64"></a><span>    </span><span class="hs-comment">-- * Properties</span><span>
</span><a name="line-65"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#trace"><span class="hs-identifier hs-var">trace</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#diagProd"><span class="hs-identifier hs-var">diagProd</span></a><span>
</span><a name="line-66"></a><span>    </span><span class="hs-comment">-- ** Determinants</span><span>
</span><a name="line-67"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#detLaplace"><span class="hs-identifier hs-var">detLaplace</span></a><span>
</span><a name="line-68"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#detLU"><span class="hs-identifier hs-var">detLU</span></a><span>
</span><a name="line-69"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#flatten"><span class="hs-identifier hs-var">flatten</span></a><span>
</span><a name="line-70"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl1</span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span class="hs-comment">-- Classes</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">DeepSeq</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">forM_</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Loop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">numLoop</span><span class="hs-special">,</span><span class="hs-identifier hs-var">numLoopFold</span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">foldl1</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Traversable</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Applicative</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;$&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pure</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span class="hs-comment">-- Data</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Primitive</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PrimMonad</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">PrimState</span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maximumBy</span><span class="hs-special">,</span><span class="hs-identifier hs-var">foldl1'</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Ord</span><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comparing</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">V</span><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span class="hs-operator">.</span><span class="hs-identifier">Mutable</span><span>     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MV</span><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-91"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-92"></a><span class="hs-comment">---- MATRIX TYPE</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-identifier">encode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-95"></a><span class="hs-pragma">{-# INLINE encode #-}</span><span>
</span><a name="line-96"></a><a name="encode"><a href="Data.Matrix.html#encode"><span class="hs-identifier">encode</span></a></a><span> </span><a name="local-6989586621679031672"><a href="#local-6989586621679031672"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679031673"><a href="#local-6989586621679031673"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679031674"><a href="#local-6989586621679031674"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031673"><span class="hs-identifier hs-var">i</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-operator hs-var">*</span><a href="#local-6989586621679031672"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679031674"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-identifier">decode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span class="hs-pragma">{-# INLINE decode #-}</span><span>
</span><a name="line-100"></a><a name="decode"><a href="Data.Matrix.html#decode"><span class="hs-identifier">decode</span></a></a><span> </span><a name="local-6989586621679031675"><a href="#local-6989586621679031675"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679031676"><a href="#local-6989586621679031676"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031677"><span class="hs-identifier hs-var">q</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">,</span><a href="#local-6989586621679031678"><span class="hs-identifier hs-var">r</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-102"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679031677"><a href="#local-6989586621679031677"><span class="hs-identifier">q</span></a></a><span class="hs-special">,</span><a name="local-6989586621679031678"><a href="#local-6989586621679031678"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">quotRem</span><span> </span><a href="#local-6989586621679031676"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679031675"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">-- | Type of matrices.</span><span>
</span><a name="line-105"></a><span class="hs-comment">--</span><span>
</span><a name="line-106"></a><span class="hs-comment">--   Elements can be of any type. Rows and columns</span><span>
</span><a name="line-107"></a><span class="hs-comment">--   are indexed starting by 1. This means that, if @m :: Matrix a@ and</span><span>
</span><a name="line-108"></a><span class="hs-comment">--   @i,j :: Int@, then @m ! (i,j)@ is the element in the @i@-th row and</span><span>
</span><a name="line-109"></a><span class="hs-comment">--   @j@-th column of @m@.</span><span>
</span><a name="line-110"></a><span class="hs-keyword">data</span><span> </span><a name="Matrix"><a href="Data.Matrix.html#Matrix"><span class="hs-identifier">Matrix</span></a></a><span> </span><a name="local-6989586621679029070"><a href="#local-6989586621679029070"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="M"><a href="Data.Matrix.html#M"><span class="hs-identifier">M</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-111"></a><span>   </span><a name="nrows"><a href="Data.Matrix.html#nrows"><span class="hs-identifier">nrows</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Number of rows.</span><span>
</span><a name="line-112"></a><span> </span><span class="hs-special">,</span><span> </span><a name="ncols"><a href="Data.Matrix.html#ncols"><span class="hs-identifier">ncols</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Number of columns.</span><span>
</span><a name="line-113"></a><span> </span><span class="hs-special">,</span><span> </span><a name="rowOffset"><a href="Data.Matrix.html#rowOffset"><span class="hs-identifier">rowOffset</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-114"></a><span> </span><span class="hs-special">,</span><span> </span><a name="colOffset"><a href="Data.Matrix.html#colOffset"><span class="hs-identifier">colOffset</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-115"></a><span> </span><span class="hs-special">,</span><span> </span><a name="vcols"><a href="Data.Matrix.html#vcols"><span class="hs-identifier">vcols</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Number of columns of the matrix without offset</span><span>
</span><a name="line-116"></a><span> </span><span class="hs-special">,</span><span> </span><a name="mvect"><a href="Data.Matrix.html#mvect"><span class="hs-identifier">mvect</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="#local-6989586621679029070"><span class="hs-identifier hs-type">a</span></a><span>          </span><span class="hs-comment">-- ^ Content of the matrix as a plain vector.</span><span>
</span><a name="line-117"></a><span>   </span><span class="hs-special">}</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679031452"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031452"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-120"></a><span>  </span><a name="local-6989586621679031453"><a href="#local-6989586621679031453"><span class="hs-identifier">m1</span></a></a><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a name="local-6989586621679031454"><a href="#local-6989586621679031454"><span class="hs-identifier">m2</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-121"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679031455"><a href="#local-6989586621679031455"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679031453"><span class="hs-identifier hs-var">m1</span></a><span>
</span><a name="line-122"></a><span>        </span><a name="local-6989586621679031456"><a href="#local-6989586621679031456"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679031453"><span class="hs-identifier hs-var">m1</span></a><span>
</span><a name="line-123"></a><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">and</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031455"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679031454"><span class="hs-identifier hs-var">m2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031456"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679031454"><span class="hs-identifier hs-var">m2</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>            </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679031453"><span class="hs-identifier hs-var">m1</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031457"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679031458"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679031454"><span class="hs-identifier hs-var">m2</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031457"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679031458"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679031457"><a href="#local-6989586621679031457"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679031455"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679031458"><a href="#local-6989586621679031458"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679031456"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-comment">-- | Just a cool way to output the size of a matrix.</span><span>
</span><a name="line-127"></a><span class="hs-identifier">sizeStr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-128"></a><a name="sizeStr"><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier">sizeStr</span></a></a><span> </span><a name="local-6989586621679031679"><a href="#local-6989586621679031679"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679031680"><a href="#local-6989586621679031680"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679031679"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;x&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679031680"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-comment">-- | Display a matrix as a 'String' using the 'Show' instance of its elements.</span><span>
</span><a name="line-131"></a><span class="hs-identifier">prettyMatrix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679031671"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031671"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-132"></a><a name="prettyMatrix"><a href="Data.Matrix.html#prettyMatrix"><span class="hs-identifier">prettyMatrix</span></a></a><span> </span><a name="local-6989586621679031681"><a href="#local-6989586621679031681"><span class="hs-identifier">m</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679031682"><a href="#local-6989586621679031682"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unlines</span><span>
</span><a name="line-133"></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;( &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679032012"><a href="#local-6989586621679032012"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031684"><span class="hs-identifier hs-var">fill</span></a><span> </span><a href="#local-6989586621679031683"><span class="hs-identifier hs-var">mx</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679031681"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032011"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032012"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679031681"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot; )&quot;</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032011"><a href="#local-6989586621679032011"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679031681"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-134"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-135"></a><span>  </span><a name="local-6989586621679031683"><a href="#local-6989586621679031683"><span class="hs-identifier">mx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">maximum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679031682"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-136"></a><span>  </span><a name="local-6989586621679031684"><a href="#local-6989586621679031684"><span class="hs-identifier">fill</span></a></a><span> </span><a name="local-6989586621679031685"><a href="#local-6989586621679031685"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679031686"><a href="#local-6989586621679031686"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031685"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679031686"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span> </span><span class="hs-char">' '</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679031686"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679031451"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031451"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-139"></a><span> </span><a name="local-8214565720323790231"><span class="hs-identifier">show</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#prettyMatrix"><span class="hs-identifier hs-var">prettyMatrix</span></a><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="#local-6989586621679031450"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031450"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-142"></a><span> </span><a name="local-8214565720323790561"><span class="hs-identifier">rnf</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">rnf</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">mvect</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-comment">-- | /O(rows*cols)/. Similar to 'V.force'. It copies the matrix content</span><span>
</span><a name="line-145"></a><span class="hs-comment">--   dropping any extra memory.</span><span>
</span><a name="line-146"></a><span class="hs-comment">--</span><span>
</span><a name="line-147"></a><span class="hs-comment">--   Useful when using 'submatrix' from a big matrix.</span><span>
</span><a name="line-148"></a><span class="hs-comment">--</span><span>
</span><a name="line-149"></a><span class="hs-identifier">forceMatrix</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031670"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031670"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-150"></a><a name="forceMatrix"><a href="Data.Matrix.html#forceMatrix"><span class="hs-identifier">forceMatrix</span></a></a><span> </span><a name="local-6989586621679032013"><a href="#local-6989586621679032013"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032013"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032013"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032014"><a href="#local-6989586621679032014"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032015"><a href="#local-6989586621679032015"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032014"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032015"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032013"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-153"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-154"></a><span class="hs-comment">---- FUNCTOR INSTANCE</span><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-157"></a><span> </span><span class="hs-pragma">{-# INLINE fmap #-}</span><span>
</span><a name="line-158"></a><span> </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-6989586621679031443"><a href="#local-6989586621679031443"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679031444"><a href="#local-6989586621679031444"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679031445"><a href="#local-6989586621679031445"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679031446"><a href="#local-6989586621679031446"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679031447"><a href="#local-6989586621679031447"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679031448"><a href="#local-6989586621679031448"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679031449"><a href="#local-6989586621679031449"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a href="#local-6989586621679031444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679031445"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679031446"><span class="hs-identifier hs-var">ro</span></a><span> </span><a href="#local-6989586621679031447"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679031448"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679031443"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679031449"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-161"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-164"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-165"></a><span class="hs-comment">---- MONOID INSTANCE</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="#local-6989586621679031422"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031422"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-168"></a><span>  </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">]</span><span> </span><span>
</span><a name="line-169"></a><span>  </span><a name="local-3458764513820541484"><span class="hs-identifier">mappend</span></a><span> </span><a name="local-6989586621679031423"><a href="#local-6989586621679031423"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679031424"><a href="#local-6989586621679031424"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679031423"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679031424"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679031423"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679031424"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><a href="#local-6989586621679031425"><span class="hs-identifier hs-var">zipTogether</span></a><span>
</span><a name="line-170"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679031425"><a href="#local-6989586621679031425"><span class="hs-identifier">zipTogether</span></a></a><span> </span><a name="local-6989586621679031426"><a href="#local-6989586621679031426"><span class="hs-identifier">row</span></a></a><span> </span><a name="local-6989586621679031427"><a href="#local-6989586621679031427"><span class="hs-identifier">column</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Matrix.html#safeGet"><span class="hs-identifier hs-var">safeGet</span></a><span> </span><a href="#local-6989586621679031426"><span class="hs-identifier hs-var">row</span></a><span> </span><a href="#local-6989586621679031427"><span class="hs-identifier hs-var">column</span></a><span> </span><a href="#local-6989586621679031423"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Data.Matrix.html#safeGet"><span class="hs-identifier hs-var">safeGet</span></a><span> </span><a href="#local-6989586621679031426"><span class="hs-identifier hs-var">row</span></a><span> </span><a href="#local-6989586621679031427"><span class="hs-identifier hs-var">column</span></a><span> </span><a href="#local-6989586621679031424"><span class="hs-identifier hs-var">m'</span></a><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-174"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-175"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-176"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-179"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-180"></a><span class="hs-comment">---- APPLICATIVE INSTANCE</span><span>
</span><a name="line-181"></a><span class="hs-comment">---- Works like tensor product but applies a function </span><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-184"></a><span>  </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621679031405"><a href="#local-6989586621679031405"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679031405"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span> </span><span>
</span><a name="line-185"></a><span>  </span><a name="local-6989586621679031406"><a href="#local-6989586621679031406"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span> </span><a name="local-6989586621679031407"><a href="#local-6989586621679031407"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#flatten"><span class="hs-identifier hs-var">flatten</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679031408"><a href="#local-6989586621679031408"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031408"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679031407"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679031406"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-189"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span class="hs-comment">-- | Flatten a matrix of matrices. All sub matrices must have same dimensions</span><span>
</span><a name="line-194"></a><span class="hs-comment">--   This criteria is not checked. </span><span>
</span><a name="line-195"></a><span class="hs-identifier">flatten</span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031669"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031669"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-196"></a><a name="flatten"><a href="Data.Matrix.html#flatten"><span class="hs-identifier">flatten</span></a></a><span> </span><a name="local-6989586621679032016"><a href="#local-6989586621679032016"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl1</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#%3C-%3E"><span class="hs-operator hs-var">&lt;-&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl1</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679032017"><a href="#local-6989586621679032017"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#getRow"><span class="hs-identifier hs-var">getRow</span></a><span> </span><a href="#local-6989586621679032017"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032016"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032016"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">-- | /O(rows*cols)/. Map a function over a row.</span><span>
</span><a name="line-199"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-200"></a><span class="hs-comment">--</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- &gt;                          ( 1 2 3 )   ( 1 2 3 )</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- &gt;                          ( 4 5 6 )   ( 5 6 7 )</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- &gt; mapRow (\_ x -&gt; x + 1) 2 ( 7 8 9 ) = ( 7 8 9 )</span><span>
</span><a name="line-204"></a><span class="hs-comment">--</span><span>
</span><a name="line-205"></a><span class="hs-identifier">mapRow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031668"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031668"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Function takes the current column as additional argument.</span><span>
</span><a name="line-206"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>            </span><span class="hs-comment">-- ^ Row to map.</span><span>
</span><a name="line-207"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031668"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031668"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-208"></a><a name="mapRow"><a href="Data.Matrix.html#mapRow"><span class="hs-identifier">mapRow</span></a></a><span> </span><a name="local-6989586621679032018"><a href="#local-6989586621679032018"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679032019"><a href="#local-6989586621679032019"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679032020"><a href="#local-6989586621679032020"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-209"></a><span>  </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032020"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032020"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032021"><a href="#local-6989586621679032021"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032022"><a href="#local-6989586621679032022"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032023"><a href="#local-6989586621679032023"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032021"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032022"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032020"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-211"></a><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032021"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032019"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-212"></a><span>           </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032018"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679032022"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032023"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-213"></a><span>           </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679032023"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-comment">-- | /O(rows*cols)/. Map a function over a column.</span><span>
</span><a name="line-216"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-217"></a><span class="hs-comment">--</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- &gt;                          ( 1 2 3 )   ( 1 3 3 )</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- &gt;                          ( 4 5 6 )   ( 4 6 6 )</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- &gt; mapCol (\_ x -&gt; x + 1) 2 ( 7 8 9 ) = ( 7 9 9 )</span><span>
</span><a name="line-221"></a><span class="hs-comment">--</span><span>
</span><a name="line-222"></a><span class="hs-identifier">mapCol</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031667"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031667"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Function takes the current row as additional argument.</span><span>
</span><a name="line-223"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>            </span><span class="hs-comment">-- ^ Column to map.</span><span>
</span><a name="line-224"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031667"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031667"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-225"></a><a name="mapCol"><a href="Data.Matrix.html#mapCol"><span class="hs-identifier">mapCol</span></a></a><span> </span><a name="local-6989586621679032024"><a href="#local-6989586621679032024"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679032025"><a href="#local-6989586621679032025"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679032026"><a href="#local-6989586621679032026"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-226"></a><span>  </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032026"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032026"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032027"><a href="#local-6989586621679032027"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032028"><a href="#local-6989586621679032028"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-227"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032029"><a href="#local-6989586621679032029"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032027"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032028"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032026"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-228"></a><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032028"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032025"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-229"></a><span>           </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032024"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679032027"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032029"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-230"></a><span>           </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679032029"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-233"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-234"></a><span class="hs-comment">---- FOLDABLE AND TRAVERSABLE INSTANCES</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-237"></a><span> </span><a name="local-8214565720323788896"><span class="hs-identifier">foldMap</span></a><span> </span><a name="local-6989586621679031404"><a href="#local-6989586621679031404"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="#local-6989586621679031404"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">mvect</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Matrix.html#forceMatrix"><span class="hs-identifier hs-var">forceMatrix</span></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-240"></a><span> </span><a name="local-8214565720323787469"><span class="hs-identifier">sequenceA</span></a><span> </span><a name="local-6989586621679031403"><a href="#local-6989586621679031403"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679031403"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679031403"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679031403"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">sequenceA</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">mvect</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Matrix.html#forceMatrix"><span class="hs-identifier hs-var">forceMatrix</span></a><span> </span><a href="#local-6989586621679031403"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-243"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-244"></a><span class="hs-comment">---- BUILDERS</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-comment">-- | /O(rows*cols)/. The zero matrix of the given size.</span><span>
</span><a name="line-247"></a><span class="hs-comment">--</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- &gt; zero n m =</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- &gt;                 m</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- &gt;   1 ( 0 0 ... 0 0 )</span><span>
</span><a name="line-251"></a><span class="hs-comment">-- &gt;   2 ( 0 0 ... 0 0 )</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- &gt;     (     ...     )</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- &gt;     ( 0 0 ... 0 0 )</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- &gt;   n ( 0 0 ... 0 0 )</span><span>
</span><a name="line-255"></a><span class="hs-identifier">zero</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031666"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-256"></a><span>     </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Rows</span><span>
</span><a name="line-257"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Columns</span><span>
</span><a name="line-258"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031666"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-259"></a><span class="hs-pragma">{-# INLINE zero #-}</span><span>
</span><a name="line-260"></a><a name="zero"><a href="Data.Matrix.html#zero"><span class="hs-identifier">zero</span></a></a><span> </span><a name="local-6989586621679032030"><a href="#local-6989586621679032030"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032031"><a href="#local-6989586621679032031"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a href="#local-6989586621679032030"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032031"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032031"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032030"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032031"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span class="hs-comment">-- | /O(rows*cols)/. Generate a matrix from a generator function.</span><span>
</span><a name="line-263"></a><span class="hs-comment">--   Example of usage:</span><span>
</span><a name="line-264"></a><span class="hs-comment">--</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- &gt;                                  (  1  0 -1 -2 )</span><span>
</span><a name="line-266"></a><span class="hs-comment">-- &gt;                                  (  3  2  1  0 )</span><span>
</span><a name="line-267"></a><span class="hs-comment">-- &gt;                                  (  5  4  3  2 )</span><span>
</span><a name="line-268"></a><span class="hs-comment">-- &gt; matrix 4 4 $ \(i,j) -&gt; 2*i - j = (  7  6  5  4 )</span><span>
</span><a name="line-269"></a><span class="hs-identifier">matrix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Rows</span><span>
</span><a name="line-270"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Columns</span><span>
</span><a name="line-271"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031665"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Generator function</span><span>
</span><a name="line-272"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031665"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-273"></a><span class="hs-pragma">{-# INLINE matrix #-}</span><span>
</span><a name="line-274"></a><a name="matrix"><a href="Data.Matrix.html#matrix"><span class="hs-identifier">matrix</span></a></a><span> </span><a name="local-6989586621679032032"><a href="#local-6989586621679032032"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032033"><a href="#local-6989586621679032033"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032034"><a href="#local-6989586621679032034"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a href="#local-6989586621679032032"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032033"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032033"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">create</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-275"></a><span>  </span><a name="local-6989586621679032035"><a href="#local-6989586621679032035"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">new</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032032"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679032033"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-276"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032036"><a href="#local-6989586621679032036"><span class="hs-identifier">en</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032033"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-277"></a><span>  </span><span class="hs-identifier hs-var">numLoop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032032"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-278"></a><span>    </span><span class="hs-glyph">\</span><a name="local-6989586621679032037"><a href="#local-6989586621679032037"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">numLoop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032033"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-279"></a><span>    </span><span class="hs-glyph">\</span><a name="local-6989586621679032038"><a href="#local-6989586621679032038"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unsafeWrite</span><span> </span><a href="#local-6989586621679032035"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032036"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032037"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032038"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032034"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032037"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032038"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679032035"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-comment">-- | /O(rows*cols)/. Identity matrix of the given order.</span><span>
</span><a name="line-283"></a><span class="hs-comment">--</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- &gt; identity n =</span><span>
</span><a name="line-285"></a><span class="hs-comment">-- &gt;                 n</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- &gt;   1 ( 1 0 ... 0 0 )</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- &gt;   2 ( 0 1 ... 0 0 )</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- &gt;     (     ...     )</span><span>
</span><a name="line-289"></a><span class="hs-comment">-- &gt;     ( 0 0 ... 1 0 )</span><span>
</span><a name="line-290"></a><span class="hs-comment">-- &gt;   n ( 0 0 ... 0 1 )</span><span>
</span><a name="line-291"></a><span class="hs-comment">--</span><span>
</span><a name="line-292"></a><span class="hs-identifier">identity</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031664"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031664"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-293"></a><a name="identity"><a href="Data.Matrix.html#identity"><span class="hs-identifier">identity</span></a></a><span> </span><a name="local-6989586621679032039"><a href="#local-6989586621679032039"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><a href="#local-6989586621679032039"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032039"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032040"><a href="#local-6989586621679032040"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032041"><a href="#local-6989586621679032041"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032040"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032041"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-comment">-- | Similar to 'diagonalList', but using 'V.Vector', which</span><span>
</span><a name="line-296"></a><span class="hs-comment">--   should be more efficient.</span><span>
</span><a name="line-297"></a><span class="hs-identifier">diagonal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679031663"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Default element</span><span>
</span><a name="line-298"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="#local-6989586621679031663"><span class="hs-identifier hs-type">a</span></a><span>  </span><span class="hs-comment">-- ^ Diagonal vector</span><span>
</span><a name="line-299"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031663"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-300"></a><a name="diagonal"><a href="Data.Matrix.html#diagonal"><span class="hs-identifier">diagonal</span></a></a><span> </span><a name="local-6989586621679032042"><a href="#local-6989586621679032042"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679032043"><a href="#local-6989586621679032043"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><a href="#local-6989586621679032044"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032044"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032045"><a href="#local-6989586621679032045"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032046"><a href="#local-6989586621679032046"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032045"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032046"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unsafeIndex</span><span> </span><a href="#local-6989586621679032043"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032045"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679032042"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-301"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-302"></a><span>    </span><a name="local-6989586621679032044"><a href="#local-6989586621679032044"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679032043"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">-- | Create a matrix from a non-empty list given the desired size.</span><span>
</span><a name="line-305"></a><span class="hs-comment">--   The list must have at least /rows*cols/ elements.</span><span>
</span><a name="line-306"></a><span class="hs-comment">--   An example:</span><span>
</span><a name="line-307"></a><span class="hs-comment">--</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- &gt;                       ( 1 2 3 )</span><span>
</span><a name="line-309"></a><span class="hs-comment">-- &gt;                       ( 4 5 6 )</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- &gt; fromList 3 3 [1..] =  ( 7 8 9 )</span><span>
</span><a name="line-311"></a><span class="hs-comment">--</span><span>
</span><a name="line-312"></a><span class="hs-identifier">fromList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Rows</span><span>
</span><a name="line-313"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Columns</span><span>
</span><a name="line-314"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679031662"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ List of elements</span><span>
</span><a name="line-315"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031662"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-316"></a><span class="hs-pragma">{-# INLINE fromList #-}</span><span>
</span><a name="line-317"></a><a name="fromList"><a href="Data.Matrix.html#fromList"><span class="hs-identifier">fromList</span></a></a><span> </span><a name="local-6989586621679032047"><a href="#local-6989586621679032047"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032048"><a href="#local-6989586621679032048"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a href="#local-6989586621679032047"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032048"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032048"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromListN</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032047"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032048"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-comment">-- | Get the elements of a matrix stored in a list.</span><span>
</span><a name="line-320"></a><span class="hs-comment">--</span><span>
</span><a name="line-321"></a><span class="hs-comment">-- &gt;        ( 1 2 3 )</span><span>
</span><a name="line-322"></a><span class="hs-comment">-- &gt;        ( 4 5 6 )</span><span>
</span><a name="line-323"></a><span class="hs-comment">-- &gt; toList ( 7 8 9 ) = [1,2,3,4,5,6,7,8,9]</span><span>
</span><a name="line-324"></a><span class="hs-comment">--</span><span>
</span><a name="line-325"></a><span class="hs-identifier">toList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031661"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679031661"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-326"></a><a name="toList"><a href="Data.Matrix.html#toList"><span class="hs-identifier">toList</span></a></a><span> </span><a name="local-6989586621679032049"><a href="#local-6989586621679032049"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032050"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032051"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032049"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032050"><a href="#local-6989586621679032050"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032049"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679032051"><a href="#local-6989586621679032051"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032049"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-comment">-- | Get the elements of a matrix stored in a list of lists,</span><span>
</span><a name="line-329"></a><span class="hs-comment">--   where each list contains the elements of a single row.</span><span>
</span><a name="line-330"></a><span class="hs-comment">--</span><span>
</span><a name="line-331"></a><span class="hs-comment">-- &gt;         ( 1 2 3 )   [ [1,2,3]</span><span>
</span><a name="line-332"></a><span class="hs-comment">-- &gt;         ( 4 5 6 )   , [4,5,6]</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- &gt; toLists ( 7 8 9 ) = , [7,8,9] ]</span><span>
</span><a name="line-334"></a><span class="hs-comment">--</span><span>
</span><a name="line-335"></a><span class="hs-identifier">toLists</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031660"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679031660"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-336"></a><a name="toLists"><a href="Data.Matrix.html#toLists"><span class="hs-identifier">toLists</span></a></a><span> </span><a name="local-6989586621679032052"><a href="#local-6989586621679032052"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032053"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032054"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032052"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032054"><a href="#local-6989586621679032054"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032052"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032053"><a href="#local-6989586621679032053"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032052"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-comment">-- | Diagonal matrix from a non-empty list given the desired size.</span><span>
</span><a name="line-339"></a><span class="hs-comment">--   Non-diagonal elements will be filled with the given default element.</span><span>
</span><a name="line-340"></a><span class="hs-comment">--   The list must have at least /order/ elements.</span><span>
</span><a name="line-341"></a><span class="hs-comment">--</span><span>
</span><a name="line-342"></a><span class="hs-comment">-- &gt; diagonalList n 0 [1..] =</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- &gt;                   n</span><span>
</span><a name="line-344"></a><span class="hs-comment">-- &gt;   1 ( 1 0 ... 0   0 )</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- &gt;   2 ( 0 2 ... 0   0 )</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- &gt;     (     ...       )</span><span>
</span><a name="line-347"></a><span class="hs-comment">-- &gt;     ( 0 0 ... n-1 0 )</span><span>
</span><a name="line-348"></a><span class="hs-comment">-- &gt;   n ( 0 0 ... 0   n )</span><span>
</span><a name="line-349"></a><span class="hs-comment">--</span><span>
</span><a name="line-350"></a><span class="hs-identifier">diagonalList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031659"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679031659"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031659"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-351"></a><a name="diagonalList"><a href="Data.Matrix.html#diagonalList"><span class="hs-identifier">diagonalList</span></a></a><span> </span><a name="local-6989586621679032055"><a href="#local-6989586621679032055"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032056"><a href="#local-6989586621679032056"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679032057"><a href="#local-6989586621679032057"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><a href="#local-6989586621679032055"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032055"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032058"><a href="#local-6989586621679032058"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032059"><a href="#local-6989586621679032059"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032058"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032059"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032057"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032058"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679032056"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-comment">-- | Create a matrix from a non-empty list of non-empty lists.</span><span>
</span><a name="line-354"></a><span class="hs-comment">--   /Each list must have at least as many elements as the first list/.</span><span>
</span><a name="line-355"></a><span class="hs-comment">--   Examples:</span><span>
</span><a name="line-356"></a><span class="hs-comment">--</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- &gt; fromLists [ [1,2,3]      ( 1 2 3 )</span><span>
</span><a name="line-358"></a><span class="hs-comment">-- &gt;           , [4,5,6]      ( 4 5 6 )</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- &gt;           , [7,8,9] ] =  ( 7 8 9 )</span><span>
</span><a name="line-360"></a><span class="hs-comment">--</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- &gt; fromLists [ [1,2,3  ]     ( 1 2 3 )</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- &gt;           , [4,5,6,7]     ( 4 5 6 )</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- &gt;           , [8,9,0  ] ] = ( 8 9 0 )</span><span>
</span><a name="line-364"></a><span class="hs-comment">--</span><span>
</span><a name="line-365"></a><span class="hs-identifier">fromLists</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679031658"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031658"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-366"></a><span class="hs-pragma">{-# INLINE fromLists #-}</span><span>
</span><a name="line-367"></a><a name="fromLists"><a href="Data.Matrix.html#fromLists"><span class="hs-identifier">fromLists</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;fromLists: empty list.&quot;</span><span>
</span><a name="line-368"></a><span class="hs-identifier">fromLists</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679032074"><a href="#local-6989586621679032074"><span class="hs-identifier">xs</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679032075"><a href="#local-6989586621679032075"><span class="hs-identifier">xss</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span> </span><a href="#local-6989586621679032076"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032077"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032074"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621679032077"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032075"><span class="hs-identifier hs-var">xss</span></a><span>
</span><a name="line-369"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-370"></a><span>    </span><a name="local-6989586621679032076"><a href="#local-6989586621679032076"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679032075"><span class="hs-identifier hs-var">xss</span></a><span>
</span><a name="line-371"></a><span>    </span><a name="local-6989586621679032077"><a href="#local-6989586621679032077"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679032074"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span class="hs-comment">-- | /O(1)/. Represent a vector as a one row matrix.</span><span>
</span><a name="line-374"></a><span class="hs-identifier">rowVector</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="#local-6989586621679031657"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031657"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-375"></a><a name="rowVector"><a href="Data.Matrix.html#rowVector"><span class="hs-identifier">rowVector</span></a></a><span> </span><a name="local-6989586621679032078"><a href="#local-6989586621679032078"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032079"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032079"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679032078"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-376"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-377"></a><span>    </span><a name="local-6989586621679032079"><a href="#local-6989586621679032079"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679032078"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-comment">-- | /O(1)/. Represent a vector as a one column matrix.</span><span>
</span><a name="line-380"></a><span class="hs-identifier">colVector</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="#local-6989586621679031656"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031656"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-381"></a><a name="colVector"><a href="Data.Matrix.html#colVector"><span class="hs-identifier">colVector</span></a></a><span> </span><a name="local-6989586621679032080"><a href="#local-6989586621679032080"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679032080"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032080"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-comment">-- | /O(rows*cols)/. Permutation matrix.</span><span>
</span><a name="line-384"></a><span class="hs-comment">--</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- &gt; permMatrix n i j =</span><span>
</span><a name="line-386"></a><span class="hs-comment">-- &gt;               i     j       n</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- &gt;   1 ( 1 0 ... 0 ... 0 ... 0 0 )</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- &gt;   2 ( 0 1 ... 0 ... 0 ... 0 0 )</span><span>
</span><a name="line-389"></a><span class="hs-comment">-- &gt;     (     ...   ...   ...     )</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- &gt;   i ( 0 0 ... 0 ... 1 ... 0 0 )</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- &gt;     (     ...   ...   ...     )</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- &gt;   j ( 0 0 ... 1 ... 0 ... 0 0 )</span><span>
</span><a name="line-393"></a><span class="hs-comment">-- &gt;     (     ...   ...   ...     )</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- &gt;     ( 0 0 ... 0 ... 0 ... 1 0 )</span><span>
</span><a name="line-395"></a><span class="hs-comment">-- &gt;   n ( 0 0 ... 0 ... 0 ... 0 1 )</span><span>
</span><a name="line-396"></a><span class="hs-comment">--</span><span>
</span><a name="line-397"></a><span class="hs-comment">-- When @i == j@ it reduces to 'identity' @n@.</span><span>
</span><a name="line-398"></a><span class="hs-comment">--</span><span>
</span><a name="line-399"></a><span class="hs-identifier">permMatrix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031655"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-400"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Size of the matrix.</span><span>
</span><a name="line-401"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Permuted row 1.</span><span>
</span><a name="line-402"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Permuted row 2.</span><span>
</span><a name="line-403"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031655"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Permutation matrix.</span><span>
</span><a name="line-404"></a><a name="permMatrix"><a href="Data.Matrix.html#permMatrix"><span class="hs-identifier">permMatrix</span></a></a><span> </span><a name="local-6989586621679032081"><a href="#local-6989586621679032081"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032082"><a href="#local-6989586621679032082"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621679032083"><a href="#local-6989586621679032083"><span class="hs-identifier">r2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032082"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032083"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#identity"><span class="hs-identifier hs-var">identity</span></a><span> </span><a href="#local-6989586621679032081"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-405"></a><span class="hs-identifier">permMatrix</span><span> </span><a name="local-6989586621679032084"><a href="#local-6989586621679032084"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032085"><a href="#local-6989586621679032085"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621679032086"><a href="#local-6989586621679032086"><span class="hs-identifier">r2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><a href="#local-6989586621679032084"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032084"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032087"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-406"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-407"></a><span>  </span><a name="local-6989586621679032087"><a href="#local-6989586621679032087"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679032088"><a href="#local-6989586621679032088"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032089"><a href="#local-6989586621679032089"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032088"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032085"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032089"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032086"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-409"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032088"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032086"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032089"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032085"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-410"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032088"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032089"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-411"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-414"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-415"></a><span class="hs-comment">---- ACCESSING</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-comment">-- | /O(1)/. Get an element of a matrix. Indices range from /(1,1)/ to /(n,m)/.</span><span>
</span><a name="line-418"></a><span class="hs-comment">--   It returns an 'error' if the requested element is outside of range.</span><span>
</span><a name="line-419"></a><span class="hs-identifier">getElem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ Row</span><span>
</span><a name="line-420"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ Column</span><span>
</span><a name="line-421"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031654"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Matrix</span><span>
</span><a name="line-422"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031654"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-423"></a><span class="hs-pragma">{-# INLINE getElem #-}</span><span>
</span><a name="line-424"></a><a name="getElem"><a href="Data.Matrix.html#getElem"><span class="hs-identifier">getElem</span></a></a><span> </span><a name="local-6989586621679032090"><a href="#local-6989586621679032090"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679032091"><a href="#local-6989586621679032091"><span class="hs-identifier">j</span></a></a><span> </span><a name="local-6989586621679032092"><a href="#local-6989586621679032092"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-425"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Data.Matrix.html#safeGet"><span class="hs-identifier hs-var">safeGet</span></a><span> </span><a href="#local-6989586621679032090"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032091"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032092"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-426"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679032093"><a href="#local-6989586621679032093"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032093"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-427"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span>
</span><a name="line-428"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;getElem: Trying to get the &quot;</span><span>
</span><a name="line-429"></a><span>     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032090"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032091"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-430"></a><span>     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; element from a &quot;</span><span>
</span><a name="line-431"></a><span>     </span><span class="hs-operator hs-var">++</span><span> </span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032092"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032092"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-432"></a><span>     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; matrix.&quot;</span><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span class="hs-comment">-- | /O(1)/. Unsafe variant of 'getElem', without bounds checking.</span><span>
</span><a name="line-435"></a><span class="hs-identifier">unsafeGet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ Row</span><span>
</span><a name="line-436"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ Column</span><span>
</span><a name="line-437"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031653"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Matrix</span><span>
</span><a name="line-438"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031653"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-439"></a><span class="hs-pragma">{-# INLINE unsafeGet #-}</span><span>
</span><a name="line-440"></a><a name="unsafeGet"><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier">unsafeGet</span></a></a><span> </span><a name="local-6989586621679032094"><a href="#local-6989586621679032094"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679032095"><a href="#local-6989586621679032095"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679032096"><a href="#local-6989586621679032096"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032097"><a href="#local-6989586621679032097"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679032098"><a href="#local-6989586621679032098"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032099"><a href="#local-6989586621679032099"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unsafeIndex</span><span> </span><a href="#local-6989586621679032099"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032098"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032094"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032096"><span class="hs-identifier hs-var">ro</span></a><span class="hs-special">,</span><a href="#local-6989586621679032095"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032097"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-441"></a><span>
</span><a name="line-442"></a><span class="hs-comment">-- | Short alias for 'getElem'.</span><span>
</span><a name="line-443"></a><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031652"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031652"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-444"></a><span class="hs-pragma">{-# INLINE (!) #-}</span><span>
</span><a name="line-445"></a><a name="local-6989586621679032100"><a href="#local-6989586621679032100"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679032101"><a href="#local-6989586621679032101"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032102"><a href="#local-6989586621679032102"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#getElem"><span class="hs-identifier hs-var">getElem</span></a><span> </span><a href="#local-6989586621679032101"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032102"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032100"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-comment">-- | Internal alias for 'unsafeGet'.</span><span>
</span><a name="line-448"></a><span class="hs-special">(</span><span class="hs-operator">!.</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031651"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031651"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-449"></a><span class="hs-pragma">{-# INLINE (!.) #-}</span><span>
</span><a name="line-450"></a><a name="local-6989586621679032103"><a href="#local-6989586621679032103"><span class="hs-identifier">m</span></a></a><span> </span><a name="%21."><a href="Data.Matrix.html#%21."><span class="hs-operator">!.</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679032104"><a href="#local-6989586621679032104"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032105"><a href="#local-6989586621679032105"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032104"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032105"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032103"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-451"></a><span>
</span><a name="line-452"></a><span class="hs-comment">-- | Variant of 'getElem' that returns Maybe instead of an error.</span><span>
</span><a name="line-453"></a><span class="hs-identifier">safeGet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031650"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679031650"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-454"></a><a name="safeGet"><a href="Data.Matrix.html#safeGet"><span class="hs-identifier">safeGet</span></a></a><span> </span><a name="local-6989586621679032106"><a href="#local-6989586621679032106"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679032107"><a href="#local-6989586621679032107"><span class="hs-identifier">j</span></a></a><span> </span><a name="local-6989586621679032108"><a href="#local-6989586621679032108"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032109"><a href="#local-6989586621679032109"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032110"><a href="#local-6989586621679032110"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-455"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032106"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679032109"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032107"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679032110"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032106"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032107"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-456"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032106"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032107"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032108"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-457"></a><span>
</span><a name="line-458"></a><span class="hs-comment">-- | Variant of 'setElem' that returns Maybe instead of an error.</span><span>
</span><a name="line-459"></a><span class="hs-identifier">safeSet</span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679031649"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031649"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031649"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-460"></a><a name="safeSet"><a href="Data.Matrix.html#safeSet"><span class="hs-identifier">safeSet</span></a></a><span> </span><a name="local-6989586621679032111"><a href="#local-6989586621679032111"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679032112"><a href="#local-6989586621679032112"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679032113"><a href="#local-6989586621679032113"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032114"><a href="#local-6989586621679032114"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679032115"><a href="#local-6989586621679032115"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032116"><a href="#local-6989586621679032116"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032117"><a href="#local-6989586621679032117"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-461"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032113"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679032116"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032114"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679032117"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032113"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032114"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-462"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Matrix.html#unsafeSet"><span class="hs-identifier hs-var">unsafeSet</span></a><span> </span><a href="#local-6989586621679032111"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679032112"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679032115"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-463"></a><span>
</span><a name="line-464"></a><span class="hs-comment">-- | /O(1)/. Get a row of a matrix as a vector.</span><span>
</span><a name="line-465"></a><span class="hs-identifier">getRow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031648"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="#local-6989586621679031648"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-466"></a><span class="hs-pragma">{-# INLINE getRow #-}</span><span>
</span><a name="line-467"></a><a name="getRow"><a href="Data.Matrix.html#getRow"><span class="hs-identifier">getRow</span></a></a><span> </span><a name="local-6989586621679032118"><a href="#local-6989586621679032118"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679032119"><a href="#local-6989586621679032119"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032120"><a href="#local-6989586621679032120"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032121"><a href="#local-6989586621679032121"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679032122"><a href="#local-6989586621679032122"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032123"><a href="#local-6989586621679032123"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">slice</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032122"><span class="hs-identifier hs-var">w</span></a><span class="hs-operator hs-var">*</span><span class="hs-special">(</span><a href="#local-6989586621679032118"><span class="hs-identifier hs-var">i</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032120"><span class="hs-identifier hs-var">ro</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032121"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032119"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679032123"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span class="hs-comment">-- | /O(rows)/. Get a column of a matrix as a vector.</span><span>
</span><a name="line-470"></a><span class="hs-identifier">getCol</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031647"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="#local-6989586621679031647"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-471"></a><span class="hs-pragma">{-# INLINE getCol #-}</span><span>
</span><a name="line-472"></a><a name="getCol"><a href="Data.Matrix.html#getCol"><span class="hs-identifier">getCol</span></a></a><span> </span><a name="local-6989586621679032124"><a href="#local-6989586621679032124"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032125"><a href="#local-6989586621679032125"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679032126"><a href="#local-6989586621679032126"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032127"><a href="#local-6989586621679032127"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679032128"><a href="#local-6989586621679032128"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032129"><a href="#local-6989586621679032129"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span> </span><a href="#local-6989586621679032125"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032130"><a href="#local-6989586621679032130"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032129"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.!</span><span> </span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032128"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032130"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032126"><span class="hs-identifier hs-var">ro</span></a><span class="hs-special">,</span><a href="#local-6989586621679032124"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032127"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span class="hs-comment">-- | /O(min rows cols)/. Diagonal of a /not necessarily square/ matrix.</span><span>
</span><a name="line-475"></a><span class="hs-identifier">getDiag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031646"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="#local-6989586621679031646"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-476"></a><a name="getDiag"><a href="Data.Matrix.html#getDiag"><span class="hs-identifier">getDiag</span></a></a><span> </span><a name="local-6989586621679032131"><a href="#local-6989586621679032131"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span> </span><a href="#local-6989586621679032132"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032133"><a href="#local-6989586621679032133"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032131"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032133"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">,</span><a href="#local-6989586621679032133"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-477"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-478"></a><span>  </span><a name="local-6989586621679032132"><a href="#local-6989586621679032132"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">min</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032131"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032131"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span class="hs-comment">-- | /O(rows*cols)/. Transform a 'Matrix' to a 'V.Vector' of size /rows*cols/.</span><span>
</span><a name="line-481"></a><span class="hs-comment">--  This is equivalent to get all the rows of the matrix using 'getRow'</span><span>
</span><a name="line-482"></a><span class="hs-comment">--  and then append them, but far more efficient.</span><span>
</span><a name="line-483"></a><span class="hs-identifier">getMatrixAsVector</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031645"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="#local-6989586621679031645"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-484"></a><a name="getMatrixAsVector"><a href="Data.Matrix.html#getMatrixAsVector"><span class="hs-identifier">getMatrixAsVector</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mvect</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Matrix.html#forceMatrix"><span class="hs-identifier hs-var">forceMatrix</span></a><span>
</span><a name="line-485"></a><span>
</span><a name="line-486"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-487"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-488"></a><span class="hs-comment">---- MANIPULATING MATRICES</span><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span class="hs-identifier">msetElem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PrimMonad</span><span> </span><a href="#local-6989586621679031643"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-491"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679031644"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ New element</span><span>
</span><a name="line-492"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Number of columns of the matrix</span><span>
</span><a name="line-493"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Row offset</span><span>
</span><a name="line-494"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Column offset</span><span>
</span><a name="line-495"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Position to set the new element</span><span>
</span><a name="line-496"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">MVector</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PrimState</span><span> </span><a href="#local-6989586621679031643"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679031644"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Mutable vector</span><span>
</span><a name="line-497"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031643"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-498"></a><span class="hs-pragma">{-# INLINE msetElem #-}</span><span>
</span><a name="line-499"></a><a name="msetElem"><a href="Data.Matrix.html#msetElem"><span class="hs-identifier">msetElem</span></a></a><span> </span><a name="local-6989586621679032134"><a href="#local-6989586621679032134"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679032135"><a href="#local-6989586621679032135"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032136"><a href="#local-6989586621679032136"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032137"><a href="#local-6989586621679032137"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679032138"><a href="#local-6989586621679032138"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032139"><a href="#local-6989586621679032139"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679032140"><a href="#local-6989586621679032140"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">write</span><span> </span><a href="#local-6989586621679032140"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032135"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032138"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032136"><span class="hs-identifier hs-var">ro</span></a><span class="hs-special">,</span><a href="#local-6989586621679032139"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032137"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032134"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-500"></a><span>
</span><a name="line-501"></a><span class="hs-identifier">unsafeMset</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PrimMonad</span><span> </span><a href="#local-6989586621679031641"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-502"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679031642"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ New element</span><span>
</span><a name="line-503"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Number of columns of the matrix</span><span>
</span><a name="line-504"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Row offset</span><span>
</span><a name="line-505"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Column offset</span><span>
</span><a name="line-506"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Position to set the new element</span><span>
</span><a name="line-507"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">MVector</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PrimState</span><span> </span><a href="#local-6989586621679031641"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679031642"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Mutable vector</span><span>
</span><a name="line-508"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031641"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-509"></a><span class="hs-pragma">{-# INLINE unsafeMset #-}</span><span>
</span><a name="line-510"></a><a name="unsafeMset"><a href="Data.Matrix.html#unsafeMset"><span class="hs-identifier">unsafeMset</span></a></a><span> </span><a name="local-6989586621679032141"><a href="#local-6989586621679032141"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679032142"><a href="#local-6989586621679032142"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032143"><a href="#local-6989586621679032143"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032144"><a href="#local-6989586621679032144"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679032145"><a href="#local-6989586621679032145"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032146"><a href="#local-6989586621679032146"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679032147"><a href="#local-6989586621679032147"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unsafeWrite</span><span> </span><a href="#local-6989586621679032147"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032142"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032145"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032143"><span class="hs-identifier hs-var">ro</span></a><span class="hs-special">,</span><a href="#local-6989586621679032146"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032144"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032141"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span class="hs-comment">-- | Replace the value of a cell in a matrix.</span><span>
</span><a name="line-513"></a><span class="hs-identifier">setElem</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679031640"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ New value.</span><span>
</span><a name="line-514"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Position to replace.</span><span>
</span><a name="line-515"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031640"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Original matrix.</span><span>
</span><a name="line-516"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031640"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Matrix with the given position replaced with the given value.</span><span>
</span><a name="line-517"></a><span class="hs-pragma">{-# INLINE setElem #-}</span><span>
</span><a name="line-518"></a><a name="setElem"><a href="Data.Matrix.html#setElem"><span class="hs-identifier">setElem</span></a></a><span> </span><a name="local-6989586621679032148"><a href="#local-6989586621679032148"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679032149"><a href="#local-6989586621679032149"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032150"><a href="#local-6989586621679032150"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032151"><a href="#local-6989586621679032151"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032152"><a href="#local-6989586621679032152"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032153"><a href="#local-6989586621679032153"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679032154"><a href="#local-6989586621679032154"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032155"><a href="#local-6989586621679032155"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a href="#local-6989586621679032150"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032151"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679032152"><span class="hs-identifier hs-var">ro</span></a><span> </span><a href="#local-6989586621679032153"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679032154"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#msetElem"><span class="hs-identifier hs-var">msetElem</span></a><span> </span><a href="#local-6989586621679032148"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679032154"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621679032152"><span class="hs-identifier hs-var">ro</span></a><span> </span><a href="#local-6989586621679032153"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679032149"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032155"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span class="hs-comment">-- | Unsafe variant of 'setElem', without bounds checking.</span><span>
</span><a name="line-521"></a><span class="hs-identifier">unsafeSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679031639"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ New value.</span><span>
</span><a name="line-522"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Position to replace.</span><span>
</span><a name="line-523"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031639"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Original matrix.</span><span>
</span><a name="line-524"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031639"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Matrix with the given position replaced with the given value.</span><span>
</span><a name="line-525"></a><span class="hs-pragma">{-# INLINE unsafeSet #-}</span><span>
</span><a name="line-526"></a><a name="unsafeSet"><a href="Data.Matrix.html#unsafeSet"><span class="hs-identifier">unsafeSet</span></a></a><span> </span><a name="local-6989586621679032156"><a href="#local-6989586621679032156"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679032157"><a href="#local-6989586621679032157"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032158"><a href="#local-6989586621679032158"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032159"><a href="#local-6989586621679032159"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032160"><a href="#local-6989586621679032160"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032161"><a href="#local-6989586621679032161"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679032162"><a href="#local-6989586621679032162"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032163"><a href="#local-6989586621679032163"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a href="#local-6989586621679032158"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032159"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679032160"><span class="hs-identifier hs-var">ro</span></a><span> </span><a href="#local-6989586621679032161"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679032162"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#unsafeMset"><span class="hs-identifier hs-var">unsafeMset</span></a><span> </span><a href="#local-6989586621679032156"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679032162"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621679032160"><span class="hs-identifier hs-var">ro</span></a><span> </span><a href="#local-6989586621679032161"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679032157"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032163"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span class="hs-comment">-- | /O(rows*cols)/. The transpose of a matrix.</span><span>
</span><a name="line-529"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-530"></a><span class="hs-comment">--</span><span>
</span><a name="line-531"></a><span class="hs-comment">-- &gt;           ( 1 2 3 )   ( 1 4 7 )</span><span>
</span><a name="line-532"></a><span class="hs-comment">-- &gt;           ( 4 5 6 )   ( 2 5 8 )</span><span>
</span><a name="line-533"></a><span class="hs-comment">-- &gt; transpose ( 7 8 9 ) = ( 3 6 9 )</span><span>
</span><a name="line-534"></a><span class="hs-identifier">transpose</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031638"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031638"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-535"></a><a name="transpose"><a href="Data.Matrix.html#transpose"><span class="hs-identifier">transpose</span></a></a><span> </span><a name="local-6989586621679032164"><a href="#local-6989586621679032164"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032164"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032164"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032165"><a href="#local-6989586621679032165"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032166"><a href="#local-6989586621679032166"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032164"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032166"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">,</span><a href="#local-6989586621679032165"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-536"></a><span>
</span><a name="line-537"></a><span class="hs-comment">-- | /O(rows*rows*rows) = O(cols*cols*cols)/. The inverse of a square matrix.</span><span>
</span><a name="line-538"></a><span class="hs-comment">--   Uses naive Gaussian elimination formula.</span><span>
</span><a name="line-539"></a><span class="hs-identifier">inverse</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679031637"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679031637"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031637"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031637"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-540"></a><a name="inverse"><a href="Data.Matrix.html#inverse"><span class="hs-identifier">inverse</span></a></a><span> </span><a name="local-6989586621679032167"><a href="#local-6989586621679032167"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-541"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032167"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032167"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-542"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span>
</span><a name="line-543"></a><span>            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Inverting non-square matrix with dimensions &quot;</span><span>
</span><a name="line-544"></a><span>                </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032167"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032167"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-545"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-546"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-547"></a><span>            </span><a name="local-6989586621679032168"><a href="#local-6989586621679032168"><span class="hs-identifier">adjoinedWId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032167"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="Data.Matrix.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a><span> </span><a href="Data.Matrix.html#identity"><span class="hs-identifier hs-var">identity</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032167"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-548"></a><span>            </span><a name="local-6989586621679032169"><a href="#local-6989586621679032169"><span class="hs-identifier">rref'd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#rref"><span class="hs-identifier hs-var">rref</span></a><span> </span><a href="#local-6989586621679032168"><span class="hs-identifier hs-var">adjoinedWId</span></a><span>
</span><a name="line-549"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679032169"><span class="hs-identifier hs-var">rref'd</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032167"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032167"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032167"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><span class="hs-comment">-- | /O(rows*rows*cols)/. Converts a matrix to reduced row echelon form, thus</span><span>
</span><a name="line-552"></a><span class="hs-comment">--  solving a linear system of equations. This requires that (cols &gt; rows)</span><span>
</span><a name="line-553"></a><span class="hs-comment">--  if cols &lt; rows, then there are fewer variables than equations and the</span><span>
</span><a name="line-554"></a><span class="hs-comment">--  problem cannot be solved consistently. If rows = cols, then it is</span><span>
</span><a name="line-555"></a><span class="hs-comment">--  basically a homogenous system of equations, so it will be reduced to</span><span>
</span><a name="line-556"></a><span class="hs-comment">--  identity or an error depending on whether the marix is invertible</span><span>
</span><a name="line-557"></a><span class="hs-comment">--  (this case is allowed for robustness).</span><span>
</span><a name="line-558"></a><span class="hs-identifier">rref</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679031502"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679031502"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031502"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031502"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-559"></a><a name="rref"><a href="Data.Matrix.html#rref"><span class="hs-identifier">rref</span></a></a><span> </span><a name="local-6989586621679032170"><a href="#local-6989586621679032170"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-560"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032170"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032170"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-561"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-562"></a><span>                </span><span class="hs-string">&quot;Invalid dimensions &quot;</span><span>
</span><a name="line-563"></a><span>                    </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032170"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032170"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-564"></a><span>                    </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;; the number of columns must be greater than or equal to the number of rows&quot;</span><span>
</span><a name="line-565"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032171"><span class="hs-identifier hs-var">rrefRefd</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#ref"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="#local-6989586621679032170"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-566"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-567"></a><span>    </span><a name="local-6989586621679032171"><a href="#local-6989586621679032171"><span class="hs-identifier">rrefRefd</span></a></a><span> </span><a name="local-6989586621679032172"><a href="#local-6989586621679032172"><span class="hs-identifier">mtx</span></a></a><span>
</span><a name="line-568"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032172"><span class="hs-identifier hs-var">mtx</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679032172"><span class="hs-identifier hs-var">mtx</span></a><span>
</span><a name="line-569"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-570"></a><span>            </span><span class="hs-keyword">let</span><span>
</span><a name="line-571"></a><span>                </span><a name="local-6989586621679032173"><a href="#local-6989586621679032173"><span class="hs-identifier">resolvedRight</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679032178"><span class="hs-identifier hs-var">resolveRow</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679032177"><span class="hs-identifier hs-var">col</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032172"><span class="hs-identifier hs-var">mtx</span></a><span>
</span><a name="line-572"></a><span>                    </span><span class="hs-keyword">where</span><span>
</span><a name="line-573"></a><span>                    </span><a name="local-6989586621679032177"><a href="#local-6989586621679032177"><span class="hs-identifier">col</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032172"><span class="hs-identifier hs-var">mtx</span></a><span>
</span><a name="line-574"></a><span>                    </span><a name="local-6989586621679032178"><a href="#local-6989586621679032178"><span class="hs-identifier">resolveRow</span></a></a><span> </span><a name="local-6989586621679032179"><a href="#local-6989586621679032179"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#combineRows"><span class="hs-identifier hs-var">combineRows</span></a><span> </span><a href="#local-6989586621679032179"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="Data.Matrix.html#getElem"><span class="hs-identifier hs-var">getElem</span></a><span> </span><a href="#local-6989586621679032179"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032177"><span class="hs-identifier hs-var">col</span></a><span> </span><a href="#local-6989586621679032172"><span class="hs-identifier hs-var">mtx</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032177"><span class="hs-identifier hs-var">col</span></a><span>
</span><a name="line-575"></a><span>                </span><a name="local-6989586621679032174"><a href="#local-6989586621679032174"><span class="hs-identifier">top</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032173"><span class="hs-identifier hs-var">resolvedRight</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032173"><span class="hs-identifier hs-var">resolvedRight</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032173"><span class="hs-identifier hs-var">resolvedRight</span></a><span>
</span><a name="line-576"></a><span>                </span><a name="local-6989586621679032175"><a href="#local-6989586621679032175"><span class="hs-identifier">top'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032171"><span class="hs-identifier hs-var">rrefRefd</span></a><span> </span><a href="#local-6989586621679032174"><span class="hs-identifier hs-var">top</span></a><span>
</span><a name="line-577"></a><span>                </span><a name="local-6989586621679032176"><a href="#local-6989586621679032176"><span class="hs-identifier">bot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032173"><span class="hs-identifier hs-var">resolvedRight</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032173"><span class="hs-identifier hs-var">resolvedRight</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032173"><span class="hs-identifier hs-var">resolvedRight</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032173"><span class="hs-identifier hs-var">resolvedRight</span></a><span>
</span><a name="line-578"></a><span>            </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679032175"><span class="hs-identifier hs-var">top'</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#%3C-%3E"><span class="hs-operator hs-var">&lt;-&gt;</span></a><span> </span><a href="#local-6989586621679032176"><span class="hs-identifier hs-var">bot</span></a><span class="hs-special">)</span><span>
</span><a name="line-579"></a><span>
</span><a name="line-580"></a><span>
</span><a name="line-581"></a><span class="hs-identifier">ref</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679031501"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679031501"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031501"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031501"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-582"></a><a name="ref"><a href="Data.Matrix.html#ref"><span class="hs-identifier">ref</span></a></a><span> </span><a name="local-6989586621679032180"><a href="#local-6989586621679032180"><span class="hs-identifier">mtx</span></a></a><span>
</span><a name="line-583"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032180"><span class="hs-identifier hs-var">mtx</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-584"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032183"><span class="hs-identifier hs-var">clearedLeft</span></a><span>
</span><a name="line-585"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-586"></a><span>            </span><span class="hs-keyword">let</span><span>
</span><a name="line-587"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621679032190"><a href="#local-6989586621679032190"><span class="hs-identifier">tl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679032191"><a href="#local-6989586621679032191"><span class="hs-identifier">tr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679032192"><a href="#local-6989586621679032192"><span class="hs-identifier">bl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679032193"><a href="#local-6989586621679032193"><span class="hs-identifier">br</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#splitBlocks"><span class="hs-identifier hs-var">splitBlocks</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032183"><span class="hs-identifier hs-var">clearedLeft</span></a><span>
</span><a name="line-588"></a><span>                </span><a name="local-6989586621679032194"><a href="#local-6989586621679032194"><span class="hs-identifier">br'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#ref"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="#local-6989586621679032193"><span class="hs-identifier hs-var">br</span></a><span>
</span><a name="line-589"></a><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032190"><span class="hs-identifier hs-var">tl</span></a><span> </span><a href="Data.Matrix.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a><span> </span><a href="#local-6989586621679032191"><span class="hs-identifier hs-var">tr</span></a><span class="hs-special">)</span><span> </span><a href="Data.Matrix.html#%3C-%3E"><span class="hs-operator hs-var">&lt;-&gt;</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032192"><span class="hs-identifier hs-var">bl</span></a><span> </span><a href="Data.Matrix.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a><span> </span><a href="#local-6989586621679032194"><span class="hs-identifier hs-var">br'</span></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-591"></a><span>    </span><a name="local-6989586621679032181"><a href="#local-6989586621679032181"><span class="hs-identifier">sigAtTop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#switchRows"><span class="hs-identifier hs-var">switchRows</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032185"><span class="hs-identifier hs-var">goodRow</span></a><span> </span><a href="#local-6989586621679032180"><span class="hs-identifier hs-var">mtx</span></a><span>
</span><a name="line-592"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-593"></a><span>        </span><a name="local-6989586621679032184"><a href="#local-6989586621679032184"><span class="hs-identifier">significantRow</span></a></a><span> </span><a name="local-6989586621679032186"><a href="#local-6989586621679032186"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#getElem"><span class="hs-identifier hs-var">getElem</span></a><span> </span><a href="#local-6989586621679032186"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032180"><span class="hs-identifier hs-var">mtx</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-594"></a><span>        </span><a name="local-6989586621679032185"><a href="#local-6989586621679032185"><span class="hs-identifier">goodRow</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">listToMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621679032184"><span class="hs-identifier hs-var">significantRow</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032180"><span class="hs-identifier hs-var">mtx</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-595"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Attempt to invert a non-invertible matrix&quot;</span><span>
</span><a name="line-596"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679032187"><a href="#local-6989586621679032187"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032187"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-597"></a><span>    </span><a name="local-6989586621679032182"><a href="#local-6989586621679032182"><span class="hs-identifier">normalizedFirstRow</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#scaleRow"><span class="hs-identifier hs-var">scaleRow</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="Data.Matrix.html#getElem"><span class="hs-identifier hs-var">getElem</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032180"><span class="hs-identifier hs-var">mtx</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032181"><span class="hs-identifier hs-var">sigAtTop</span></a><span>
</span><a name="line-598"></a><span>    </span><a name="local-6989586621679032183"><a href="#local-6989586621679032183"><span class="hs-identifier">clearedLeft</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679032188"><span class="hs-identifier hs-var">combinator</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">2</span><span class="hs-glyph">..</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032180"><span class="hs-identifier hs-var">mtx</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032182"><span class="hs-identifier hs-var">normalizedFirstRow</span></a><span>
</span><a name="line-599"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-600"></a><span>        </span><a name="local-6989586621679032188"><a href="#local-6989586621679032188"><span class="hs-identifier">combinator</span></a></a><span> </span><a name="local-6989586621679032189"><a href="#local-6989586621679032189"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#combineRows"><span class="hs-identifier hs-var">combineRows</span></a><span> </span><a href="#local-6989586621679032189"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="Data.Matrix.html#getElem"><span class="hs-identifier hs-var">getElem</span></a><span> </span><a href="#local-6989586621679032189"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032182"><span class="hs-identifier hs-var">normalizedFirstRow</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-601"></a><span>
</span><a name="line-602"></a><span class="hs-comment">-- | Extend a matrix to a given size adding a default element.</span><span>
</span><a name="line-603"></a><span class="hs-comment">--   If the matrix already has the required size, nothing happens.</span><span>
</span><a name="line-604"></a><span class="hs-comment">--   The matrix is /never/ reduced in size.</span><span>
</span><a name="line-605"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-606"></a><span class="hs-comment">--</span><span>
</span><a name="line-607"></a><span class="hs-comment">-- &gt;                            ( 1 2 3 0 0 )</span><span>
</span><a name="line-608"></a><span class="hs-comment">-- &gt;                ( 1 2 3 )   ( 4 5 6 0 0 )</span><span>
</span><a name="line-609"></a><span class="hs-comment">-- &gt;                ( 4 5 6 )   ( 7 8 9 0 0 )</span><span>
</span><a name="line-610"></a><span class="hs-comment">-- &gt; extendTo 0 4 5 ( 7 8 9 ) = ( 0 0 0 0 0 )</span><span>
</span><a name="line-611"></a><span class="hs-comment">--</span><span>
</span><a name="line-612"></a><span class="hs-comment">-- The definition of 'extendTo' is based on 'setSize':</span><span>
</span><a name="line-613"></a><span class="hs-comment">--</span><span>
</span><a name="line-614"></a><span class="hs-comment">-- &gt; extendTo e n m a = setSize e (max n $ nrows a) (max m $ ncols a) a</span><span>
</span><a name="line-615"></a><span class="hs-comment">--</span><span>
</span><a name="line-616"></a><span class="hs-identifier">extendTo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679031500"><span class="hs-identifier hs-type">a</span></a><span>   </span><span class="hs-comment">-- ^ Element to add when extending.</span><span>
</span><a name="line-617"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Minimal number of rows.</span><span>
</span><a name="line-618"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Minimal number of columns.</span><span>
</span><a name="line-619"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031500"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031500"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-620"></a><a name="extendTo"><a href="Data.Matrix.html#extendTo"><span class="hs-identifier">extendTo</span></a></a><span> </span><a name="local-6989586621679032195"><a href="#local-6989586621679032195"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679032196"><a href="#local-6989586621679032196"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032197"><a href="#local-6989586621679032197"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032198"><a href="#local-6989586621679032198"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#setSize"><span class="hs-identifier hs-var">setSize</span></a><span> </span><a href="#local-6989586621679032195"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">max</span><span> </span><a href="#local-6989586621679032196"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032198"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">max</span><span> </span><a href="#local-6989586621679032197"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032198"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032198"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-621"></a><span>
</span><a name="line-622"></a><span class="hs-comment">-- | Set the size of a matrix to given parameters. Use a default element</span><span>
</span><a name="line-623"></a><span class="hs-comment">--   for undefined entries if the matrix has been extended.</span><span>
</span><a name="line-624"></a><span class="hs-identifier">setSize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679031499"><span class="hs-identifier hs-type">a</span></a><span>   </span><span class="hs-comment">-- ^ Default element.</span><span>
</span><a name="line-625"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Number of rows.</span><span>
</span><a name="line-626"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Number of columns.</span><span>
</span><a name="line-627"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031499"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-628"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031499"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-629"></a><span class="hs-pragma">{-# INLINE setSize #-}</span><span>
</span><a name="line-630"></a><a name="setSize"><a href="Data.Matrix.html#setSize"><span class="hs-identifier">setSize</span></a></a><span> </span><a name="local-6989586621679032199"><a href="#local-6989586621679032199"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679032200"><a href="#local-6989586621679032200"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032201"><a href="#local-6989586621679032201"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032202"><a href="#local-6989586621679032202"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032203"><a href="#local-6989586621679032203"><span class="hs-identifier">n0</span></a></a><span> </span><a name="local-6989586621679032204"><a href="#local-6989586621679032204"><span class="hs-identifier">m0</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><a href="#local-6989586621679032200"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032201"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032205"><a href="#local-6989586621679032205"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032206"><a href="#local-6989586621679032206"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-631"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032205"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679032203"><span class="hs-identifier hs-var">n0</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679032206"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679032204"><span class="hs-identifier hs-var">m0</span></a><span>
</span><a name="line-632"></a><span>     </span><span class="hs-keyword">then</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032205"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032206"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032202"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-633"></a><span>     </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679032199"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-634"></a><span>
</span><a name="line-635"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-636"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-637"></a><span class="hs-comment">---- WORKING WITH BLOCKS</span><span>
</span><a name="line-638"></a><span>
</span><a name="line-639"></a><span class="hs-comment">-- | /O(1)/. Extract a submatrix given row and column limits.</span><span>
</span><a name="line-640"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-641"></a><span class="hs-comment">--</span><span>
</span><a name="line-642"></a><span class="hs-comment">-- &gt;                   ( 1 2 3 )</span><span>
</span><a name="line-643"></a><span class="hs-comment">-- &gt;                   ( 4 5 6 )   ( 2 3 )</span><span>
</span><a name="line-644"></a><span class="hs-comment">-- &gt; submatrix 1 2 2 3 ( 7 8 9 ) = ( 5 6 )</span><span>
</span><a name="line-645"></a><span class="hs-identifier">submatrix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>    </span><span class="hs-comment">-- ^ Starting row</span><span>
</span><a name="line-646"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Ending row</span><span>
</span><a name="line-647"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>    </span><span class="hs-comment">-- ^ Starting column</span><span>
</span><a name="line-648"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Ending column</span><span>
</span><a name="line-649"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031498"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-650"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031498"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-651"></a><span class="hs-pragma">{-# INLINE submatrix #-}</span><span>
</span><a name="line-652"></a><a name="submatrix"><a href="Data.Matrix.html#submatrix"><span class="hs-identifier">submatrix</span></a></a><span> </span><a name="local-6989586621679032207"><a href="#local-6989586621679032207"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621679032208"><a href="#local-6989586621679032208"><span class="hs-identifier">r2</span></a></a><span> </span><a name="local-6989586621679032209"><a href="#local-6989586621679032209"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621679032210"><a href="#local-6989586621679032210"><span class="hs-identifier">c2</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032211"><a href="#local-6989586621679032211"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032212"><a href="#local-6989586621679032212"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032213"><a href="#local-6989586621679032213"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032214"><a href="#local-6989586621679032214"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679032215"><a href="#local-6989586621679032215"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032216"><a href="#local-6989586621679032216"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-653"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032207"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">1</span><span>  </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032207"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679032211"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;submatrix: starting row (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679032207"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;) is out of range. Matrix has &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679032211"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; rows.&quot;</span><span>
</span><a name="line-654"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032209"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">1</span><span>  </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032209"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679032212"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;submatrix: starting column (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679032209"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;) is out of range. Matrix has &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679032212"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; columns.&quot;</span><span>
</span><a name="line-655"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032208"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679032207"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032208"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679032211"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;submatrix: ending row (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679032208"><span class="hs-identifier hs-var">r2</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;) is out of range. Matrix has &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679032211"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; rows, and starting row is &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679032207"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span>
</span><a name="line-656"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032210"><span class="hs-identifier hs-var">c2</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679032209"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032210"><span class="hs-identifier hs-var">c2</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679032212"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;submatrix: ending column (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679032210"><span class="hs-identifier hs-var">c2</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;) is out of range. Matrix has &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679032212"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; columns, and starting column is &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679032209"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span>
</span><a name="line-657"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032208"><span class="hs-identifier hs-var">r2</span></a><span class="hs-glyph">-</span><a href="#local-6989586621679032207"><span class="hs-identifier hs-var">r1</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032210"><span class="hs-identifier hs-var">c2</span></a><span class="hs-glyph">-</span><a href="#local-6989586621679032209"><span class="hs-identifier hs-var">c1</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032213"><span class="hs-identifier hs-var">ro</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032207"><span class="hs-identifier hs-var">r1</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032214"><span class="hs-identifier hs-var">co</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032209"><span class="hs-identifier hs-var">c1</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032215"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621679032216"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-658"></a><span>
</span><a name="line-659"></a><span class="hs-comment">-- | /O(rows*cols)/. Remove a row and a column from a matrix.</span><span>
</span><a name="line-660"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-661"></a><span class="hs-comment">--</span><span>
</span><a name="line-662"></a><span class="hs-comment">-- &gt;                 ( 1 2 3 )</span><span>
</span><a name="line-663"></a><span class="hs-comment">-- &gt;                 ( 4 5 6 )   ( 1 3 )</span><span>
</span><a name="line-664"></a><span class="hs-comment">-- &gt; minorMatrix 2 2 ( 7 8 9 ) = ( 7 9 )</span><span>
</span><a name="line-665"></a><span class="hs-identifier">minorMatrix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Row @r@ to remove.</span><span>
</span><a name="line-666"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Column @c@ to remove.</span><span>
</span><a name="line-667"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031497"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Original matrix.</span><span>
</span><a name="line-668"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031497"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Matrix with row @r@ and column @c@ removed.</span><span>
</span><a name="line-669"></a><a name="minorMatrix"><a href="Data.Matrix.html#minorMatrix"><span class="hs-identifier">minorMatrix</span></a></a><span> </span><a name="local-6989586621679032217"><a href="#local-6989586621679032217"><span class="hs-identifier">r0</span></a></a><span> </span><a name="local-6989586621679032218"><a href="#local-6989586621679032218"><span class="hs-identifier">c0</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032219"><a href="#local-6989586621679032219"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032220"><a href="#local-6989586621679032220"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032221"><a href="#local-6989586621679032221"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032222"><a href="#local-6989586621679032222"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679032223"><a href="#local-6989586621679032223"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032224"><a href="#local-6989586621679032224"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-670"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032225"><a href="#local-6989586621679032225"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032217"><span class="hs-identifier hs-var">r0</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032221"><span class="hs-identifier hs-var">ro</span></a><span>
</span><a name="line-671"></a><span>      </span><a name="local-6989586621679032226"><a href="#local-6989586621679032226"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032218"><span class="hs-identifier hs-var">c0</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032222"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-672"></a><span>  </span><span class="hs-keyword">in</span><span>  </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032219"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032220"><span class="hs-identifier hs-var">m</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032221"><span class="hs-identifier hs-var">ro</span></a><span> </span><a href="#local-6989586621679032222"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032223"><span class="hs-identifier hs-var">w</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">ifilter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679032227"><a href="#local-6989586621679032227"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679032228"><a href="#local-6989586621679032228"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032229"><a href="#local-6989586621679032229"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#decode"><span class="hs-identifier hs-var">decode</span></a><span> </span><a href="#local-6989586621679032223"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621679032227"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679032228"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679032225"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679032229"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679032226"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032224"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-673"></a><span>
</span><a name="line-674"></a><span class="hs-comment">-- | /O(1)/. Make a block-partition of a matrix using a given element as reference.</span><span>
</span><a name="line-675"></a><span class="hs-comment">--   The element will stay in the bottom-right corner of the top-left corner matrix.</span><span>
</span><a name="line-676"></a><span class="hs-comment">--</span><span>
</span><a name="line-677"></a><span class="hs-comment">-- &gt;                 (             )   (      |      )</span><span>
</span><a name="line-678"></a><span class="hs-comment">-- &gt;                 (             )   ( ...  | ...  )</span><span>
</span><a name="line-679"></a><span class="hs-comment">-- &gt;                 (    x        )   (    x |      )</span><span>
</span><a name="line-680"></a><span class="hs-comment">-- &gt; splitBlocks i j (             ) = (-------------) , where x = a_{i,j}</span><span>
</span><a name="line-681"></a><span class="hs-comment">-- &gt;                 (             )   (      |      )</span><span>
</span><a name="line-682"></a><span class="hs-comment">-- &gt;                 (             )   ( ...  | ...  )</span><span>
</span><a name="line-683"></a><span class="hs-comment">-- &gt;                 (             )   (      |      )</span><span>
</span><a name="line-684"></a><span class="hs-comment">--</span><span>
</span><a name="line-685"></a><span class="hs-comment">--   Note that some blocks can end up empty. We use the following notation for these blocks:</span><span>
</span><a name="line-686"></a><span class="hs-comment">--</span><span>
</span><a name="line-687"></a><span class="hs-comment">-- &gt; ( TL | TR )</span><span>
</span><a name="line-688"></a><span class="hs-comment">-- &gt; (---------)</span><span>
</span><a name="line-689"></a><span class="hs-comment">-- &gt; ( BL | BR )</span><span>
</span><a name="line-690"></a><span class="hs-comment">--</span><span>
</span><a name="line-691"></a><span class="hs-comment">--   Where T = Top, B = Bottom, L = Left, R = Right.</span><span>
</span><a name="line-692"></a><span class="hs-comment">--</span><span>
</span><a name="line-693"></a><span class="hs-identifier">splitBlocks</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ Row of the splitting element.</span><span>
</span><a name="line-694"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ Column of the splitting element.</span><span>
</span><a name="line-695"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031496"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Matrix to split.</span><span>
</span><a name="line-696"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031496"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031496"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-697"></a><span>               </span><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031496"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031496"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ (TL,TR,BL,BR)</span><span>
</span><a name="line-698"></a><span class="hs-pragma">{-# INLINE[1] splitBlocks #-}</span><span>
</span><a name="line-699"></a><a name="splitBlocks"><a href="Data.Matrix.html#splitBlocks"><span class="hs-identifier">splitBlocks</span></a></a><span> </span><a name="local-6989586621679032230"><a href="#local-6989586621679032230"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679032231"><a href="#local-6989586621679032231"><span class="hs-identifier">j</span></a></a><span> </span><a name="local-6989586621679032232"><a href="#local-6989586621679032232"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032233"><a href="#local-6989586621679032233"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032234"><a href="#local-6989586621679032234"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-700"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span>    </span><span class="hs-number">1</span><span>  </span><a href="#local-6989586621679032230"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032231"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032232"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span>    </span><span class="hs-number">1</span><span>  </span><a href="#local-6989586621679032230"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032231"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032234"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679032232"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-701"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032230"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032233"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032231"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032232"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032230"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032233"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032231"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032234"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679032232"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-702"></a><span>
</span><a name="line-703"></a><span class="hs-comment">-- | Join blocks of the form detailed in 'splitBlocks'. Precisely:</span><span>
</span><a name="line-704"></a><span class="hs-comment">--</span><span>
</span><a name="line-705"></a><span class="hs-comment">-- &gt; joinBlocks (tl,tr,bl,br) =</span><span>
</span><a name="line-706"></a><span class="hs-comment">-- &gt;   (tl &lt;|&gt; tr)</span><span>
</span><a name="line-707"></a><span class="hs-comment">-- &gt;       &lt;-&gt;</span><span>
</span><a name="line-708"></a><span class="hs-comment">-- &gt;   (bl &lt;|&gt; br)</span><span>
</span><a name="line-709"></a><span class="hs-identifier">joinBlocks</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031495"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031495"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031495"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031495"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031495"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-710"></a><span class="hs-pragma">{-# INLINE[1] joinBlocks #-}</span><span>
</span><a name="line-711"></a><a name="joinBlocks"><a href="Data.Matrix.html#joinBlocks"><span class="hs-identifier">joinBlocks</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679032235"><a href="#local-6989586621679032235"><span class="hs-identifier">tl</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032236"><a href="#local-6989586621679032236"><span class="hs-identifier">tr</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032237"><a href="#local-6989586621679032237"><span class="hs-identifier">bl</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032238"><a href="#local-6989586621679032238"><span class="hs-identifier">br</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-712"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032239"><a href="#local-6989586621679032239"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032235"><span class="hs-identifier hs-var">tl</span></a><span>
</span><a name="line-713"></a><span>      </span><a name="local-6989586621679032240"><a href="#local-6989586621679032240"><span class="hs-identifier">nb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032237"><span class="hs-identifier hs-var">bl</span></a><span>
</span><a name="line-714"></a><span>      </span><a name="local-6989586621679032241"><a href="#local-6989586621679032241"><span class="hs-identifier">n'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032239"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032240"><span class="hs-identifier hs-var">nb</span></a><span>
</span><a name="line-715"></a><span>      </span><a name="local-6989586621679032242"><a href="#local-6989586621679032242"><span class="hs-identifier">m</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032235"><span class="hs-identifier hs-var">tl</span></a><span>
</span><a name="line-716"></a><span>      </span><a name="local-6989586621679032243"><a href="#local-6989586621679032243"><span class="hs-identifier">mr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032236"><span class="hs-identifier hs-var">tr</span></a><span>
</span><a name="line-717"></a><span>      </span><a name="local-6989586621679032244"><a href="#local-6989586621679032244"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032242"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032243"><span class="hs-identifier hs-var">mr</span></a><span>
</span><a name="line-718"></a><span>      </span><a name="local-6989586621679032245"><a href="#local-6989586621679032245"><span class="hs-identifier">en</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032244"><span class="hs-identifier hs-var">m'</span></a><span>
</span><a name="line-719"></a><span>  </span><span class="hs-keyword">in</span><span>  </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a href="#local-6989586621679032241"><span class="hs-identifier hs-var">n'</span></a><span> </span><a href="#local-6989586621679032244"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032244"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">create</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-720"></a><span>        </span><a name="local-6989586621679032246"><a href="#local-6989586621679032246"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">new</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032241"><span class="hs-identifier hs-var">n'</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032244"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">)</span><span>
</span><a name="line-721"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032247"><a href="#local-6989586621679032247"><span class="hs-identifier">wr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">write</span><span> </span><a href="#local-6989586621679032246"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-722"></a><span>        </span><span class="hs-identifier hs-var">numLoop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032239"><span class="hs-identifier hs-var">n</span></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032248"><a href="#local-6989586621679032248"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-723"></a><span>          </span><span class="hs-identifier hs-var">numLoop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032242"><span class="hs-identifier hs-var">m</span></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032249"><a href="#local-6989586621679032249"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032247"><span class="hs-identifier hs-var">wr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032245"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032248"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">,</span><a href="#local-6989586621679032249"><span class="hs-identifier hs-var">j</span></a><span>  </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032235"><span class="hs-identifier hs-var">tl</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032248"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032249"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>          </span><span class="hs-identifier hs-var">numLoop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032243"><span class="hs-identifier hs-var">mr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032250"><a href="#local-6989586621679032250"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032247"><span class="hs-identifier hs-var">wr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032245"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032248"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">,</span><a href="#local-6989586621679032250"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032242"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032236"><span class="hs-identifier hs-var">tr</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032248"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032250"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-725"></a><span>        </span><span class="hs-identifier hs-var">numLoop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032240"><span class="hs-identifier hs-var">nb</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032251"><a href="#local-6989586621679032251"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-726"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032252"><a href="#local-6989586621679032252"><span class="hs-identifier">i'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032251"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032239"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-727"></a><span>          </span><span class="hs-identifier hs-var">numLoop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032242"><span class="hs-identifier hs-var">m</span></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032253"><a href="#local-6989586621679032253"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032247"><span class="hs-identifier hs-var">wr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032245"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032252"><span class="hs-identifier hs-var">i'</span></a><span class="hs-special">,</span><a href="#local-6989586621679032253"><span class="hs-identifier hs-var">j</span></a><span>  </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032237"><span class="hs-identifier hs-var">bl</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032251"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032253"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-728"></a><span>          </span><span class="hs-identifier hs-var">numLoop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032243"><span class="hs-identifier hs-var">mr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032254"><a href="#local-6989586621679032254"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032247"><span class="hs-identifier hs-var">wr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032245"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032252"><span class="hs-identifier hs-var">i'</span></a><span class="hs-special">,</span><a href="#local-6989586621679032254"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032242"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032238"><span class="hs-identifier hs-var">br</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032251"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032254"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-729"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679032246"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-730"></a><span>
</span><a name="line-731"></a><span class="hs-pragma">{-# RULES
&quot;matrix/splitAndJoin&quot;
   forall i j m. joinBlocks (splitBlocks i j m) = m
  #-}</span><span>
</span><a name="line-735"></a><span>
</span><a name="line-736"></a><span class="hs-comment">-- | Horizontally join two matrices. Visually:</span><span>
</span><a name="line-737"></a><span class="hs-comment">--</span><span>
</span><a name="line-738"></a><span class="hs-comment">-- &gt; ( A ) &lt;|&gt; ( B ) = ( A | B )</span><span>
</span><a name="line-739"></a><span class="hs-comment">--</span><span>
</span><a name="line-740"></a><span class="hs-comment">-- Where both matrices /A/ and /B/ have the same number of rows.</span><span>
</span><a name="line-741"></a><span class="hs-comment">-- /This condition is not checked/.</span><span>
</span><a name="line-742"></a><span class="hs-special">(</span><span class="hs-operator">&lt;|&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031494"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031494"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031494"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-743"></a><span class="hs-pragma">{-# INLINE (&lt;|&gt;) #-}</span><span>
</span><a name="line-744"></a><a name="local-6989586621679032255"><a href="#local-6989586621679032255"><span class="hs-identifier">m</span></a></a><span> </span><a name="%3C%7C%3E"><a href="Data.Matrix.html#%3C%7C%3E"><span class="hs-operator">&lt;|&gt;</span></a></a><span> </span><a name="local-6989586621679032256"><a href="#local-6989586621679032256"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-745"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032257"><a href="#local-6989586621679032257"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032255"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-746"></a><span>  </span><span class="hs-keyword">in</span><span>  </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032255"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032257"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032256"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032258"><a href="#local-6989586621679032258"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032259"><a href="#local-6989586621679032259"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-747"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032259"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679032257"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032255"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032258"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032259"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679032256"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032258"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032259"><span class="hs-identifier hs-var">j</span></a><span class="hs-glyph">-</span><a href="#local-6989586621679032257"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-748"></a><span>
</span><a name="line-749"></a><span class="hs-comment">-- | Vertically join two matrices. Visually:</span><span>
</span><a name="line-750"></a><span class="hs-comment">--</span><span>
</span><a name="line-751"></a><span class="hs-comment">-- &gt;                   ( A )</span><span>
</span><a name="line-752"></a><span class="hs-comment">-- &gt; ( A ) &lt;-&gt; ( B ) = ( - )</span><span>
</span><a name="line-753"></a><span class="hs-comment">-- &gt;                   ( B )</span><span>
</span><a name="line-754"></a><span class="hs-comment">--</span><span>
</span><a name="line-755"></a><span class="hs-comment">-- Where both matrices /A/ and /B/ have the same number of columns.</span><span>
</span><a name="line-756"></a><span class="hs-comment">-- /This condition is not checked/.</span><span>
</span><a name="line-757"></a><span class="hs-special">(</span><span class="hs-operator">&lt;-&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031493"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031493"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031493"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-758"></a><span class="hs-pragma">{-# INLINE (&lt;-&gt;) #-}</span><span>
</span><a name="line-759"></a><a name="local-6989586621679032260"><a href="#local-6989586621679032260"><span class="hs-identifier">m</span></a></a><span> </span><a name="%3C-%3E"><a href="Data.Matrix.html#%3C-%3E"><span class="hs-operator">&lt;-&gt;</span></a></a><span> </span><a name="local-6989586621679032261"><a href="#local-6989586621679032261"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-760"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032262"><a href="#local-6989586621679032262"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032260"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-761"></a><span>  </span><span class="hs-keyword">in</span><span>  </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032262"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032261"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032260"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032263"><a href="#local-6989586621679032263"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032264"><a href="#local-6989586621679032264"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-762"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032263"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679032262"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032260"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032263"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032264"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679032261"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032263"><span class="hs-identifier hs-var">i</span></a><span class="hs-glyph">-</span><a href="#local-6989586621679032262"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><a href="#local-6989586621679032264"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-763"></a><span>
</span><a name="line-764"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-765"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-766"></a><span class="hs-comment">---- MATRIX OPERATIONS</span><span>
</span><a name="line-767"></a><span>
</span><a name="line-768"></a><span class="hs-comment">-- | Perform an operation element-wise.</span><span>
</span><a name="line-769"></a><span class="hs-comment">--   The second matrix must have at least as many rows</span><span>
</span><a name="line-770"></a><span class="hs-comment">--   and columns as the first matrix. If it's bigger,</span><span>
</span><a name="line-771"></a><span class="hs-comment">--   the leftover items will be ignored.</span><span>
</span><a name="line-772"></a><span class="hs-comment">--   If it's smaller, it will cause a run-time error.</span><span>
</span><a name="line-773"></a><span class="hs-comment">--   You may want to use 'elementwiseUnsafe' if you</span><span>
</span><a name="line-774"></a><span class="hs-comment">--   are definitely sure that a run-time error won't</span><span>
</span><a name="line-775"></a><span class="hs-comment">--   arise.</span><span>
</span><a name="line-776"></a><span class="hs-identifier">elementwise</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031490"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031491"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031492"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031490"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031491"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031492"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-777"></a><a name="elementwise"><a href="Data.Matrix.html#elementwise"><span class="hs-identifier">elementwise</span></a></a><span> </span><a name="local-6989586621679032265"><a href="#local-6989586621679032265"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679032266"><a href="#local-6989586621679032266"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032267"><a href="#local-6989586621679032267"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032266"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032266"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-778"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621679032268"><a href="#local-6989586621679032268"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032265"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032266"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679032268"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032267"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679032268"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span>
</span><a name="line-780"></a><span class="hs-comment">-- | Unsafe version of 'elementwise', but faster.</span><span>
</span><a name="line-781"></a><span class="hs-identifier">elementwiseUnsafe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031487"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031488"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031489"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031487"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031488"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031489"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-782"></a><span class="hs-pragma">{-# INLINE elementwiseUnsafe #-}</span><span>
</span><a name="line-783"></a><a name="elementwiseUnsafe"><a href="Data.Matrix.html#elementwiseUnsafe"><span class="hs-identifier">elementwiseUnsafe</span></a></a><span> </span><a name="local-6989586621679032269"><a href="#local-6989586621679032269"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679032270"><a href="#local-6989586621679032270"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032271"><a href="#local-6989586621679032271"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032270"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032270"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-784"></a><span>  </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032272"><a href="#local-6989586621679032272"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032273"><a href="#local-6989586621679032273"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032269"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032272"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032273"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032270"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032272"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032273"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032271"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">)</span><span>
</span><a name="line-785"></a><span>
</span><a name="line-786"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">6</span><span> </span><span class="hs-operator">+.</span><span class="hs-special">,</span><span> </span><span class="hs-operator">-.</span><span>
</span><a name="line-787"></a><span>
</span><a name="line-788"></a><span class="hs-comment">-- | Internal unsafe addition.</span><span>
</span><a name="line-789"></a><span class="hs-special">(</span><span class="hs-operator">+.</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031486"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031486"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031486"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031486"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-790"></a><span class="hs-pragma">{-# INLINE (+.) #-}</span><span>
</span><a name="line-791"></a><span class="hs-special">(</span><a name="%2B."><a href="Data.Matrix.html#%2B."><span class="hs-operator">+.</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#elementwiseUnsafe"><span class="hs-identifier hs-var">elementwiseUnsafe</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span>
</span><a name="line-792"></a><span>
</span><a name="line-793"></a><span class="hs-comment">-- | Internal unsafe substraction.</span><span>
</span><a name="line-794"></a><span class="hs-special">(</span><span class="hs-operator">-.</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031485"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031485"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031485"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031485"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-795"></a><span class="hs-pragma">{-# INLINE (-.) #-}</span><span>
</span><a name="line-796"></a><span class="hs-special">(</span><a name="-."><a href="Data.Matrix.html#-."><span class="hs-operator">-.</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#elementwiseUnsafe"><span class="hs-identifier hs-var">elementwiseUnsafe</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span>
</span><a name="line-797"></a><span>
</span><a name="line-798"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-799"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-800"></a><span class="hs-comment">---- MATRIX MULTIPLICATION</span><span>
</span><a name="line-801"></a><span>
</span><a name="line-802"></a><span class="hs-comment">{- $mult

Four methods are provided for matrix multiplication.

* 'multStd':
     Matrix multiplication following directly the definition.
     This is the best choice when you know for sure that your
     matrices are small.

* 'multStd2':
     Matrix multiplication following directly the definition.
     However, using a different definition from 'multStd'.
     According to our benchmarks with this version, 'multStd2' is
     around 3 times faster than 'multStd'.

* 'multStrassen':
     Matrix multiplication following the Strassen's algorithm.
     Complexity grows slower but also some work is added
     partitioning the matrix. Also, it only works on square
     matrices of order @2^n@, so if this condition is not
     met, it is zero-padded until this is accomplished.
     Therefore, its use is not recommended.

* 'multStrassenMixed':
     This function mixes the previous methods.
     It provides a better performance in general. Method @(@'*'@)@
     of the 'Num' class uses this function because it gives the best
     average performance. However, if you know for sure that your matrices are
     small (size less than 500x500), you should use 'multStd' or 'multStd2' instead,
     since 'multStrassenMixed' is going to switch to those functions anyway.

We keep researching how to get better performance for matrix multiplication.
If you want to be on the safe side, use ('*').

-}</span><span>
</span><a name="line-837"></a><span>
</span><a name="line-838"></a><span class="hs-comment">-- | Standard matrix multiplication by definition.</span><span>
</span><a name="line-839"></a><span class="hs-identifier">multStd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031484"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031484"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031484"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031484"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-840"></a><span class="hs-pragma">{-# INLINE multStd #-}</span><span>
</span><a name="line-841"></a><a name="multStd"><a href="Data.Matrix.html#multStd"><span class="hs-identifier">multStd</span></a></a><span> </span><a name="local-6989586621679032274"><a href="#local-6989586621679032274"><span class="hs-identifier">a1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032275"><a href="#local-6989586621679032275"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032276"><a href="#local-6989586621679032276"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679032277"><a href="#local-6989586621679032277"><span class="hs-identifier">a2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032278"><a href="#local-6989586621679032278"><span class="hs-identifier">n'</span></a></a><span> </span><a name="local-6989586621679032279"><a href="#local-6989586621679032279"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-842"></a><span>   </span><span class="hs-comment">-- Checking that sizes match...</span><span>
</span><a name="line-843"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032276"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679032278"><span class="hs-identifier hs-var">n'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Multiplication of &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><a href="#local-6989586621679032275"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032276"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; and &quot;</span><span>
</span><a name="line-844"></a><span>                    </span><span class="hs-operator hs-var">++</span><span> </span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><a href="#local-6989586621679032278"><span class="hs-identifier hs-var">n'</span></a><span> </span><a href="#local-6989586621679032279"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; matrices.&quot;</span><span>
</span><a name="line-845"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#multStd_"><span class="hs-identifier hs-var">multStd_</span></a><span> </span><a href="#local-6989586621679032274"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-6989586621679032277"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-846"></a><span>
</span><a name="line-847"></a><span class="hs-comment">-- | Standard matrix multiplication by definition.</span><span>
</span><a name="line-848"></a><span class="hs-identifier">multStd2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031483"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031483"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031483"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031483"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-849"></a><span class="hs-pragma">{-# INLINE multStd2 #-}</span><span>
</span><a name="line-850"></a><a name="multStd2"><a href="Data.Matrix.html#multStd2"><span class="hs-identifier">multStd2</span></a></a><span> </span><a name="local-6989586621679032280"><a href="#local-6989586621679032280"><span class="hs-identifier">a1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032281"><a href="#local-6989586621679032281"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032282"><a href="#local-6989586621679032282"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679032283"><a href="#local-6989586621679032283"><span class="hs-identifier">a2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032284"><a href="#local-6989586621679032284"><span class="hs-identifier">n'</span></a></a><span> </span><a name="local-6989586621679032285"><a href="#local-6989586621679032285"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-851"></a><span>   </span><span class="hs-comment">-- Checking that sizes match...</span><span>
</span><a name="line-852"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032282"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679032284"><span class="hs-identifier hs-var">n'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Multiplication of &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><a href="#local-6989586621679032281"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032282"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; and &quot;</span><span>
</span><a name="line-853"></a><span>                    </span><span class="hs-operator hs-var">++</span><span> </span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><a href="#local-6989586621679032284"><span class="hs-identifier hs-var">n'</span></a><span> </span><a href="#local-6989586621679032285"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; matrices.&quot;</span><span>
</span><a name="line-854"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#multStd__"><span class="hs-identifier hs-var">multStd__</span></a><span> </span><a href="#local-6989586621679032280"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-6989586621679032283"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-855"></a><span>
</span><a name="line-856"></a><span class="hs-comment">-- | Standard matrix multiplication by definition, without checking if sizes match.</span><span>
</span><a name="line-857"></a><span class="hs-identifier">multStd_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031482"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031482"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031482"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031482"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-858"></a><span class="hs-pragma">{-# INLINE multStd_ #-}</span><span>
</span><a name="line-859"></a><a name="multStd_"><a href="Data.Matrix.html#multStd_"><span class="hs-identifier">multStd_</span></a></a><span> </span><a name="local-6989586621679032286"><a href="#local-6989586621679032286"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679032287"><a href="#local-6989586621679032287"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032286"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032287"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-860"></a><span class="hs-identifier">multStd_</span><span> </span><a name="local-6989586621679032288"><a href="#local-6989586621679032288"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679032289"><a href="#local-6989586621679032289"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-861"></a><span>  </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-862"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- A</span><span>
</span><a name="line-863"></a><span>        </span><a name="local-6989586621679032290"><a href="#local-6989586621679032290"><span class="hs-identifier">a11</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032288"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032291"><a href="#local-6989586621679032291"><span class="hs-identifier">a12</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032288"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-864"></a><span>        </span><a name="local-6989586621679032292"><a href="#local-6989586621679032292"><span class="hs-identifier">a21</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032288"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032293"><a href="#local-6989586621679032293"><span class="hs-identifier">a22</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032288"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-865"></a><span>        </span><span class="hs-comment">-- B</span><span>
</span><a name="line-866"></a><span>        </span><a name="local-6989586621679032294"><a href="#local-6989586621679032294"><span class="hs-identifier">b11</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032289"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032295"><a href="#local-6989586621679032295"><span class="hs-identifier">b12</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032289"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-867"></a><span>        </span><a name="local-6989586621679032296"><a href="#local-6989586621679032296"><span class="hs-identifier">b21</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032289"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032297"><a href="#local-6989586621679032297"><span class="hs-identifier">b22</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032289"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-868"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span>
</span><a name="line-869"></a><span>         </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679032290"><span class="hs-identifier hs-var">a11</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032294"><span class="hs-identifier hs-var">b11</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032291"><span class="hs-identifier hs-var">a12</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032296"><span class="hs-identifier hs-var">b21</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032290"><span class="hs-identifier hs-var">a11</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032295"><span class="hs-identifier hs-var">b12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032291"><span class="hs-identifier hs-var">a12</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032297"><span class="hs-identifier hs-var">b22</span></a><span>
</span><a name="line-870"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032292"><span class="hs-identifier hs-var">a21</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032294"><span class="hs-identifier hs-var">b11</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032293"><span class="hs-identifier hs-var">a22</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032296"><span class="hs-identifier hs-var">b21</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032292"><span class="hs-identifier hs-var">a21</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032295"><span class="hs-identifier hs-var">b12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032293"><span class="hs-identifier hs-var">a22</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032297"><span class="hs-identifier hs-var">b22</span></a><span>
</span><a name="line-871"></a><span>           </span><span class="hs-special">]</span><span>
</span><a name="line-872"></a><span class="hs-identifier">multStd_</span><span> </span><a name="local-6989586621679032298"><a href="#local-6989586621679032298"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">3</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679032299"><a href="#local-6989586621679032299"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">3</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-873"></a><span>  </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">3</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-874"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- A</span><span>
</span><a name="line-875"></a><span>        </span><a name="local-6989586621679032300"><a href="#local-6989586621679032300"><span class="hs-identifier">a11</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032298"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032301"><a href="#local-6989586621679032301"><span class="hs-identifier">a12</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032298"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032302"><a href="#local-6989586621679032302"><span class="hs-identifier">a13</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032298"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><a name="line-876"></a><span>        </span><a name="local-6989586621679032303"><a href="#local-6989586621679032303"><span class="hs-identifier">a21</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032298"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032304"><a href="#local-6989586621679032304"><span class="hs-identifier">a22</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032298"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032305"><a href="#local-6989586621679032305"><span class="hs-identifier">a23</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032298"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><a name="line-877"></a><span>        </span><a name="local-6989586621679032306"><a href="#local-6989586621679032306"><span class="hs-identifier">a31</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032298"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032307"><a href="#local-6989586621679032307"><span class="hs-identifier">a32</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032298"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032308"><a href="#local-6989586621679032308"><span class="hs-identifier">a33</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032298"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><a name="line-878"></a><span>        </span><span class="hs-comment">-- B</span><span>
</span><a name="line-879"></a><span>        </span><a name="local-6989586621679032309"><a href="#local-6989586621679032309"><span class="hs-identifier">b11</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032299"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032310"><a href="#local-6989586621679032310"><span class="hs-identifier">b12</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032299"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032311"><a href="#local-6989586621679032311"><span class="hs-identifier">b13</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032299"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><a name="line-880"></a><span>        </span><a name="local-6989586621679032312"><a href="#local-6989586621679032312"><span class="hs-identifier">b21</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032299"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032313"><a href="#local-6989586621679032313"><span class="hs-identifier">b22</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032299"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032314"><a href="#local-6989586621679032314"><span class="hs-identifier">b23</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032299"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><a name="line-881"></a><span>        </span><a name="local-6989586621679032315"><a href="#local-6989586621679032315"><span class="hs-identifier">b31</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032299"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032316"><a href="#local-6989586621679032316"><span class="hs-identifier">b32</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032299"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679032317"><a href="#local-6989586621679032317"><span class="hs-identifier">b33</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032299"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><a name="line-882"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span>
</span><a name="line-883"></a><span>         </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679032300"><span class="hs-identifier hs-var">a11</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032309"><span class="hs-identifier hs-var">b11</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032301"><span class="hs-identifier hs-var">a12</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032312"><span class="hs-identifier hs-var">b21</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032302"><span class="hs-identifier hs-var">a13</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032315"><span class="hs-identifier hs-var">b31</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032300"><span class="hs-identifier hs-var">a11</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032310"><span class="hs-identifier hs-var">b12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032301"><span class="hs-identifier hs-var">a12</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032313"><span class="hs-identifier hs-var">b22</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032302"><span class="hs-identifier hs-var">a13</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032316"><span class="hs-identifier hs-var">b32</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032300"><span class="hs-identifier hs-var">a11</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032311"><span class="hs-identifier hs-var">b13</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032301"><span class="hs-identifier hs-var">a12</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032314"><span class="hs-identifier hs-var">b23</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032302"><span class="hs-identifier hs-var">a13</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032317"><span class="hs-identifier hs-var">b33</span></a><span>
</span><a name="line-884"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032303"><span class="hs-identifier hs-var">a21</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032309"><span class="hs-identifier hs-var">b11</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032304"><span class="hs-identifier hs-var">a22</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032312"><span class="hs-identifier hs-var">b21</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032305"><span class="hs-identifier hs-var">a23</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032315"><span class="hs-identifier hs-var">b31</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032303"><span class="hs-identifier hs-var">a21</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032310"><span class="hs-identifier hs-var">b12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032304"><span class="hs-identifier hs-var">a22</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032313"><span class="hs-identifier hs-var">b22</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032305"><span class="hs-identifier hs-var">a23</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032316"><span class="hs-identifier hs-var">b32</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032303"><span class="hs-identifier hs-var">a21</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032311"><span class="hs-identifier hs-var">b13</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032304"><span class="hs-identifier hs-var">a22</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032314"><span class="hs-identifier hs-var">b23</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032305"><span class="hs-identifier hs-var">a23</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032317"><span class="hs-identifier hs-var">b33</span></a><span>
</span><a name="line-885"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032306"><span class="hs-identifier hs-var">a31</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032309"><span class="hs-identifier hs-var">b11</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032307"><span class="hs-identifier hs-var">a32</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032312"><span class="hs-identifier hs-var">b21</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032308"><span class="hs-identifier hs-var">a33</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032315"><span class="hs-identifier hs-var">b31</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032306"><span class="hs-identifier hs-var">a31</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032310"><span class="hs-identifier hs-var">b12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032307"><span class="hs-identifier hs-var">a32</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032313"><span class="hs-identifier hs-var">b22</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032308"><span class="hs-identifier hs-var">a33</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032316"><span class="hs-identifier hs-var">b32</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032306"><span class="hs-identifier hs-var">a31</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032311"><span class="hs-identifier hs-var">b13</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032307"><span class="hs-identifier hs-var">a32</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032314"><span class="hs-identifier hs-var">b23</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032308"><span class="hs-identifier hs-var">a33</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032317"><span class="hs-identifier hs-var">b33</span></a><span>
</span><a name="line-886"></a><span>           </span><span class="hs-special">]</span><span>
</span><a name="line-887"></a><span class="hs-identifier">multStd_</span><span> </span><a name="local-6989586621679032318"><a href="#local-6989586621679032318"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032319"><a href="#local-6989586621679032319"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032320"><a href="#local-6989586621679032320"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679032321"><a href="#local-6989586621679032321"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679032322"><a href="#local-6989586621679032322"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><a href="#local-6989586621679032319"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032322"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032323"><a href="#local-6989586621679032323"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032324"><a href="#local-6989586621679032324"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679032318"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032323"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032325"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679032321"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Data.Matrix.html#%21."><span class="hs-operator hs-var">!.</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032325"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><a href="#local-6989586621679032324"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032325"><a href="#local-6989586621679032325"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679032320"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-888"></a><span>
</span><a name="line-889"></a><span class="hs-identifier">multStd__</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031481"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031481"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031481"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031481"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-890"></a><span class="hs-pragma">{-# INLINE multStd__ #-}</span><span>
</span><a name="line-891"></a><a name="multStd__"><a href="Data.Matrix.html#multStd__"><span class="hs-identifier">multStd__</span></a></a><span> </span><a name="local-6989586621679032326"><a href="#local-6989586621679032326"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679032327"><a href="#local-6989586621679032327"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#matrix"><span class="hs-identifier hs-var">matrix</span></a><span> </span><a href="#local-6989586621679032328"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679032330"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032334"><a href="#local-6989586621679032334"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032335"><a href="#local-6989586621679032335"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#dotProduct"><span class="hs-identifier hs-var">dotProduct</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unsafeIndex</span><span> </span><a href="#local-6989586621679032329"><span class="hs-identifier hs-var">avs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032334"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unsafeIndex</span><span> </span><a href="#local-6989586621679032331"><span class="hs-identifier hs-var">bvs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032335"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-892"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-893"></a><span>    </span><a name="local-6989586621679032328"><a href="#local-6989586621679032328"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032326"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-894"></a><span>    </span><a name="local-6989586621679032329"><a href="#local-6989586621679032329"><span class="hs-identifier">avs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span> </span><a href="#local-6989586621679032328"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032332"><a href="#local-6989586621679032332"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#getRow"><span class="hs-identifier hs-var">getRow</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032332"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032326"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-895"></a><span>    </span><a name="local-6989586621679032330"><a href="#local-6989586621679032330"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032327"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-896"></a><span>    </span><a name="local-6989586621679032331"><a href="#local-6989586621679032331"><span class="hs-identifier">bvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span> </span><a href="#local-6989586621679032330"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032333"><a href="#local-6989586621679032333"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#getCol"><span class="hs-identifier hs-var">getCol</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032333"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032327"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-897"></a><span>
</span><a name="line-898"></a><span class="hs-identifier">dotProduct</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031480"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="#local-6989586621679031480"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="#local-6989586621679031480"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031480"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-899"></a><span class="hs-pragma">{-# INLINE dotProduct #-}</span><span>
</span><a name="line-900"></a><a name="dotProduct"><a href="Data.Matrix.html#dotProduct"><span class="hs-identifier">dotProduct</span></a></a><span> </span><a name="local-6989586621679032336"><a href="#local-6989586621679032336"><span class="hs-identifier">v1</span></a></a><span> </span><a name="local-6989586621679032337"><a href="#local-6989586621679032337"><span class="hs-identifier">v2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">numLoopFold</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679032336"><span class="hs-identifier hs-var">v1</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-901"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621679032338"><a href="#local-6989586621679032338"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679032339"><a href="#local-6989586621679032339"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unsafeIndex</span><span> </span><a href="#local-6989586621679032336"><span class="hs-identifier hs-var">v1</span></a><span> </span><a href="#local-6989586621679032339"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unsafeIndex</span><span> </span><a href="#local-6989586621679032337"><span class="hs-identifier hs-var">v2</span></a><span> </span><a href="#local-6989586621679032339"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032338"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-902"></a><span>
</span><a name="line-903"></a><span class="hs-comment">{-
dotProduct v1 v2 = go (V.length v1 - 1) 0
  where
    go (-1) a = a
    go i a = go (i-1) $ (V.unsafeIndex v1 i) * (V.unsafeIndex v2 i) + a
-}</span><span>
</span><a name="line-909"></a><span>
</span><a name="line-910"></a><span class="hs-identifier">first</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679031479"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679031479"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031479"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-911"></a><a name="first"><a href="Data.Matrix.html#first"><span class="hs-identifier">first</span></a></a><span> </span><a name="local-6989586621679032340"><a href="#local-6989586621679032340"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032341"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-912"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-913"></a><span>  </span><a name="local-6989586621679032341"><a href="#local-6989586621679032341"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679032342"><a href="#local-6989586621679032342"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679032343"><a href="#local-6989586621679032343"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032340"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679032342"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032342"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679032341"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679032343"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-914"></a><span>  </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;first: no element match the condition.&quot;</span><span>
</span><a name="line-915"></a><span>
</span><a name="line-916"></a><span class="hs-comment">-- | Strassen's algorithm over square matrices of order @2^n@.</span><span>
</span><a name="line-917"></a><span class="hs-identifier">strassen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031478"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031478"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031478"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031478"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-918"></a><span class="hs-comment">-- Trivial 1x1 multiplication.</span><span>
</span><a name="line-919"></a><a name="strassen"><a href="Data.Matrix.html#strassen"><span class="hs-identifier">strassen</span></a></a><span> </span><a name="local-6989586621679032344"><a href="#local-6989586621679032344"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679032345"><a href="#local-6989586621679032345"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032344"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032345"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-920"></a><span class="hs-comment">-- General case guesses that the input matrices are square matrices</span><span>
</span><a name="line-921"></a><span class="hs-comment">-- whose order is a power of two.</span><span>
</span><a name="line-922"></a><span class="hs-identifier">strassen</span><span> </span><a name="local-6989586621679032346"><a href="#local-6989586621679032346"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679032347"><a href="#local-6989586621679032347"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#joinBlocks"><span class="hs-identifier hs-var">joinBlocks</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032364"><span class="hs-identifier hs-var">c11</span></a><span class="hs-special">,</span><a href="#local-6989586621679032365"><span class="hs-identifier hs-var">c12</span></a><span class="hs-special">,</span><a href="#local-6989586621679032366"><span class="hs-identifier hs-var">c21</span></a><span class="hs-special">,</span><a href="#local-6989586621679032367"><span class="hs-identifier hs-var">c22</span></a><span class="hs-special">)</span><span>
</span><a name="line-923"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-924"></a><span>  </span><span class="hs-comment">-- Size of the subproblem is halved.</span><span>
</span><a name="line-925"></a><span>  </span><a name="local-6989586621679032348"><a href="#local-6989586621679032348"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">div</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032346"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-926"></a><span>  </span><span class="hs-comment">-- Split of the original problem into smaller subproblems.</span><span>
</span><a name="line-927"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679032349"><a href="#local-6989586621679032349"><span class="hs-identifier">a11</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032350"><a href="#local-6989586621679032350"><span class="hs-identifier">a12</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032351"><a href="#local-6989586621679032351"><span class="hs-identifier">a21</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032352"><a href="#local-6989586621679032352"><span class="hs-identifier">a22</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#splitBlocks"><span class="hs-identifier hs-var">splitBlocks</span></a><span> </span><a href="#local-6989586621679032348"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032348"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032346"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-928"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679032353"><a href="#local-6989586621679032353"><span class="hs-identifier">b11</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032354"><a href="#local-6989586621679032354"><span class="hs-identifier">b12</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032355"><a href="#local-6989586621679032355"><span class="hs-identifier">b21</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032356"><a href="#local-6989586621679032356"><span class="hs-identifier">b22</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#splitBlocks"><span class="hs-identifier hs-var">splitBlocks</span></a><span> </span><a href="#local-6989586621679032348"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032348"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032347"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-929"></a><span>  </span><span class="hs-comment">-- The seven Strassen's products.</span><span>
</span><a name="line-930"></a><span>  </span><a name="local-6989586621679032357"><a href="#local-6989586621679032357"><span class="hs-identifier">p1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassen"><span class="hs-identifier hs-var">strassen</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032349"><span class="hs-identifier hs-var">a11</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032352"><span class="hs-identifier hs-var">a22</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032353"><span class="hs-identifier hs-var">b11</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032356"><span class="hs-identifier hs-var">b22</span></a><span class="hs-special">)</span><span>
</span><a name="line-931"></a><span>  </span><a name="local-6989586621679032358"><a href="#local-6989586621679032358"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassen"><span class="hs-identifier hs-var">strassen</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032351"><span class="hs-identifier hs-var">a21</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032352"><span class="hs-identifier hs-var">a22</span></a><span class="hs-special">)</span><span>  </span><a href="#local-6989586621679032353"><span class="hs-identifier hs-var">b11</span></a><span>
</span><a name="line-932"></a><span>  </span><a name="local-6989586621679032359"><a href="#local-6989586621679032359"><span class="hs-identifier">p3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassen"><span class="hs-identifier hs-var">strassen</span></a><span>  </span><a href="#local-6989586621679032349"><span class="hs-identifier hs-var">a11</span></a><span>        </span><span class="hs-special">(</span><a href="#local-6989586621679032354"><span class="hs-identifier hs-var">b12</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679032356"><span class="hs-identifier hs-var">b22</span></a><span class="hs-special">)</span><span>
</span><a name="line-933"></a><span>  </span><a name="local-6989586621679032360"><a href="#local-6989586621679032360"><span class="hs-identifier">p4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassen"><span class="hs-identifier hs-var">strassen</span></a><span>        </span><a href="#local-6989586621679032352"><span class="hs-identifier hs-var">a22</span></a><span>  </span><span class="hs-special">(</span><a href="#local-6989586621679032355"><span class="hs-identifier hs-var">b21</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679032353"><span class="hs-identifier hs-var">b11</span></a><span class="hs-special">)</span><span>
</span><a name="line-934"></a><span>  </span><a name="local-6989586621679032361"><a href="#local-6989586621679032361"><span class="hs-identifier">p5</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassen"><span class="hs-identifier hs-var">strassen</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032349"><span class="hs-identifier hs-var">a11</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032350"><span class="hs-identifier hs-var">a12</span></a><span class="hs-special">)</span><span>        </span><a href="#local-6989586621679032356"><span class="hs-identifier hs-var">b22</span></a><span>
</span><a name="line-935"></a><span>  </span><a name="local-6989586621679032362"><a href="#local-6989586621679032362"><span class="hs-identifier">p6</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassen"><span class="hs-identifier hs-var">strassen</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032351"><span class="hs-identifier hs-var">a21</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679032349"><span class="hs-identifier hs-var">a11</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032353"><span class="hs-identifier hs-var">b11</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032354"><span class="hs-identifier hs-var">b12</span></a><span class="hs-special">)</span><span>
</span><a name="line-936"></a><span>  </span><a name="local-6989586621679032363"><a href="#local-6989586621679032363"><span class="hs-identifier">p7</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassen"><span class="hs-identifier hs-var">strassen</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032350"><span class="hs-identifier hs-var">a12</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679032352"><span class="hs-identifier hs-var">a22</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032355"><span class="hs-identifier hs-var">b21</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032356"><span class="hs-identifier hs-var">b22</span></a><span class="hs-special">)</span><span>
</span><a name="line-937"></a><span>  </span><span class="hs-comment">-- Merging blocks</span><span>
</span><a name="line-938"></a><span>  </span><a name="local-6989586621679032364"><a href="#local-6989586621679032364"><span class="hs-identifier">c11</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032357"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032360"><span class="hs-identifier hs-var">p4</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679032361"><span class="hs-identifier hs-var">p5</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032363"><span class="hs-identifier hs-var">p7</span></a><span>
</span><a name="line-939"></a><span>  </span><a name="local-6989586621679032365"><a href="#local-6989586621679032365"><span class="hs-identifier">c12</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032359"><span class="hs-identifier hs-var">p3</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032361"><span class="hs-identifier hs-var">p5</span></a><span>
</span><a name="line-940"></a><span>  </span><a name="local-6989586621679032366"><a href="#local-6989586621679032366"><span class="hs-identifier">c21</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032358"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032360"><span class="hs-identifier hs-var">p4</span></a><span>
</span><a name="line-941"></a><span>  </span><a name="local-6989586621679032367"><a href="#local-6989586621679032367"><span class="hs-identifier">c22</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032357"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679032358"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032359"><span class="hs-identifier hs-var">p3</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032362"><span class="hs-identifier hs-var">p6</span></a><span>
</span><a name="line-942"></a><span>
</span><a name="line-943"></a><span class="hs-comment">-- | Strassen's matrix multiplication.</span><span>
</span><a name="line-944"></a><span class="hs-identifier">multStrassen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031477"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031477"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031477"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031477"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-945"></a><a name="multStrassen"><a href="Data.Matrix.html#multStrassen"><span class="hs-identifier">multStrassen</span></a></a><span> </span><a name="local-6989586621679032368"><a href="#local-6989586621679032368"><span class="hs-identifier">a1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032369"><a href="#local-6989586621679032369"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032370"><a href="#local-6989586621679032370"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679032371"><a href="#local-6989586621679032371"><span class="hs-identifier">a2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032372"><a href="#local-6989586621679032372"><span class="hs-identifier">n'</span></a></a><span> </span><a name="local-6989586621679032373"><a href="#local-6989586621679032373"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-946"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032370"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679032372"><span class="hs-identifier hs-var">n'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Multiplication of &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><a href="#local-6989586621679032369"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032370"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; and &quot;</span><span>
</span><a name="line-947"></a><span>                    </span><span class="hs-operator hs-var">++</span><span> </span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><a href="#local-6989586621679032372"><span class="hs-identifier hs-var">n'</span></a><span> </span><a href="#local-6989586621679032373"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; matrices.&quot;</span><span>
</span><a name="line-948"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-949"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032374"><a href="#local-6989586621679032374"><span class="hs-identifier">mx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maximum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679032369"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><a href="#local-6989586621679032370"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><a href="#local-6989586621679032372"><span class="hs-identifier hs-var">n'</span></a><span class="hs-special">,</span><a href="#local-6989586621679032373"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">]</span><span>
</span><a name="line-950"></a><span>           </span><a name="local-6989586621679032375"><a href="#local-6989586621679032375"><span class="hs-identifier">n2</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#first"><span class="hs-identifier hs-var">first</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679032374"><span class="hs-identifier hs-var">mx</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-operator hs-var">^</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><a name="line-951"></a><span>           </span><a name="local-6989586621679032376"><a href="#local-6989586621679032376"><span class="hs-identifier">b1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#setSize"><span class="hs-identifier hs-var">setSize</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032375"><span class="hs-identifier hs-var">n2</span></a><span> </span><a href="#local-6989586621679032375"><span class="hs-identifier hs-var">n2</span></a><span> </span><a href="#local-6989586621679032368"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-952"></a><span>           </span><a name="local-6989586621679032377"><a href="#local-6989586621679032377"><span class="hs-identifier">b2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#setSize"><span class="hs-identifier hs-var">setSize</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032375"><span class="hs-identifier hs-var">n2</span></a><span> </span><a href="#local-6989586621679032375"><span class="hs-identifier hs-var">n2</span></a><span> </span><a href="#local-6989586621679032371"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-953"></a><span>       </span><span class="hs-keyword">in</span><span>  </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032369"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032373"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Matrix.html#strassen"><span class="hs-identifier hs-var">strassen</span></a><span> </span><a href="#local-6989586621679032376"><span class="hs-identifier hs-var">b1</span></a><span> </span><a href="#local-6989586621679032377"><span class="hs-identifier hs-var">b2</span></a><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><span class="hs-identifier">strmixFactor</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-956"></a><a name="strmixFactor"><a href="Data.Matrix.html#strmixFactor"><span class="hs-identifier">strmixFactor</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">300</span><span>
</span><a name="line-957"></a><span>
</span><a name="line-958"></a><span class="hs-comment">-- | Strassen's mixed algorithm.</span><span>
</span><a name="line-959"></a><span class="hs-identifier">strassenMixed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031476"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031476"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031476"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031476"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-960"></a><span class="hs-pragma">{-# SPECIALIZE strassenMixed :: Matrix Double -&gt; Matrix Double -&gt; Matrix Double #-}</span><span>
</span><a name="line-961"></a><span class="hs-pragma">{-# SPECIALIZE strassenMixed :: Matrix Int -&gt; Matrix Int -&gt; Matrix Int #-}</span><span>
</span><a name="line-962"></a><span class="hs-pragma">{-# SPECIALIZE strassenMixed :: Matrix Rational -&gt; Matrix Rational -&gt; Matrix Rational #-}</span><span>
</span><a name="line-963"></a><a name="strassenMixed"><a href="Data.Matrix.html#strassenMixed"><span class="hs-identifier">strassenMixed</span></a></a><span> </span><a name="local-6989586621679032378"><a href="#local-6989586621679032378"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679032379"><a href="#local-6989586621679032379"><span class="hs-identifier">b</span></a></a><span>
</span><a name="line-964"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Data.Matrix.html#strmixFactor"><span class="hs-identifier hs-var">strmixFactor</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#multStd__"><span class="hs-identifier hs-var">multStd__</span></a><span> </span><a href="#local-6989586621679032378"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679032379"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-965"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">odd</span><span> </span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032397"><a href="#local-6989586621679032397"><span class="hs-identifier">r'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-966"></a><span>               </span><a name="local-6989586621679032398"><a href="#local-6989586621679032398"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#setSize"><span class="hs-identifier hs-var">setSize</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032397"><span class="hs-identifier hs-var">r'</span></a><span> </span><a href="#local-6989586621679032397"><span class="hs-identifier hs-var">r'</span></a><span> </span><a href="#local-6989586621679032378"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-967"></a><span>               </span><a name="local-6989586621679032399"><a href="#local-6989586621679032399"><span class="hs-identifier">b'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#setSize"><span class="hs-identifier hs-var">setSize</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032397"><span class="hs-identifier hs-var">r'</span></a><span> </span><a href="#local-6989586621679032397"><span class="hs-identifier hs-var">r'</span></a><span> </span><a href="#local-6989586621679032379"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-968"></a><span>           </span><span class="hs-keyword">in</span><span>  </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Matrix.html#strassenMixed"><span class="hs-identifier hs-var">strassenMixed</span></a><span> </span><a href="#local-6989586621679032398"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-6989586621679032399"><span class="hs-identifier hs-var">b'</span></a><span>
</span><a name="line-969"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-970"></a><span>      </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">create</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-971"></a><span>         </span><a name="local-6989586621679032400"><a href="#local-6989586621679032400"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unsafeNew</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-972"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032401"><a href="#local-6989586621679032401"><span class="hs-identifier">en</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-973"></a><span>             </span><a name="local-6989586621679032402"><a href="#local-6989586621679032402"><span class="hs-identifier">n'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-974"></a><span>         </span><span class="hs-comment">-- c11 = p1 + p4 - p5 + p7</span><span>
</span><a name="line-975"></a><span>         </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">write</span><span> </span><a href="#local-6989586621679032400"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679032405"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-976"></a><span>                         </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032403"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032404"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032390"><span class="hs-identifier hs-var">p1</span></a><span>
</span><a name="line-977"></a><span>                       </span><span class="hs-operator hs-var">+</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032403"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032404"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032393"><span class="hs-identifier hs-var">p4</span></a><span>
</span><a name="line-978"></a><span>                       </span><span class="hs-glyph">-</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032403"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032404"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032394"><span class="hs-identifier hs-var">p5</span></a><span>
</span><a name="line-979"></a><span>                       </span><span class="hs-operator hs-var">+</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032403"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032404"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032396"><span class="hs-identifier hs-var">p7</span></a><span>
</span><a name="line-980"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032403"><a href="#local-6989586621679032403"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-981"></a><span>                   </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679032404"><a href="#local-6989586621679032404"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-982"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032405"><a href="#local-6989586621679032405"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032401"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032403"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032404"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-983"></a><span>                     </span><span class="hs-special">]</span><span>
</span><a name="line-984"></a><span>         </span><span class="hs-comment">-- c12 = p3 + p5</span><span>
</span><a name="line-985"></a><span>         </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">write</span><span> </span><a href="#local-6989586621679032400"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679032408"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-986"></a><span>                         </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032406"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032409"><span class="hs-identifier hs-var">j'</span></a><span> </span><a href="#local-6989586621679032392"><span class="hs-identifier hs-var">p3</span></a><span>
</span><a name="line-987"></a><span>                       </span><span class="hs-operator hs-var">+</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032406"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032409"><span class="hs-identifier hs-var">j'</span></a><span> </span><a href="#local-6989586621679032394"><span class="hs-identifier hs-var">p5</span></a><span>
</span><a name="line-988"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032406"><a href="#local-6989586621679032406"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-989"></a><span>                   </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679032407"><a href="#local-6989586621679032407"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679032402"><span class="hs-identifier hs-var">n'</span></a><span class="hs-glyph">..</span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span>
</span><a name="line-990"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032408"><a href="#local-6989586621679032408"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032401"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032406"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032407"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-991"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032409"><a href="#local-6989586621679032409"><span class="hs-identifier">j'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032407"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-992"></a><span>                     </span><span class="hs-special">]</span><span>
</span><a name="line-993"></a><span>         </span><span class="hs-comment">-- c21 = p2 + p4</span><span>
</span><a name="line-994"></a><span>         </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">write</span><span> </span><a href="#local-6989586621679032400"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679032412"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-995"></a><span>                         </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032413"><span class="hs-identifier hs-var">i'</span></a><span> </span><a href="#local-6989586621679032411"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032391"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-996"></a><span>                       </span><span class="hs-operator hs-var">+</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032413"><span class="hs-identifier hs-var">i'</span></a><span> </span><a href="#local-6989586621679032411"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032393"><span class="hs-identifier hs-var">p4</span></a><span>
</span><a name="line-997"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032410"><a href="#local-6989586621679032410"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679032402"><span class="hs-identifier hs-var">n'</span></a><span class="hs-glyph">..</span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span>
</span><a name="line-998"></a><span>                   </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679032411"><a href="#local-6989586621679032411"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-999"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032412"><a href="#local-6989586621679032412"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032401"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032410"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032411"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-1000"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032413"><a href="#local-6989586621679032413"><span class="hs-identifier">i'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032410"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1001"></a><span>                     </span><span class="hs-special">]</span><span>
</span><a name="line-1002"></a><span>         </span><span class="hs-comment">-- c22 = p1 - p2 + p3 + p6</span><span>
</span><a name="line-1003"></a><span>         </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">write</span><span> </span><a href="#local-6989586621679032400"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679032416"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1004"></a><span>                         </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032417"><span class="hs-identifier hs-var">i'</span></a><span> </span><a href="#local-6989586621679032418"><span class="hs-identifier hs-var">j'</span></a><span> </span><a href="#local-6989586621679032390"><span class="hs-identifier hs-var">p1</span></a><span>
</span><a name="line-1005"></a><span>                       </span><span class="hs-glyph">-</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032417"><span class="hs-identifier hs-var">i'</span></a><span> </span><a href="#local-6989586621679032418"><span class="hs-identifier hs-var">j'</span></a><span> </span><a href="#local-6989586621679032391"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-1006"></a><span>                       </span><span class="hs-operator hs-var">+</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032417"><span class="hs-identifier hs-var">i'</span></a><span> </span><a href="#local-6989586621679032418"><span class="hs-identifier hs-var">j'</span></a><span> </span><a href="#local-6989586621679032392"><span class="hs-identifier hs-var">p3</span></a><span>
</span><a name="line-1007"></a><span>                       </span><span class="hs-operator hs-var">+</span><span> </span><a href="Data.Matrix.html#unsafeGet"><span class="hs-identifier hs-var">unsafeGet</span></a><span> </span><a href="#local-6989586621679032417"><span class="hs-identifier hs-var">i'</span></a><span> </span><a href="#local-6989586621679032418"><span class="hs-identifier hs-var">j'</span></a><span> </span><a href="#local-6989586621679032395"><span class="hs-identifier hs-var">p6</span></a><span>
</span><a name="line-1008"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032414"><a href="#local-6989586621679032414"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679032402"><span class="hs-identifier hs-var">n'</span></a><span class="hs-glyph">..</span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span>
</span><a name="line-1009"></a><span>                   </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679032415"><a href="#local-6989586621679032415"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679032402"><span class="hs-identifier hs-var">n'</span></a><span class="hs-glyph">..</span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span>
</span><a name="line-1010"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032416"><a href="#local-6989586621679032416"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032401"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032414"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679032415"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-1011"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032417"><a href="#local-6989586621679032417"><span class="hs-identifier">i'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032414"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1012"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032418"><a href="#local-6989586621679032418"><span class="hs-identifier">j'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032415"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1013"></a><span>                     </span><span class="hs-special">]</span><span>
</span><a name="line-1014"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679032400"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1015"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1016"></a><span>  </span><a name="local-6989586621679032380"><a href="#local-6989586621679032380"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032378"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1017"></a><span>  </span><span class="hs-comment">-- Size of the subproblem is halved.</span><span>
</span><a name="line-1018"></a><span>  </span><a name="local-6989586621679032381"><a href="#local-6989586621679032381"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">quot</span><span> </span><a href="#local-6989586621679032380"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-1019"></a><span>  </span><span class="hs-comment">-- Split of the original problem into smaller subproblems.</span><span>
</span><a name="line-1020"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679032382"><a href="#local-6989586621679032382"><span class="hs-identifier">a11</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032383"><a href="#local-6989586621679032383"><span class="hs-identifier">a12</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032384"><a href="#local-6989586621679032384"><span class="hs-identifier">a21</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032385"><a href="#local-6989586621679032385"><span class="hs-identifier">a22</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#splitBlocks"><span class="hs-identifier hs-var">splitBlocks</span></a><span> </span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032378"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1021"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679032386"><a href="#local-6989586621679032386"><span class="hs-identifier">b11</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032387"><a href="#local-6989586621679032387"><span class="hs-identifier">b12</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032388"><a href="#local-6989586621679032388"><span class="hs-identifier">b21</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032389"><a href="#local-6989586621679032389"><span class="hs-identifier">b22</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#splitBlocks"><span class="hs-identifier hs-var">splitBlocks</span></a><span> </span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032381"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032379"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1022"></a><span>  </span><span class="hs-comment">-- The seven Strassen's products.</span><span>
</span><a name="line-1023"></a><span>  </span><a name="local-6989586621679032390"><a href="#local-6989586621679032390"><span class="hs-identifier">p1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassenMixed"><span class="hs-identifier hs-var">strassenMixed</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032382"><span class="hs-identifier hs-var">a11</span></a><span> </span><a href="Data.Matrix.html#%2B."><span class="hs-operator hs-var">+.</span></a><span> </span><a href="#local-6989586621679032385"><span class="hs-identifier hs-var">a22</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032386"><span class="hs-identifier hs-var">b11</span></a><span> </span><a href="Data.Matrix.html#%2B."><span class="hs-operator hs-var">+.</span></a><span> </span><a href="#local-6989586621679032389"><span class="hs-identifier hs-var">b22</span></a><span class="hs-special">)</span><span>
</span><a name="line-1024"></a><span>  </span><a name="local-6989586621679032391"><a href="#local-6989586621679032391"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassenMixed"><span class="hs-identifier hs-var">strassenMixed</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032384"><span class="hs-identifier hs-var">a21</span></a><span> </span><a href="Data.Matrix.html#%2B."><span class="hs-operator hs-var">+.</span></a><span> </span><a href="#local-6989586621679032385"><span class="hs-identifier hs-var">a22</span></a><span class="hs-special">)</span><span>  </span><a href="#local-6989586621679032386"><span class="hs-identifier hs-var">b11</span></a><span>
</span><a name="line-1025"></a><span>  </span><a name="local-6989586621679032392"><a href="#local-6989586621679032392"><span class="hs-identifier">p3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassenMixed"><span class="hs-identifier hs-var">strassenMixed</span></a><span>  </span><a href="#local-6989586621679032382"><span class="hs-identifier hs-var">a11</span></a><span>         </span><span class="hs-special">(</span><a href="#local-6989586621679032387"><span class="hs-identifier hs-var">b12</span></a><span> </span><a href="Data.Matrix.html#-."><span class="hs-operator hs-var">-.</span></a><span> </span><a href="#local-6989586621679032389"><span class="hs-identifier hs-var">b22</span></a><span class="hs-special">)</span><span>
</span><a name="line-1026"></a><span>  </span><a name="local-6989586621679032393"><a href="#local-6989586621679032393"><span class="hs-identifier">p4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassenMixed"><span class="hs-identifier hs-var">strassenMixed</span></a><span>         </span><a href="#local-6989586621679032385"><span class="hs-identifier hs-var">a22</span></a><span>  </span><span class="hs-special">(</span><a href="#local-6989586621679032388"><span class="hs-identifier hs-var">b21</span></a><span> </span><a href="Data.Matrix.html#-."><span class="hs-operator hs-var">-.</span></a><span> </span><a href="#local-6989586621679032386"><span class="hs-identifier hs-var">b11</span></a><span class="hs-special">)</span><span>
</span><a name="line-1027"></a><span>  </span><a name="local-6989586621679032394"><a href="#local-6989586621679032394"><span class="hs-identifier">p5</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassenMixed"><span class="hs-identifier hs-var">strassenMixed</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032382"><span class="hs-identifier hs-var">a11</span></a><span> </span><a href="Data.Matrix.html#%2B."><span class="hs-operator hs-var">+.</span></a><span> </span><a href="#local-6989586621679032383"><span class="hs-identifier hs-var">a12</span></a><span class="hs-special">)</span><span>         </span><a href="#local-6989586621679032389"><span class="hs-identifier hs-var">b22</span></a><span>
</span><a name="line-1028"></a><span>  </span><a name="local-6989586621679032395"><a href="#local-6989586621679032395"><span class="hs-identifier">p6</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassenMixed"><span class="hs-identifier hs-var">strassenMixed</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032384"><span class="hs-identifier hs-var">a21</span></a><span> </span><a href="Data.Matrix.html#-."><span class="hs-operator hs-var">-.</span></a><span> </span><a href="#local-6989586621679032382"><span class="hs-identifier hs-var">a11</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032386"><span class="hs-identifier hs-var">b11</span></a><span> </span><a href="Data.Matrix.html#%2B."><span class="hs-operator hs-var">+.</span></a><span> </span><a href="#local-6989586621679032387"><span class="hs-identifier hs-var">b12</span></a><span class="hs-special">)</span><span>
</span><a name="line-1029"></a><span>  </span><a name="local-6989586621679032396"><a href="#local-6989586621679032396"><span class="hs-identifier">p7</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#strassenMixed"><span class="hs-identifier hs-var">strassenMixed</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032383"><span class="hs-identifier hs-var">a12</span></a><span> </span><a href="Data.Matrix.html#-."><span class="hs-operator hs-var">-.</span></a><span> </span><a href="#local-6989586621679032385"><span class="hs-identifier hs-var">a22</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032388"><span class="hs-identifier hs-var">b21</span></a><span> </span><a href="Data.Matrix.html#%2B."><span class="hs-operator hs-var">+.</span></a><span> </span><a href="#local-6989586621679032389"><span class="hs-identifier hs-var">b22</span></a><span class="hs-special">)</span><span>
</span><a name="line-1030"></a><span>
</span><a name="line-1031"></a><span class="hs-comment">-- | Mixed Strassen's matrix multiplication.</span><span>
</span><a name="line-1032"></a><span class="hs-identifier">multStrassenMixed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031475"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031475"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031475"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031475"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1033"></a><span class="hs-pragma">{-# INLINE multStrassenMixed #-}</span><span>
</span><a name="line-1034"></a><a name="multStrassenMixed"><a href="Data.Matrix.html#multStrassenMixed"><span class="hs-identifier">multStrassenMixed</span></a></a><span> </span><a name="local-6989586621679032419"><a href="#local-6989586621679032419"><span class="hs-identifier">a1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032420"><a href="#local-6989586621679032420"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032421"><a href="#local-6989586621679032421"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679032422"><a href="#local-6989586621679032422"><span class="hs-identifier">a2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032423"><a href="#local-6989586621679032423"><span class="hs-identifier">n'</span></a></a><span> </span><a name="local-6989586621679032424"><a href="#local-6989586621679032424"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1035"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032421"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679032423"><span class="hs-identifier hs-var">n'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Multiplication of &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><a href="#local-6989586621679032420"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032421"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; and &quot;</span><span>
</span><a name="line-1036"></a><span>                    </span><span class="hs-operator hs-var">++</span><span> </span><a href="Data.Matrix.html#sizeStr"><span class="hs-identifier hs-var">sizeStr</span></a><span> </span><a href="#local-6989586621679032423"><span class="hs-identifier hs-var">n'</span></a><span> </span><a href="#local-6989586621679032424"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; matrices.&quot;</span><span>
</span><a name="line-1037"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679032420"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="Data.Matrix.html#strmixFactor"><span class="hs-identifier hs-var">strmixFactor</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#multStd__"><span class="hs-identifier hs-var">multStd__</span></a><span> </span><a href="#local-6989586621679032419"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-6989586621679032422"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-1038"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1039"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032425"><a href="#local-6989586621679032425"><span class="hs-identifier">mx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maximum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679032420"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><a href="#local-6989586621679032421"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><a href="#local-6989586621679032423"><span class="hs-identifier hs-var">n'</span></a><span class="hs-special">,</span><a href="#local-6989586621679032424"><span class="hs-identifier hs-var">m'</span></a><span class="hs-special">]</span><span>
</span><a name="line-1040"></a><span>           </span><a name="local-6989586621679032426"><a href="#local-6989586621679032426"><span class="hs-identifier">n2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">even</span><span> </span><a href="#local-6989586621679032425"><span class="hs-identifier hs-var">mx</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032425"><span class="hs-identifier hs-var">mx</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679032425"><span class="hs-identifier hs-var">mx</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span>
</span><a name="line-1041"></a><span>           </span><a name="local-6989586621679032427"><a href="#local-6989586621679032427"><span class="hs-identifier">b1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#setSize"><span class="hs-identifier hs-var">setSize</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032426"><span class="hs-identifier hs-var">n2</span></a><span> </span><a href="#local-6989586621679032426"><span class="hs-identifier hs-var">n2</span></a><span> </span><a href="#local-6989586621679032419"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-1042"></a><span>           </span><a name="local-6989586621679032428"><a href="#local-6989586621679032428"><span class="hs-identifier">b2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#setSize"><span class="hs-identifier hs-var">setSize</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679032426"><span class="hs-identifier hs-var">n2</span></a><span> </span><a href="#local-6989586621679032426"><span class="hs-identifier hs-var">n2</span></a><span> </span><a href="#local-6989586621679032422"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-1043"></a><span>       </span><span class="hs-keyword">in</span><span>  </span><a href="Data.Matrix.html#submatrix"><span class="hs-identifier hs-var">submatrix</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032420"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032424"><span class="hs-identifier hs-var">m'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Matrix.html#strassenMixed"><span class="hs-identifier hs-var">strassenMixed</span></a><span> </span><a href="#local-6989586621679032427"><span class="hs-identifier hs-var">b1</span></a><span> </span><a href="#local-6989586621679032428"><span class="hs-identifier hs-var">b2</span></a><span>
</span><a name="line-1044"></a><span>
</span><a name="line-1045"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-1046"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-1047"></a><span class="hs-comment">---- NUMERICAL INSTANCE</span><span>
</span><a name="line-1048"></a><span>
</span><a name="line-1049"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679030897"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679030897"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1050"></a><span> </span><a name="local-3458764513820541088"><span class="hs-identifier">fromInteger</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span>
</span><a name="line-1051"></a><span> </span><a name="local-3458764513820541097"><span class="hs-identifier">negate</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">negate</span><span>
</span><a name="line-1052"></a><span> </span><a name="local-8214565720323790307"><span class="hs-identifier">abs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">abs</span><span>
</span><a name="line-1053"></a><span> </span><a name="local-8214565720323790306"><span class="hs-identifier">signum</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">signum</span><span>
</span><a name="line-1054"></a><span>
</span><a name="line-1055"></a><span> </span><span class="hs-comment">-- Addition of matrices.</span><span>
</span><a name="line-1056"></a><span> </span><span class="hs-pragma">{-# SPECIALIZE (+) :: Matrix Double -&gt; Matrix Double -&gt; Matrix Double #-}</span><span>
</span><a name="line-1057"></a><span> </span><span class="hs-pragma">{-# SPECIALIZE (+) :: Matrix Int -&gt; Matrix Int -&gt; Matrix Int #-}</span><span>
</span><a name="line-1058"></a><span> </span><span class="hs-pragma">{-# SPECIALIZE (+) :: Matrix Rational -&gt; Matrix Rational -&gt; Matrix Rational #-}</span><span>
</span><a name="line-1059"></a><span> </span><span class="hs-special">(</span><a name="local-8214565720323790309"><span class="hs-operator">+</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#elementwise"><span class="hs-identifier hs-var">elementwise</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span>
</span><a name="line-1060"></a><span>
</span><a name="line-1061"></a><span> </span><span class="hs-comment">-- Substraction of matrices.</span><span>
</span><a name="line-1062"></a><span> </span><span class="hs-pragma">{-# SPECIALIZE (-) :: Matrix Double -&gt; Matrix Double -&gt; Matrix Double #-}</span><span>
</span><a name="line-1063"></a><span> </span><span class="hs-pragma">{-# SPECIALIZE (-) :: Matrix Int -&gt; Matrix Int -&gt; Matrix Int #-}</span><span>
</span><a name="line-1064"></a><span> </span><span class="hs-pragma">{-# SPECIALIZE (-) :: Matrix Rational -&gt; Matrix Rational -&gt; Matrix Rational #-}</span><span>
</span><a name="line-1065"></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#elementwise"><span class="hs-identifier hs-var">elementwise</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span>
</span><a name="line-1066"></a><span>
</span><a name="line-1067"></a><span> </span><span class="hs-comment">-- Multiplication of matrices.</span><span>
</span><a name="line-1068"></a><span> </span><span class="hs-pragma">{-# INLINE (*) #-}</span><span>
</span><a name="line-1069"></a><span> </span><span class="hs-special">(</span><a name="local-8214565720323790308"><span class="hs-operator">*</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#multStrassenMixed"><span class="hs-identifier hs-var">multStrassenMixed</span></a><span>
</span><a name="line-1070"></a><span>
</span><a name="line-1071"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-1072"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-1073"></a><span class="hs-comment">---- TRANSFORMATIONS</span><span>
</span><a name="line-1074"></a><span>
</span><a name="line-1075"></a><span class="hs-comment">-- | Scale a matrix by a given factor.</span><span>
</span><a name="line-1076"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-1077"></a><span class="hs-comment">--</span><span>
</span><a name="line-1078"></a><span class="hs-comment">-- &gt;               ( 1 2 3 )   (  2  4  6 )</span><span>
</span><a name="line-1079"></a><span class="hs-comment">-- &gt;               ( 4 5 6 )   (  8 10 12 )</span><span>
</span><a name="line-1080"></a><span class="hs-comment">-- &gt; scaleMatrix 2 ( 7 8 9 ) = ( 14 16 18 )</span><span>
</span><a name="line-1081"></a><span class="hs-identifier">scaleMatrix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031474"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679031474"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031474"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031474"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1082"></a><a name="scaleMatrix"><a href="Data.Matrix.html#scaleMatrix"><span class="hs-identifier">scaleMatrix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span>
</span><a name="line-1083"></a><span>
</span><a name="line-1084"></a><span class="hs-comment">-- | Scale a row by a given factor.</span><span>
</span><a name="line-1085"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-1086"></a><span class="hs-comment">--</span><span>
</span><a name="line-1087"></a><span class="hs-comment">-- &gt;              ( 1 2 3 )   (  1  2  3 )</span><span>
</span><a name="line-1088"></a><span class="hs-comment">-- &gt;              ( 4 5 6 )   (  8 10 12 )</span><span>
</span><a name="line-1089"></a><span class="hs-comment">-- &gt; scaleRow 2 2 ( 7 8 9 ) = (  7  8  9 )</span><span>
</span><a name="line-1090"></a><span class="hs-identifier">scaleRow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031473"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679031473"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031473"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031473"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1091"></a><a name="scaleRow"><a href="Data.Matrix.html#scaleRow"><span class="hs-identifier">scaleRow</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#mapRow"><span class="hs-identifier hs-var">mapRow</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span>
</span><a name="line-1092"></a><span>
</span><a name="line-1093"></a><span class="hs-comment">-- | Add to one row a scalar multiple of another row.</span><span>
</span><a name="line-1094"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-1095"></a><span class="hs-comment">--</span><span>
</span><a name="line-1096"></a><span class="hs-comment">-- &gt;                   ( 1 2 3 )   (  1  2  3 )</span><span>
</span><a name="line-1097"></a><span class="hs-comment">-- &gt;                   ( 4 5 6 )   (  6  9 12 )</span><span>
</span><a name="line-1098"></a><span class="hs-comment">-- &gt; combineRows 2 2 1 ( 7 8 9 ) = (  7  8  9 )</span><span>
</span><a name="line-1099"></a><span class="hs-identifier">combineRows</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031472"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031472"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031472"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031472"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1100"></a><a name="combineRows"><a href="Data.Matrix.html#combineRows"><span class="hs-identifier">combineRows</span></a></a><span> </span><a name="local-6989586621679032429"><a href="#local-6989586621679032429"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621679032430"><a href="#local-6989586621679032430"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679032431"><a href="#local-6989586621679032431"><span class="hs-identifier">r2</span></a></a><span> </span><a name="local-6989586621679032432"><a href="#local-6989586621679032432"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#mapRow"><span class="hs-identifier hs-var">mapRow</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679032433"><a href="#local-6989586621679032433"><span class="hs-identifier">j</span></a></a><span> </span><a name="local-6989586621679032434"><a href="#local-6989586621679032434"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032434"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679032430"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="Data.Matrix.html#getElem"><span class="hs-identifier hs-var">getElem</span></a><span> </span><a href="#local-6989586621679032431"><span class="hs-identifier hs-var">r2</span></a><span> </span><a href="#local-6989586621679032433"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032432"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032429"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-6989586621679032432"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-1101"></a><span>
</span><a name="line-1102"></a><span class="hs-comment">-- | Switch two rows of a matrix.</span><span>
</span><a name="line-1103"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-1104"></a><span class="hs-comment">--</span><span>
</span><a name="line-1105"></a><span class="hs-comment">-- &gt;                ( 1 2 3 )   ( 4 5 6 )</span><span>
</span><a name="line-1106"></a><span class="hs-comment">-- &gt;                ( 4 5 6 )   ( 1 2 3 )</span><span>
</span><a name="line-1107"></a><span class="hs-comment">-- &gt; switchRows 1 2 ( 7 8 9 ) = ( 7 8 9 )</span><span>
</span><a name="line-1108"></a><span class="hs-identifier">switchRows</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Row 1.</span><span>
</span><a name="line-1109"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Row 2.</span><span>
</span><a name="line-1110"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031471"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Original matrix.</span><span>
</span><a name="line-1111"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031471"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Matrix with rows 1 and 2 switched.</span><span>
</span><a name="line-1112"></a><a name="switchRows"><a href="Data.Matrix.html#switchRows"><span class="hs-identifier">switchRows</span></a></a><span> </span><a name="local-6989586621679032435"><a href="#local-6989586621679032435"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621679032436"><a href="#local-6989586621679032436"><span class="hs-identifier">r2</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032437"><a href="#local-6989586621679032437"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032438"><a href="#local-6989586621679032438"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032439"><a href="#local-6989586621679032439"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032440"><a href="#local-6989586621679032440"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679032441"><a href="#local-6989586621679032441"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032442"><a href="#local-6989586621679032442"><span class="hs-identifier">vs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a href="#local-6989586621679032437"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032438"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679032439"><span class="hs-identifier hs-var">ro</span></a><span> </span><a href="#local-6989586621679032440"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679032441"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679032443"><a href="#local-6989586621679032443"><span class="hs-identifier">mv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1113"></a><span>  </span><span class="hs-identifier hs-var">numLoop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032438"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032444"><a href="#local-6989586621679032444"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1114"></a><span>    </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">swap</span><span> </span><a href="#local-6989586621679032443"><span class="hs-identifier hs-var">mv</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032441"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032435"><span class="hs-identifier hs-var">r1</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032439"><span class="hs-identifier hs-var">ro</span></a><span class="hs-special">,</span><a href="#local-6989586621679032444"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032440"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032441"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032436"><span class="hs-identifier hs-var">r2</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032439"><span class="hs-identifier hs-var">ro</span></a><span class="hs-special">,</span><a href="#local-6989586621679032444"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032440"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032442"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-1115"></a><span>
</span><a name="line-1116"></a><span class="hs-comment">-- | Switch two coumns of a matrix.</span><span>
</span><a name="line-1117"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-1118"></a><span class="hs-comment">--</span><span>
</span><a name="line-1119"></a><span class="hs-comment">-- &gt;                ( 1 2 3 )   ( 2 1 3 )</span><span>
</span><a name="line-1120"></a><span class="hs-comment">-- &gt;                ( 4 5 6 )   ( 5 4 6 )</span><span>
</span><a name="line-1121"></a><span class="hs-comment">-- &gt; switchCols 1 2 ( 7 8 9 ) = ( 8 7 9 )</span><span>
</span><a name="line-1122"></a><span class="hs-identifier">switchCols</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Col 1.</span><span>
</span><a name="line-1123"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Col 2.</span><span>
</span><a name="line-1124"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031470"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Original matrix.</span><span>
</span><a name="line-1125"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031470"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Matrix with cols 1 and 2 switched.</span><span>
</span><a name="line-1126"></a><a name="switchCols"><a href="Data.Matrix.html#switchCols"><span class="hs-identifier">switchCols</span></a></a><span> </span><a name="local-6989586621679032445"><a href="#local-6989586621679032445"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621679032446"><a href="#local-6989586621679032446"><span class="hs-identifier">c2</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-6989586621679032447"><a href="#local-6989586621679032447"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679032448"><a href="#local-6989586621679032448"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679032449"><a href="#local-6989586621679032449"><span class="hs-identifier">ro</span></a></a><span> </span><a name="local-6989586621679032450"><a href="#local-6989586621679032450"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621679032451"><a href="#local-6989586621679032451"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679032452"><a href="#local-6989586621679032452"><span class="hs-identifier">vs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a href="#local-6989586621679032447"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679032448"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679032449"><span class="hs-identifier hs-var">ro</span></a><span> </span><a href="#local-6989586621679032450"><span class="hs-identifier hs-var">co</span></a><span> </span><a href="#local-6989586621679032451"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679032453"><a href="#local-6989586621679032453"><span class="hs-identifier">mv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1127"></a><span>  </span><span class="hs-identifier hs-var">numLoop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032447"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679032454"><a href="#local-6989586621679032454"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1128"></a><span>    </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">swap</span><span> </span><a href="#local-6989586621679032453"><span class="hs-identifier hs-var">mv</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032448"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032454"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032449"><span class="hs-identifier hs-var">ro</span></a><span class="hs-special">,</span><a href="#local-6989586621679032445"><span class="hs-identifier hs-var">c1</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032450"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032448"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032454"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032449"><span class="hs-identifier hs-var">ro</span></a><span class="hs-special">,</span><a href="#local-6989586621679032446"><span class="hs-identifier hs-var">c2</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032450"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032452"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-1129"></a><span>
</span><a name="line-1130"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-1131"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-1132"></a><span class="hs-comment">---- DECOMPOSITIONS</span><span>
</span><a name="line-1133"></a><span>
</span><a name="line-1134"></a><span class="hs-comment">-- LU DECOMPOSITION</span><span>
</span><a name="line-1135"></a><span>
</span><a name="line-1136"></a><span class="hs-comment">-- | Matrix LU decomposition with /partial pivoting/.</span><span>
</span><a name="line-1137"></a><span class="hs-comment">--   The result for a matrix /M/ is given in the format /(U,L,P,d)/ where:</span><span>
</span><a name="line-1138"></a><span class="hs-comment">--</span><span>
</span><a name="line-1139"></a><span class="hs-comment">--   * /U/ is an upper triangular matrix.</span><span>
</span><a name="line-1140"></a><span class="hs-comment">--</span><span>
</span><a name="line-1141"></a><span class="hs-comment">--   * /L/ is an /unit/ lower triangular matrix.</span><span>
</span><a name="line-1142"></a><span class="hs-comment">--</span><span>
</span><a name="line-1143"></a><span class="hs-comment">--   * /P/ is a permutation matrix.</span><span>
</span><a name="line-1144"></a><span class="hs-comment">--</span><span>
</span><a name="line-1145"></a><span class="hs-comment">--   * /d/ is the determinant of /P/.</span><span>
</span><a name="line-1146"></a><span class="hs-comment">--</span><span>
</span><a name="line-1147"></a><span class="hs-comment">--   * /PM = LU/.</span><span>
</span><a name="line-1148"></a><span class="hs-comment">--</span><span>
</span><a name="line-1149"></a><span class="hs-comment">--   These properties are only guaranteed when the input matrix is invertible.</span><span>
</span><a name="line-1150"></a><span class="hs-comment">--   An additional property matches thanks to the strategy followed for pivoting:</span><span>
</span><a name="line-1151"></a><span class="hs-comment">--</span><span>
</span><a name="line-1152"></a><span class="hs-comment">--   * /L_(i,j)/ &lt;= 1, for all /i,j/.</span><span>
</span><a name="line-1153"></a><span class="hs-comment">--</span><span>
</span><a name="line-1154"></a><span class="hs-comment">--   This follows from the maximal property of the selected pivots, which also</span><span>
</span><a name="line-1155"></a><span class="hs-comment">--   leads to a better numerical stability of the algorithm.</span><span>
</span><a name="line-1156"></a><span class="hs-comment">--</span><span>
</span><a name="line-1157"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-1158"></a><span class="hs-comment">--</span><span>
</span><a name="line-1159"></a><span class="hs-comment">-- &gt;          ( 1 2 0 )     ( 2 0  2 )   (   1 0 0 )   ( 0 0 1 )</span><span>
</span><a name="line-1160"></a><span class="hs-comment">-- &gt;          ( 0 2 1 )     ( 0 2 -1 )   ( 1/2 1 0 )   ( 1 0 0 )</span><span>
</span><a name="line-1161"></a><span class="hs-comment">-- &gt; luDecomp ( 2 0 2 ) = ( ( 0 0  2 ) , (   0 1 1 ) , ( 0 1 0 ) , 1 )</span><span>
</span><a name="line-1162"></a><span class="hs-comment">--</span><span>
</span><a name="line-1163"></a><span class="hs-comment">--   'Nothing' is returned if no LU decomposition exists.</span><span>
</span><a name="line-1164"></a><span class="hs-identifier">luDecomp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679031469"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679031469"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031469"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031469"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031469"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031469"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679031469"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1165"></a><a name="luDecomp"><a href="Data.Matrix.html#luDecomp"><span class="hs-identifier">luDecomp</span></a></a><span> </span><a name="local-6989586621679032455"><a href="#local-6989586621679032455"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#recLUDecomp"><span class="hs-identifier hs-var">recLUDecomp</span></a><span> </span><a href="#local-6989586621679032455"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679032456"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032456"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032457"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1166"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1167"></a><span>  </span><a name="local-6989586621679032456"><a href="#local-6989586621679032456"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#identity"><span class="hs-identifier hs-var">identity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032455"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1168"></a><span>  </span><a name="local-6989586621679032457"><a href="#local-6989586621679032457"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">min</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032455"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032455"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1169"></a><span>
</span><a name="line-1170"></a><span class="hs-identifier">recLUDecomp</span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679031468"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679031468"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1171"></a><span>            </span><span class="hs-glyph">=&gt;</span><span>  </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031468"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ U</span><span>
</span><a name="line-1172"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031468"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ L</span><span>
</span><a name="line-1173"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031468"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ P</span><span>
</span><a name="line-1174"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="#local-6989586621679031468"><span class="hs-identifier hs-type">a</span></a><span>        </span><span class="hs-comment">-- ^ d</span><span>
</span><a name="line-1175"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ Current row</span><span>
</span><a name="line-1176"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ Total rows</span><span>
</span><a name="line-1177"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031468"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031468"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031468"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679031468"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1178"></a><a name="recLUDecomp"><a href="Data.Matrix.html#recLUDecomp"><span class="hs-identifier">recLUDecomp</span></a></a><span> </span><a name="local-6989586621679032458"><a href="#local-6989586621679032458"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621679032459"><a href="#local-6989586621679032459"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679032460"><a href="#local-6989586621679032460"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679032461"><a href="#local-6989586621679032461"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-6989586621679032462"><a href="#local-6989586621679032462"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679032463"><a href="#local-6989586621679032463"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1179"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679032463"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032458"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">,</span><a href="#local-6989586621679032459"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679032460"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679032461"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-1180"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032471"><span class="hs-identifier hs-var">ukk</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1181"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><a href="Data.Matrix.html#recLUDecomp"><span class="hs-identifier hs-var">recLUDecomp</span></a><span> </span><a href="#local-6989586621679032469"><span class="hs-identifier hs-var">u''</span></a><span> </span><a href="#local-6989586621679032470"><span class="hs-identifier hs-var">l''</span></a><span> </span><a href="#local-6989586621679032467"><span class="hs-identifier hs-var">p'</span></a><span> </span><a href="#local-6989586621679032468"><span class="hs-identifier hs-var">d'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032463"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1182"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1183"></a><span>  </span><span class="hs-comment">-- Pivot strategy: maximum value in absolute value below the current row.</span><span>
</span><a name="line-1184"></a><span>  </span><a name="local-6989586621679032464"><a href="#local-6989586621679032464"><span class="hs-identifier">i</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maximumBy</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679032473"><a href="#local-6989586621679032473"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679032474"><a href="#local-6989586621679032474"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">abs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032458"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032473"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">abs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032458"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032474"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679032463"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1185"></a><span>  </span><span class="hs-comment">-- Switching to place pivot in current row.</span><span>
</span><a name="line-1186"></a><span>  </span><a name="local-6989586621679032465"><a href="#local-6989586621679032465"><span class="hs-identifier">u'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#switchRows"><span class="hs-identifier hs-var">switchRows</span></a><span> </span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679032464"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032458"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-1187"></a><span>  </span><a name="local-6989586621679032466"><a href="#local-6989586621679032466"><span class="hs-identifier">l'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032475"><a href="#local-6989586621679032475"><span class="hs-identifier">lw</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">vcols</span><span> </span><a href="#local-6989586621679032459"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1188"></a><span>           </span><a name="local-6989586621679032476"><a href="#local-6989586621679032476"><span class="hs-identifier">en</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679032475"><span class="hs-identifier hs-var">lw</span></a><span>
</span><a name="line-1189"></a><span>           </span><a name="local-6989586621679032477"><a href="#local-6989586621679032477"><span class="hs-identifier">lro</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rowOffset</span><span> </span><a href="#local-6989586621679032459"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1190"></a><span>           </span><a name="local-6989586621679032478"><a href="#local-6989586621679032478"><span class="hs-identifier">lco</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">colOffset</span><span> </span><a href="#local-6989586621679032459"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1191"></a><span>       </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032464"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-1192"></a><span>              </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032459"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1193"></a><span>              </span><span class="hs-keyword">else</span><span> </span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032459"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032459"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032477"><span class="hs-identifier hs-var">lro</span></a><span> </span><a href="#local-6989586621679032478"><span class="hs-identifier hs-var">lco</span></a><span> </span><a href="#local-6989586621679032475"><span class="hs-identifier hs-var">lw</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1194"></a><span>                     </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679032479"><a href="#local-6989586621679032479"><span class="hs-identifier">mv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">forM_</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span>
</span><a name="line-1195"></a><span>                                 </span><span class="hs-glyph">\</span><a name="local-6989586621679032480"><a href="#local-6989586621679032480"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">MV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">swap</span><span> </span><a href="#local-6989586621679032479"><span class="hs-identifier hs-var">mv</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032476"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032464"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032477"><span class="hs-identifier hs-var">lro</span></a><span class="hs-special">,</span><a href="#local-6989586621679032480"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032478"><span class="hs-identifier hs-var">lco</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1196"></a><span>                                                  </span><span class="hs-special">(</span><a href="#local-6989586621679032476"><span class="hs-identifier hs-var">en</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032477"><span class="hs-identifier hs-var">lro</span></a><span class="hs-special">,</span><a href="#local-6989586621679032480"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621679032478"><span class="hs-identifier hs-var">lco</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1197"></a><span>                                </span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">mvect</span><span> </span><a href="#local-6989586621679032459"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1198"></a><span>  </span><a name="local-6989586621679032467"><a href="#local-6989586621679032467"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#switchRows"><span class="hs-identifier hs-var">switchRows</span></a><span> </span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679032464"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032460"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1199"></a><span>  </span><span class="hs-comment">-- Permutation determinant</span><span>
</span><a name="line-1200"></a><span>  </span><a name="local-6989586621679032468"><a href="#local-6989586621679032468"><span class="hs-identifier">d'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032464"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032461"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="#local-6989586621679032461"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-1201"></a><span>  </span><span class="hs-comment">-- Cancel elements below the pivot.</span><span>
</span><a name="line-1202"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679032469"><a href="#local-6989586621679032469"><span class="hs-identifier">u''</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032470"><a href="#local-6989586621679032470"><span class="hs-identifier">l''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032472"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679032465"><span class="hs-identifier hs-var">u'</span></a><span> </span><a href="#local-6989586621679032466"><span class="hs-identifier hs-var">l'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1203"></a><span>  </span><a name="local-6989586621679032471"><a href="#local-6989586621679032471"><span class="hs-identifier">ukk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032465"><span class="hs-identifier hs-var">u'</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-1204"></a><span>  </span><a name="local-6989586621679032472"><a href="#local-6989586621679032472"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679032481"><a href="#local-6989586621679032481"><span class="hs-identifier">u_</span></a></a><span> </span><a name="local-6989586621679032482"><a href="#local-6989586621679032482"><span class="hs-identifier">l_</span></a></a><span> </span><a name="local-6989586621679032483"><a href="#local-6989586621679032483"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1205"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032483"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032481"><span class="hs-identifier hs-var">u_</span></a><span>
</span><a name="line-1206"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032481"><span class="hs-identifier hs-var">u_</span></a><span class="hs-special">,</span><a href="#local-6989586621679032482"><span class="hs-identifier hs-var">l_</span></a><span class="hs-special">)</span><span>
</span><a name="line-1207"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032484"><a href="#local-6989586621679032484"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032481"><span class="hs-identifier hs-var">u_</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032483"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">,</span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="#local-6989586621679032471"><span class="hs-identifier hs-var">ukk</span></a><span>
</span><a name="line-1208"></a><span>         </span><span class="hs-keyword">in</span><span>  </span><a href="#local-6989586621679032472"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#combineRows"><span class="hs-identifier hs-var">combineRows</span></a><span> </span><a href="#local-6989586621679032483"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621679032484"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679032481"><span class="hs-identifier hs-var">u_</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#setElem"><span class="hs-identifier hs-var">setElem</span></a><span> </span><a href="#local-6989586621679032484"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032483"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">,</span><a href="#local-6989586621679032462"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032482"><span class="hs-identifier hs-var">l_</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032483"><span class="hs-identifier hs-var">j</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1209"></a><span>
</span><a name="line-1210"></a><span class="hs-comment">-- | Unsafe version of 'luDecomp'. It fails when the input matrix is singular.</span><span>
</span><a name="line-1211"></a><span class="hs-identifier">luDecompUnsafe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679031467"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679031467"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031467"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031467"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031467"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031467"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679031467"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1212"></a><a name="luDecompUnsafe"><a href="Data.Matrix.html#luDecompUnsafe"><span class="hs-identifier">luDecompUnsafe</span></a></a><span> </span><a name="local-6989586621679032485"><a href="#local-6989586621679032485"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Data.Matrix.html#luDecomp"><span class="hs-identifier hs-var">luDecomp</span></a><span> </span><a href="#local-6989586621679032485"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1213"></a><span>  </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679032486"><a href="#local-6989586621679032486"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032486"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1214"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;luDecompUnsafe of singular matrix.&quot;</span><span>
</span><a name="line-1215"></a><span>
</span><a name="line-1216"></a><span class="hs-comment">-- | Matrix LU decomposition with /complete pivoting/.</span><span>
</span><a name="line-1217"></a><span class="hs-comment">--   The result for a matrix /M/ is given in the format /(U,L,P,Q,d,e)/ where:</span><span>
</span><a name="line-1218"></a><span class="hs-comment">--</span><span>
</span><a name="line-1219"></a><span class="hs-comment">--   * /U/ is an upper triangular matrix.</span><span>
</span><a name="line-1220"></a><span class="hs-comment">--</span><span>
</span><a name="line-1221"></a><span class="hs-comment">--   * /L/ is an /unit/ lower triangular matrix.</span><span>
</span><a name="line-1222"></a><span class="hs-comment">--</span><span>
</span><a name="line-1223"></a><span class="hs-comment">--   * /P,Q/ are permutation matrices.</span><span>
</span><a name="line-1224"></a><span class="hs-comment">--</span><span>
</span><a name="line-1225"></a><span class="hs-comment">--   * /d,e/ are the determinants of /P/ and /Q/ respectively.</span><span>
</span><a name="line-1226"></a><span class="hs-comment">--</span><span>
</span><a name="line-1227"></a><span class="hs-comment">--   * /PMQ = LU/.</span><span>
</span><a name="line-1228"></a><span class="hs-comment">--</span><span>
</span><a name="line-1229"></a><span class="hs-comment">--   These properties are only guaranteed when the input matrix is invertible.</span><span>
</span><a name="line-1230"></a><span class="hs-comment">--   An additional property matches thanks to the strategy followed for pivoting:</span><span>
</span><a name="line-1231"></a><span class="hs-comment">--</span><span>
</span><a name="line-1232"></a><span class="hs-comment">--   * /L_(i,j)/ &lt;= 1, for all /i,j/.</span><span>
</span><a name="line-1233"></a><span class="hs-comment">--</span><span>
</span><a name="line-1234"></a><span class="hs-comment">--   This follows from the maximal property of the selected pivots, which also</span><span>
</span><a name="line-1235"></a><span class="hs-comment">--   leads to a better numerical stability of the algorithm.</span><span>
</span><a name="line-1236"></a><span class="hs-comment">--</span><span>
</span><a name="line-1237"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-1238"></a><span class="hs-comment">--</span><span>
</span><a name="line-1239"></a><span class="hs-comment">-- &gt;           ( 1 0 )     ( 2 1 )   (   1    0 0 )   ( 0 0 1 )</span><span>
</span><a name="line-1240"></a><span class="hs-comment">-- &gt;           ( 0 2 )     ( 0 2 )   (   0    1 0 )   ( 0 1 0 )   ( 1 0 )</span><span>
</span><a name="line-1241"></a><span class="hs-comment">-- &gt; luDecomp' ( 2 1 ) = ( ( 0 0 ) , ( 1/2 -1/4 1 ) , ( 1 0 0 ) , ( 0 1 ) , -1 , 1 )</span><span>
</span><a name="line-1242"></a><span class="hs-comment">--</span><span>
</span><a name="line-1243"></a><span class="hs-comment">--   'Nothing' is returned if no LU decomposition exists.</span><span>
</span><a name="line-1244"></a><span class="hs-identifier">luDecomp'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679031466"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679031466"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031466"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031466"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031466"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031466"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031466"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679031466"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679031466"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1245"></a><a name="luDecomp%27"><a href="Data.Matrix.html#luDecomp%27"><span class="hs-identifier">luDecomp'</span></a></a><span> </span><a name="local-6989586621679032487"><a href="#local-6989586621679032487"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#recLUDecomp%27"><span class="hs-identifier hs-var">recLUDecomp'</span></a><span> </span><a href="#local-6989586621679032487"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679032488"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032488"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#identity"><span class="hs-identifier hs-var">identity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032487"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032489"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1246"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1247"></a><span>  </span><a name="local-6989586621679032488"><a href="#local-6989586621679032488"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#identity"><span class="hs-identifier hs-var">identity</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032487"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1248"></a><span>  </span><a name="local-6989586621679032489"><a href="#local-6989586621679032489"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">min</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032487"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032487"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1249"></a><span>
</span><a name="line-1250"></a><span class="hs-comment">-- | Unsafe version of 'luDecomp''. It fails when the input matrix is singular.</span><span>
</span><a name="line-1251"></a><span class="hs-identifier">luDecompUnsafe'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679031465"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679031465"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031465"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031465"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031465"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031465"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031465"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679031465"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679031465"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1252"></a><a name="luDecompUnsafe%27"><a href="Data.Matrix.html#luDecompUnsafe%27"><span class="hs-identifier">luDecompUnsafe'</span></a></a><span> </span><a name="local-6989586621679032490"><a href="#local-6989586621679032490"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Data.Matrix.html#luDecomp%27"><span class="hs-identifier hs-var">luDecomp'</span></a><span> </span><a href="#local-6989586621679032490"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1253"></a><span>  </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679032491"><a href="#local-6989586621679032491"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032491"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1254"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;luDecompUnsafe' of singular matrix.&quot;</span><span>
</span><a name="line-1255"></a><span>
</span><a name="line-1256"></a><span class="hs-identifier">recLUDecomp'</span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1257"></a><span>            </span><span class="hs-glyph">=&gt;</span><span>  </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ U</span><span>
</span><a name="line-1258"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ L</span><span>
</span><a name="line-1259"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ P</span><span>
</span><a name="line-1260"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Q</span><span>
</span><a name="line-1261"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span>        </span><span class="hs-comment">-- ^ d</span><span>
</span><a name="line-1262"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span>        </span><span class="hs-comment">-- ^ e</span><span>
</span><a name="line-1263"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ Current row</span><span>
</span><a name="line-1264"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier hs-type">Int</span><span>      </span><span class="hs-comment">-- ^ Total rows</span><span>
</span><a name="line-1265"></a><span>            </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679031464"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1266"></a><a name="recLUDecomp%27"><a href="Data.Matrix.html#recLUDecomp%27"><span class="hs-identifier">recLUDecomp'</span></a></a><span> </span><a name="local-6989586621679032492"><a href="#local-6989586621679032492"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621679032493"><a href="#local-6989586621679032493"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679032494"><a href="#local-6989586621679032494"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679032495"><a href="#local-6989586621679032495"><span class="hs-identifier">q</span></a></a><span> </span><a name="local-6989586621679032496"><a href="#local-6989586621679032496"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-6989586621679032497"><a href="#local-6989586621679032497"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679032498"><a href="#local-6989586621679032498"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679032499"><a href="#local-6989586621679032499"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1267"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679032499"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679032509"><span class="hs-identifier hs-var">u''</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1268"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032492"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">,</span><a href="#local-6989586621679032493"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679032494"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679032495"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">,</span><a href="#local-6989586621679032496"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><a href="#local-6989586621679032497"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1269"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032511"><span class="hs-identifier hs-var">ukk</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1270"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1271"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="Data.Matrix.html#recLUDecomp%27"><span class="hs-identifier hs-var">recLUDecomp'</span></a><span> </span><a href="#local-6989586621679032509"><span class="hs-identifier hs-var">u''</span></a><span> </span><a href="#local-6989586621679032510"><span class="hs-identifier hs-var">l''</span></a><span> </span><a href="#local-6989586621679032505"><span class="hs-identifier hs-var">p'</span></a><span> </span><a href="#local-6989586621679032506"><span class="hs-identifier hs-var">q'</span></a><span> </span><a href="#local-6989586621679032507"><span class="hs-identifier hs-var">d'</span></a><span> </span><a href="#local-6989586621679032508"><span class="hs-identifier hs-var">e'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032499"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1272"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1273"></a><span>  </span><span class="hs-comment">-- Pivot strategy: maximum value in absolute value below the current row &amp; col.</span><span>
</span><a name="line-1274"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679032500"><a href="#local-6989586621679032500"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679032501"><a href="#local-6989586621679032501"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maximumBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comparing</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679032513"><a href="#local-6989586621679032513"><span class="hs-identifier">i0</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679032514"><a href="#local-6989586621679032514"><span class="hs-identifier">j0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">abs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679032492"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032513"><span class="hs-identifier hs-var">i0</span></a><span class="hs-special">,</span><a href="#local-6989586621679032514"><span class="hs-identifier hs-var">j0</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1275"></a><span>           </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032515"><span class="hs-identifier hs-var">i0</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032516"><span class="hs-identifier hs-var">j0</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032515"><a href="#local-6989586621679032515"><span class="hs-identifier">i0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032492"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679032516"><a href="#local-6989586621679032516"><span class="hs-identifier">j0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032492"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1276"></a><span>  </span><span class="hs-comment">-- Switching to place pivot in current row.</span><span>
</span><a name="line-1277"></a><span>  </span><a name="local-6989586621679032502"><a href="#local-6989586621679032502"><span class="hs-identifier">u'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#switchCols"><span class="hs-identifier hs-var">switchCols</span></a><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679032501"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Matrix.html#switchRows"><span class="hs-identifier hs-var">switchRows</span></a><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679032500"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032492"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-1278"></a><span>  </span><a name="local-6989586621679032503"><a href="#local-6989586621679032503"><span class="hs-identifier">l'0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#switchRows"><span class="hs-identifier hs-var">switchRows</span></a><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679032500"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032493"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1279"></a><span>  </span><a name="local-6989586621679032504"><a href="#local-6989586621679032504"><span class="hs-identifier">l'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#switchCols"><span class="hs-identifier hs-var">switchCols</span></a><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679032500"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032503"><span class="hs-identifier hs-var">l'0</span></a><span>
</span><a name="line-1280"></a><span>  </span><a name="local-6989586621679032505"><a href="#local-6989586621679032505"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#switchRows"><span class="hs-identifier hs-var">switchRows</span></a><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679032500"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679032494"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1281"></a><span>  </span><a name="local-6989586621679032506"><a href="#local-6989586621679032506"><span class="hs-identifier">q'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#switchCols"><span class="hs-identifier hs-var">switchCols</span></a><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679032501"><span class="hs-identifier hs-var">j</span></a><span> </span><a href="#local-6989586621679032495"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-1282"></a><span>  </span><span class="hs-comment">-- Permutation determinant</span><span>
</span><a name="line-1283"></a><span>  </span><a name="local-6989586621679032507"><a href="#local-6989586621679032507"><span class="hs-identifier">d'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032500"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032496"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="#local-6989586621679032496"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-1284"></a><span>  </span><a name="local-6989586621679032508"><a href="#local-6989586621679032508"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032501"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679032497"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="#local-6989586621679032497"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1285"></a><span>  </span><span class="hs-comment">-- Cancel elements below the pivot.</span><span>
</span><a name="line-1286"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679032509"><a href="#local-6989586621679032509"><span class="hs-identifier">u''</span></a></a><span class="hs-special">,</span><a name="local-6989586621679032510"><a href="#local-6989586621679032510"><span class="hs-identifier">l''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032512"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679032502"><span class="hs-identifier hs-var">u'</span></a><span> </span><a href="#local-6989586621679032504"><span class="hs-identifier hs-var">l'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1287"></a><span>  </span><a name="local-6989586621679032511"><a href="#local-6989586621679032511"><span class="hs-identifier">ukk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032502"><span class="hs-identifier hs-var">u'</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-1288"></a><span>  </span><a name="local-6989586621679032512"><a href="#local-6989586621679032512"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679032517"><a href="#local-6989586621679032517"><span class="hs-identifier">u_</span></a></a><span> </span><a name="local-6989586621679032518"><a href="#local-6989586621679032518"><span class="hs-identifier">l_</span></a></a><span> </span><a name="local-6989586621679032519"><a href="#local-6989586621679032519"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1289"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679032519"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032517"><span class="hs-identifier hs-var">u_</span></a><span>
</span><a name="line-1290"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032517"><span class="hs-identifier hs-var">u_</span></a><span class="hs-special">,</span><a href="#local-6989586621679032518"><span class="hs-identifier hs-var">l_</span></a><span class="hs-special">)</span><span>
</span><a name="line-1291"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679032520"><a href="#local-6989586621679032520"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032517"><span class="hs-identifier hs-var">u_</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032519"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">,</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="#local-6989586621679032511"><span class="hs-identifier hs-var">ukk</span></a><span>
</span><a name="line-1292"></a><span>         </span><span class="hs-keyword">in</span><span>  </span><a href="#local-6989586621679032512"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#combineRows"><span class="hs-identifier hs-var">combineRows</span></a><span> </span><a href="#local-6989586621679032519"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621679032520"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679032517"><span class="hs-identifier hs-var">u_</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#setElem"><span class="hs-identifier hs-var">setElem</span></a><span> </span><a href="#local-6989586621679032520"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032519"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">,</span><a href="#local-6989586621679032498"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032518"><span class="hs-identifier hs-var">l_</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032519"><span class="hs-identifier hs-var">h</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1293"></a><span>
</span><a name="line-1294"></a><span class="hs-comment">-- CHOLESKY DECOMPOSITION</span><span>
</span><a name="line-1295"></a><span>
</span><a name="line-1296"></a><span class="hs-comment">-- | Simple Cholesky decomposition of a symmetric, positive definite matrix.</span><span>
</span><a name="line-1297"></a><span class="hs-comment">--   The result for a matrix /M/ is a lower triangular matrix /L/ such that:</span><span>
</span><a name="line-1298"></a><span class="hs-comment">--</span><span>
</span><a name="line-1299"></a><span class="hs-comment">--   * /M = LL^T/.</span><span>
</span><a name="line-1300"></a><span class="hs-comment">--</span><span>
</span><a name="line-1301"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-1302"></a><span class="hs-comment">--</span><span>
</span><a name="line-1303"></a><span class="hs-comment">-- &gt;            (  2 -1  0 )   (  1.41  0     0    )</span><span>
</span><a name="line-1304"></a><span class="hs-comment">-- &gt;            ( -1  2 -1 )   ( -0.70  1.22  0    )</span><span>
</span><a name="line-1305"></a><span class="hs-comment">-- &gt; cholDecomp (  0 -1  2 ) = (  0.00 -0.81  1.15 )</span><span>
</span><a name="line-1306"></a><span class="hs-identifier">cholDecomp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Floating</span><span> </span><a href="#local-6989586621679031463"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031463"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031463"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1307"></a><a name="cholDecomp"><a href="Data.Matrix.html#cholDecomp"><span class="hs-identifier">cholDecomp</span></a></a><span> </span><a name="local-6989586621679032521"><a href="#local-6989586621679032521"><span class="hs-identifier">a</span></a></a><span>
</span><a name="line-1308"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032521"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032521"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">sqrt</span><span> </span><a href="#local-6989586621679032521"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1309"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#joinBlocks"><span class="hs-identifier hs-var">joinBlocks</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032527"><span class="hs-identifier hs-var">l11</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032528"><span class="hs-identifier hs-var">l12</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032529"><span class="hs-identifier hs-var">l21</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679032531"><span class="hs-identifier hs-var">l22</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1310"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679032522"><a href="#local-6989586621679032522"><span class="hs-identifier">a11</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679032523"><a href="#local-6989586621679032523"><span class="hs-identifier">a12</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679032524"><a href="#local-6989586621679032524"><span class="hs-identifier">a21</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679032525"><a href="#local-6989586621679032525"><span class="hs-identifier">a22</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#splitBlocks"><span class="hs-identifier hs-var">splitBlocks</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032521"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1311"></a><span>    </span><a name="local-6989586621679032526"><a href="#local-6989586621679032526"><span class="hs-identifier">l11'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sqrt</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032522"><span class="hs-identifier hs-var">a11</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1312"></a><span>    </span><a name="local-6989586621679032527"><a href="#local-6989586621679032527"><span class="hs-identifier">l11</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679032526"><span class="hs-identifier hs-var">l11'</span></a><span class="hs-special">]</span><span>
</span><a name="line-1313"></a><span>    </span><a name="local-6989586621679032528"><a href="#local-6989586621679032528"><span class="hs-identifier">l12</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032523"><span class="hs-identifier hs-var">a12</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ncols</span><span> </span><a href="#local-6989586621679032523"><span class="hs-identifier hs-var">a12</span></a><span class="hs-special">)</span><span>
</span><a name="line-1314"></a><span>    </span><a name="local-6989586621679032529"><a href="#local-6989586621679032529"><span class="hs-identifier">l21</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#scaleMatrix"><span class="hs-identifier hs-var">scaleMatrix</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-operator hs-var">/</span><a href="#local-6989586621679032526"><span class="hs-identifier hs-var">l11'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679032524"><span class="hs-identifier hs-var">a21</span></a><span>
</span><a name="line-1315"></a><span>    </span><a name="local-6989586621679032530"><a href="#local-6989586621679032530"><span class="hs-identifier">a22'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032525"><span class="hs-identifier hs-var">a22</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="Data.Matrix.html#multStd"><span class="hs-identifier hs-var">multStd</span></a><span> </span><a href="#local-6989586621679032529"><span class="hs-identifier hs-var">l21</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#transpose"><span class="hs-identifier hs-var">transpose</span></a><span> </span><a href="#local-6989586621679032529"><span class="hs-identifier hs-var">l21</span></a><span class="hs-special">)</span><span>
</span><a name="line-1316"></a><span>    </span><a name="local-6989586621679032531"><a href="#local-6989586621679032531"><span class="hs-identifier">l22</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Matrix.html#cholDecomp"><span class="hs-identifier hs-var">cholDecomp</span></a><span> </span><a href="#local-6989586621679032530"><span class="hs-identifier hs-var">a22'</span></a><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-1319"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-1320"></a><span class="hs-comment">---- PROPERTIES</span><span>
</span><a name="line-1321"></a><span>
</span><a name="line-1322"></a><span class="hs-pragma">{-# RULES
&quot;matrix/traceOfSum&quot;
    forall a b. trace (a + b) = trace a + trace b

&quot;matrix/traceOfScale&quot;
    forall k a. trace (scaleMatrix k a) = k * trace a
  #-}</span><span>
</span><a name="line-1329"></a><span>
</span><a name="line-1330"></a><span class="hs-comment">-- | Sum of the elements in the diagonal. See also 'getDiag'.</span><span>
</span><a name="line-1331"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-1332"></a><span class="hs-comment">--</span><span>
</span><a name="line-1333"></a><span class="hs-comment">-- &gt;       ( 1 2 3 )</span><span>
</span><a name="line-1334"></a><span class="hs-comment">-- &gt;       ( 4 5 6 )</span><span>
</span><a name="line-1335"></a><span class="hs-comment">-- &gt; trace ( 7 8 9 ) = 15</span><span>
</span><a name="line-1336"></a><span class="hs-identifier">trace</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031462"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031462"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031462"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1337"></a><a name="trace"><a href="Data.Matrix.html#trace"><span class="hs-identifier">trace</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Matrix.html#getDiag"><span class="hs-identifier hs-var">getDiag</span></a><span>
</span><a name="line-1338"></a><span>
</span><a name="line-1339"></a><span class="hs-comment">-- | Product of the elements in the diagonal. See also 'getDiag'.</span><span>
</span><a name="line-1340"></a><span class="hs-comment">--   Example:</span><span>
</span><a name="line-1341"></a><span class="hs-comment">--</span><span>
</span><a name="line-1342"></a><span class="hs-comment">-- &gt;          ( 1 2 3 )</span><span>
</span><a name="line-1343"></a><span class="hs-comment">-- &gt;          ( 4 5 6 )</span><span>
</span><a name="line-1344"></a><span class="hs-comment">-- &gt; diagProd ( 7 8 9 ) = 45</span><span>
</span><a name="line-1345"></a><span class="hs-identifier">diagProd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031461"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031461"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031461"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1346"></a><a name="diagProd"><a href="Data.Matrix.html#diagProd"><span class="hs-identifier">diagProd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">product</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Matrix.html#getDiag"><span class="hs-identifier hs-var">getDiag</span></a><span>
</span><a name="line-1347"></a><span>
</span><a name="line-1348"></a><span class="hs-comment">-- DETERMINANT</span><span>
</span><a name="line-1349"></a><span>
</span><a name="line-1350"></a><span class="hs-pragma">{-# RULES
&quot;matrix/detLaplaceProduct&quot;
    forall a b. detLaplace (a*b) = detLaplace a * detLaplace b

&quot;matrix/detLUProduct&quot;
    forall a b. detLU (a*b) = detLU a * detLU b
  #-}</span><span>
</span><a name="line-1357"></a><span>
</span><a name="line-1358"></a><span class="hs-comment">-- | Matrix determinant using Laplace expansion.</span><span>
</span><a name="line-1359"></a><span class="hs-comment">--   If the elements of the 'Matrix' are instance of 'Ord' and 'Fractional'</span><span>
</span><a name="line-1360"></a><span class="hs-comment">--   consider to use 'detLU' in order to obtain better performance.</span><span>
</span><a name="line-1361"></a><span class="hs-comment">--   Function 'detLaplace' is /extremely/ slow.</span><span>
</span><a name="line-1362"></a><span class="hs-identifier">detLaplace</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679031460"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031460"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031460"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1363"></a><a name="detLaplace"><a href="Data.Matrix.html#detLaplace"><span class="hs-identifier">detLaplace</span></a></a><span> </span><a name="local-6989586621679032532"><a href="#local-6989586621679032532"><span class="hs-identifier">m</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.Matrix.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032532"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1364"></a><span class="hs-identifier">detLaplace</span><span> </span><a name="local-6989586621679032533"><a href="#local-6989586621679032533"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679032534"><span class="hs-identifier hs-var">sum1</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-operator hs-var">^</span><span class="hs-special">(</span><a href="#local-6989586621679032535"><span class="hs-identifier hs-var">i</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679032533"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679032535"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="Data.Matrix.html#detLaplace"><span class="hs-identifier hs-var">detLaplace</span></a><span> </span><span class="hs-special">(</span><a href="Data.Matrix.html#minorMatrix"><span class="hs-identifier hs-var">minorMatrix</span></a><span> </span><a href="#local-6989586621679032535"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679032533"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679032535"><a href="#local-6989586621679032535"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">nrows</span><span> </span><a href="#local-6989586621679032533"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1365"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1366"></a><span>    </span><a name="local-6989586621679032534"><a href="#local-6989586621679032534"><span class="hs-identifier">sum1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl1'</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span>
</span><a name="line-1367"></a><span>
</span><a name="line-1368"></a><span class="hs-comment">-- | Matrix determinant using LU decomposition.</span><span>
</span><a name="line-1369"></a><span class="hs-comment">--   It works even when the input matrix is singular.</span><span>
</span><a name="line-1370"></a><span class="hs-identifier">detLU</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679031459"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-6989586621679031459"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Matrix.html#Matrix"><span class="hs-identifier hs-type">Matrix</span></a><span> </span><a href="#local-6989586621679031459"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679031459"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1371"></a><a name="detLU"><a href="Data.Matrix.html#detLU"><span class="hs-identifier">detLU</span></a></a><span> </span><a name="local-6989586621679032536"><a href="#local-6989586621679032536"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Data.Matrix.html#luDecomp"><span class="hs-identifier hs-var">luDecomp</span></a><span> </span><a href="#local-6989586621679032536"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1372"></a><span>  </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679032537"><a href="#local-6989586621679032537"><span class="hs-identifier">u</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679032538"><a href="#local-6989586621679032538"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679032538"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="Data.Matrix.html#diagProd"><span class="hs-identifier hs-var">diagProd</span></a><span> </span><a href="#local-6989586621679032537"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-1373"></a><span>  </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1374"></a></pre></body></html>